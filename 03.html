<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>태극도 공지사항</title>
    
    <!-- Tailwind CSS (스타일링) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (아이콘) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts (폰트) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* 커스텀 스타일 정의 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            color: #2c2c2c;
        }
        
        .font-serif-kr { font-family: 'Noto Serif KR', serif; }
        .font-sans-kr { font-family: 'Noto Sans KR', sans-serif; }

        /* 한지 질감 배경 */
        .bg-texture {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e6e2d3 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* 애니메이션 */
        @keyframes slideDown {
            from { transform: translateY(-20px) translateX(-50%); opacity: 0; }
            to { transform: translateY(0) translateX(-50%); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-slide-down { animation: slideDown 0.3s ease-out forwards; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        
        /* 스크롤바 커스텀 (선택사항) */
        textarea { resize: none; }
    </style>
</head>
<body class="bg-texture min-h-screen flex flex-col items-center py-8 px-4 relative">

    <!-- 토스트 알림 컨테이너 -->
    <div id="toast-container"></div>

    <!-- 헤더 영역 -->
    <div class="w-full max-w-3xl relative mb-8">
        <a href="index.html" class="absolute top-0 right-0 flex items-center gap-1 text-stone-600 hover:text-stone-900 transition-colors text-sm md:text-base cursor-pointer no-underline">
            <i data-lucide="home" class="w-4 h-4 md:w-5 md:h-5"></i>
            <span class="font-serif-kr hidden md:inline">홈으로</span>
        </a>

        <header class="text-center pt-8 border-b-4 border-double border-stone-300 pb-8 cursor-pointer" onclick="app.goHome()">
            <div class="flex justify-center mb-2">
                <div class="w-8 h-8 rounded-full border-2 border-stone-800 flex items-center justify-center">
                    <div class="w-4 h-4 bg-stone-800 rounded-full"></div>
                </div>
            </div>
            <h1 class="text-3xl md:text-4xl font-serif-kr font-bold text-stone-800 tracking-wide mb-2">
                太極道 공지사항
            </h1>
            <p class="text-stone-500 font-sans-kr text-sm md:text-base">
                도인 여러분께 소식을 전합니다
            </p>
        </header>
    </div>

    <!-- 메인 콘텐츠 영역 (여기에 JS로 내용이 그려짐) -->
    <main id="main-content" class="w-full max-w-3xl bg-white/60 backdrop-blur-sm border border-stone-200 shadow-sm rounded-lg overflow-hidden min-h-[500px] flex flex-col">
        <!-- JS Render Target -->
    </main>

    <!-- 푸터 / 관리자 토글 -->
    <footer class="mt-12 text-center pb-8">
        <button onclick="app.toggleAdmin()" class="text-xs text-stone-400 hover:text-stone-600 flex items-center justify-center gap-1 mx-auto transition-colors px-4 py-2">
            <span id="admin-icon-wrapper"></span>
            <span id="admin-text">관리자 모드</span>
        </button>
        <p class="text-[10px] text-stone-300 mt-2 font-sans-kr">&copy; 2026 Taegukdo. All rights reserved.</p>
    </footer>

    <!-- 모달 컨테이너 (기본 숨김) -->
    <div id="modal-container" class="hidden fixed inset-0 bg-stone-900/40 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="app.closeModal()">
        <div id="modal-content" class="bg-[#fdfbf7] w-full max-w-md rounded-lg shadow-2xl border border-stone-200 overflow-hidden" onclick="event.stopPropagation()">
            <!-- JS Render Target -->
        </div>
    </div>

    <script>
        /**
         * ------------------------------------------------------------------
         * State Management (상태 관리)
         * ------------------------------------------------------------------
         */
        const state = {
            isAdmin: false,
            viewMode: 'current', // 'current' | 'archived'
            selectedPostId: null,
            modalType: null, // 'login' | 'write' | 'delete' | null
            deleteTargetId: null,
            
            // 입력 폼 데이터
            inputs: {
                title: '',
                content: '',
                isMustRead: false,
                password: ''
            },

            // 게시글 데이터
            posts: [
                {
                    id: 4,
                    title: '[중요] 도장 내 정숙 및 예절 준수 안내',
                    date: '2026.05.22',
                    content: '도장은 수도를 하는 신성한 공간입니다.\n참배 및 기도 시 정숙을 유지해주시고, 복장을 단정히 하여 주시길 당부드립니다.',
                    isNew: true,
                    isArchived: false,
                    isMustRead: true, 
                },
                {
                    id: 3,
                    title: '임원 정기 회의 일정 안내',
                    date: '2026.05.20',
                    content: '금월 임원 정기 회의가 대강전 회의실에서 진행됩니다.\n\n일시: 2026년 5월 25일 오전 10시\n장소: 대강전 2층 회의실\n안건: 하반기 주요 행사 일정 논의\n\n임원 분들의 많은 참석 바랍니다.',
                    isNew: true,
                    isArchived: false,
                    isMustRead: false,
                },
                {
                    id: 2,
                    title: '경내 조경 공사 협조 요청',
                    date: '2026.05.15',
                    content: '경내 소나무 전지 작업으로 인한 통행 제한이 있을 수 있습니다.\n\n작업 기간 동안 안전을 위해 우회로를 이용해 주시면 감사하겠습니다.\n불편을 드려 죄송합니다.',
                    isNew: false,
                    isArchived: false,
                    isMustRead: false,
                },
                {
                    id: 1,
                    title: '2025년 동지 치성 결과 보고',
                    date: '2025.12.22',
                    content: '지난 동지 치성이 경건한 분위기 속에서 봉행되었습니다.',
                    isNew: false,
                    isArchived: true,
                    isMustRead: false,
                },
            ]
        };

        const ADMIN_PASSWORD = "taegeuk1909#";

        /**
         * ------------------------------------------------------------------
         * Application Logic (기능 구현)
         * ------------------------------------------------------------------
         */
        const app = {
            // 초기화
            init: function() {
                this.renderApp();
            },

            // 화면 전체 렌더링
            renderApp: function() {
                this.renderMainContent();
                this.renderFooterIcon();
                this.renderModal();
                lucide.createIcons(); // 아이콘 새로고침
            },

            // 메인 콘텐츠 영역 렌더링 (리스트 vs 상세)
            renderMainContent: function() {
                const mainEl = document.getElementById('main-content');
                
                if (state.selectedPostId !== null) {
                    // 상세 보기 모드
                    const post = state.posts.find(p => p.id === state.selectedPostId);
                    if (!post) { state.selectedPostId = null; return this.renderApp(); }
                    
                    mainEl.innerHTML = `
                        <div class="p-6 md:p-10 animate-fade-in flex-grow">
                            <!-- 툴바 -->
                            <div class="flex justify-between items-center mb-6 border-b border-stone-200 pb-4">
                                <button onclick="app.goList()" class="flex items-center gap-1 text-stone-500 hover:text-stone-800 transition font-sans-kr text-sm">
                                    <i data-lucide="arrow-left" class="w-4 h-4"></i> 목록으로
                                </button>
                                
                                ${state.isAdmin ? `
                                    <div class="flex gap-3">
                                        <button onclick="app.toggleArchive(${post.id})" class="text-stone-500 hover:text-stone-800 transition flex items-center gap-1 text-sm">
                                            <i data-lucide="${post.isArchived ? 'refresh-ccw' : 'archive'}" class="w-4 h-4"></i>
                                            ${post.isArchived ? "복원" : "보관"}
                                        </button>
                                        <div class="w-px h-4 bg-stone-300 my-auto"></div>
                                        <button onclick="app.requestDelete(${post.id})" class="text-stone-400 hover:text-red-600 transition flex items-center gap-1 text-sm">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i> 삭제
                                        </button>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- 제목 및 날짜 -->
                            <div class="mb-8">
                                <div class="flex flex-wrap items-center gap-2 mb-2">
                                    ${post.isMustRead && !post.isArchived ? 
                                        `<span class="bg-[#8b3a3a] text-white text-xs px-2 py-0.5 rounded font-sans-kr flex items-center gap-1">
                                            <i data-lucide="megaphone" class="w-3 h-3 fill-current"></i> 필독
                                         </span>` : ''}
                                    ${post.isArchived ? `<span class="bg-stone-500 text-white text-xs px-2 py-0.5 rounded font-sans-kr">보관됨</span>` : ''}
                                    <span class="text-stone-400 font-sans-kr text-sm">${post.date}</span>
                                </div>
                                <h2 class="text-2xl md:text-3xl font-serif-kr font-bold text-stone-800 leading-tight">${post.title}</h2>
                            </div>

                            <!-- 본문 -->
                            <div class="font-sans-kr text-stone-700 leading-relaxed whitespace-pre-wrap min-h-[200px]">${post.content}</div>
                        </div>
                    `;
                } else {
                    // 리스트 모드
                    // 1. 탭 메뉴
                    let html = `
                        <div class="flex border-b border-stone-200">
                            <button onclick="app.changeViewMode('current')" class="flex-1 py-4 text-center font-serif-kr text-sm md:text-base transition-colors ${state.viewMode === 'current' ? 'font-bold text-stone-800 border-b-2 border-stone-800 bg-white/50' : 'text-stone-400 hover:text-stone-600'}">
                                진행 중인 공지
                            </button>
                            <button onclick="app.changeViewMode('archived')" class="flex-1 py-4 text-center font-serif-kr text-sm md:text-base transition-colors ${state.viewMode === 'archived' ? 'font-bold text-stone-800 border-b-2 border-stone-800 bg-white/50' : 'text-stone-400 hover:text-stone-600'}">
                                지난 공지 보관함
                            </button>
                        </div>
                    `;

                    // 2. 글쓰기 버튼 (관리자 & 현재공지 탭)
                    if (state.isAdmin && state.viewMode === 'current') {
                        html += `
                            <div class="bg-stone-100 p-3 flex justify-end border-b border-stone-200">
                                <button onclick="app.openModal('write')" class="flex items-center gap-2 bg-stone-800 text-white px-4 py-2 rounded hover:bg-stone-700 transition font-sans-kr text-sm">
                                    <i data-lucide="plus" class="w-4 h-4"></i> 새 글 작성
                                </button>
                            </div>
                        `;
                    }

                    // 3. 리스트 아이템 생성
                    const filteredPosts = state.posts
                        .filter(p => state.viewMode === 'current' ? !p.isArchived : p.isArchived)
                        .sort((a, b) => {
                            if (state.viewMode === 'current') {
                                if (a.isMustRead && !b.isMustRead) return -1;
                                if (!a.isMustRead && b.isMustRead) return 1;
                            }
                            return b.id - a.id;
                        });

                    html += `<ul class="divide-y divide-stone-200 flex-grow">`;
                    
                    if (filteredPosts.length === 0) {
                        html += `
                            <li class="p-12 text-center text-stone-400 font-sans-kr h-40 flex items-center justify-center">
                                ${state.viewMode === 'current' ? '등록된 공지사항이 없습니다.' : '보관된 공지사항이 없습니다.'}
                            </li>
                        `;
                    } else {
                        filteredPosts.forEach(post => {
                            const isHighlighted = post.isMustRead && state.viewMode === 'current';
                            html += `
                                <li onclick="app.selectPost(${post.id})" class="group hover:bg-stone-50 transition-colors duration-200 cursor-pointer ${isHighlighted ? 'bg-[#fdf3f3]/50' : ''}">
                                    <div class="p-6 md:p-8 flex flex-col md:flex-row gap-4 relative">
                                        ${isHighlighted ? `<div class="absolute left-0 top-0 bottom-0 w-1 bg-[#8b3a3a]"></div>` : ''}
                                        
                                        <div class="flex-shrink-0 md:w-24 text-stone-400 font-sans-kr text-sm pt-1">${post.date}</div>
                                        
                                        <div class="flex-grow">
                                            <div class="flex items-center gap-2 mb-2 flex-wrap">
                                                ${isHighlighted ? 
                                                    `<span class="bg-[#8b3a3a] text-white text-[10px] font-bold px-1.5 py-0.5 rounded font-sans-kr flex items-center gap-1">
                                                        <i data-lucide="megaphone" class="w-3 h-3 fill-current"></i> 필독
                                                     </span>` : ''}
                                                ${post.isNew && !post.isArchived ? 
                                                    `<span class="bg-stone-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded font-sans-kr animate-pulse">NEW</span>` : ''}
                                                ${post.isArchived ? 
                                                    `<span class="bg-stone-400 text-white text-[10px] font-bold px-1.5 py-0.5 rounded font-sans-kr">보관됨</span>` : ''}
                                                
                                                <h3 class="text-lg md:text-xl font-serif-kr font-semibold group-hover:underline decoration-stone-400 underline-offset-4 ${isHighlighted ? 'text-[#8b3a3a]' : 'text-stone-800'}">
                                                    ${post.title}
                                                </h3>
                                            </div>
                                            <p class="text-stone-600 font-sans-kr text-sm md:text-base leading-relaxed line-clamp-2">${post.content}</p>
                                        </div>

                                        ${state.isAdmin ? `
                                            <div class="flex items-start justify-end gap-2 md:w-16" onclick="event.stopPropagation()">
                                                <button onclick="event.stopPropagation(); app.toggleArchive(${post.id})" class="text-stone-300 hover:text-stone-600 transition p-2 hover:bg-stone-100 rounded-full" title="${post.isArchived ? '복원' : '보관'}">
                                                    <i data-lucide="${post.isArchived ? 'refresh-ccw' : 'archive'}" class="w-5 h-5"></i>
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </li>
                            `;
                        });
                    }
                    html += `</ul>`;
                    mainEl.innerHTML = html;
                }
            },

            // 푸터 아이콘 관리
            renderFooterIcon: function() {
                const iconWrapper = document.getElementById('admin-icon-wrapper');
                const textEl = document.getElementById('admin-text');
                
                iconWrapper.innerHTML = state.isAdmin 
                    ? `<i data-lucide="unlock" class="w-3 h-3"></i>` 
                    : `<i data-lucide="lock" class="w-3 h-3"></i>`;
                
                textEl.innerText = state.isAdmin ? '관리자 모드 종료' : '관리자 모드';
            },

            // 모달 렌더링
            renderModal: function() {
                const container = document.getElementById('modal-container');
                const content = document.getElementById('modal-content');
                
                if (!state.modalType) {
                    container.classList.add('hidden');
                    return;
                }
                
                container.classList.remove('hidden');
                let html = '';

                if (state.modalType === 'login') {
                    html = `
                        <div class="p-6 text-center font-sans-kr">
                            <h3 class="font-serif-kr font-bold text-xl mb-4 text-stone-800">관리자 로그인</h3>
                            <p class="text-sm text-stone-500 mb-4">관리자 비밀번호를 입력해주세요.</p>
                            <input type="password" id="pw-input" placeholder="비밀번호 입력"
                                class="w-full border border-stone-300 p-3 rounded mb-4 text-center focus:outline-none focus:border-[#8b3a3a]"
                                onkeydown="if(event.key === 'Enter') app.submitLogin()">
                            <div class="flex gap-2 justify-center">
                                <button onclick="app.closeModal()" class="px-4 py-2 text-stone-500 hover:bg-stone-100 rounded">취소</button>
                                <button onclick="app.submitLogin()" class="px-6 py-2 bg-stone-800 text-white rounded hover:bg-stone-700">확인</button>
                            </div>
                        </div>
                    `;
                } else if (state.modalType === 'write') {
                    html = `
                        <div class="bg-stone-800 text-white px-6 py-4 flex justify-between items-center">
                            <h3 class="font-serif-kr font-bold text-lg">새 공지사항</h3>
                            <button onclick="app.closeModal()"><i data-lucide="x" class="w-5 h-5"></i></button>
                        </div>
                        <div class="p-6 font-sans-kr">
                            <div class="mb-4 flex items-center gap-2">
                                <input type="checkbox" id="must-read-check" class="w-4 h-4 accent-[#8b3a3a]">
                                <label for="must-read-check" class="text-sm font-bold text-[#8b3a3a] cursor-pointer flex items-center gap-1">
                                    <i data-lucide="megaphone" class="w-3.5 h-3.5"></i> 중요 필독 공지로 설정
                                </label>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-bold text-stone-600 mb-1">제목</label>
                                <input type="text" id="title-input" class="w-full border p-2 rounded focus:outline-none focus:border-[#8b3a3a]" placeholder="제목 입력">
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-bold text-stone-600 mb-1">내용</label>
                                <textarea id="content-input" class="w-full border p-2 rounded h-32 resize-none focus:outline-none focus:border-[#8b3a3a]" placeholder="내용 입력"></textarea>
                            </div>
                            <div class="flex justify-end gap-2">
                                <button onclick="app.closeModal()" class="px-4 py-2 text-stone-500 hover:bg-stone-100 rounded">취소</button>
                                <button onclick="app.submitPost()" class="px-4 py-2 bg-[#8b3a3a] text-white rounded font-bold hover:bg-[#722f2f]">등록</button>
                            </div>
                        </div>
                    `;
                } else if (state.modalType === 'delete') {
                    html = `
                        <div class="p-6 text-center font-sans-kr">
                            <div class="mx-auto w-12 h-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-4">
                                <i data-lucide="trash-2" class="w-6 h-6"></i>
                            </div>
                            <h3 class="font-bold text-lg mb-2 text-stone-800">삭제하시겠습니까?</h3>
                            <p class="text-sm text-stone-500 mb-6">삭제된 게시글은 복구할 수 없습니다.</p>
                            <div class="flex gap-2 justify-center">
                                <button onclick="app.closeModal()" class="px-4 py-2 border border-stone-300 rounded hover:bg-stone-50 text-stone-600">취소</button>
                                <button onclick="app.confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">삭제하기</button>
                            </div>
                        </div>
                    `;
                }
                
                content.innerHTML = html;
                
                // 모달이 열린 후 포커스 처리 등
                if(state.modalType === 'login') setTimeout(() => document.getElementById('pw-input').focus(), 50);
            },

            // 토스트 알림 표시
            showToast: function(message) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = "fixed top-6 left-1/2 transform -translate-x-1/2 z-[100] animate-slide-down";
                toast.innerHTML = `
                    <div class="bg-stone-800 text-white px-6 py-3 rounded-full shadow-lg flex items-center gap-2 font-sans-kr text-sm">
                        <i data-lucide="check" class="w-4 h-4 text-green-400"></i> ${message}
                    </div>
                `;
                
                container.appendChild(toast);
                lucide.createIcons();

                setTimeout(() => {
                    toast.remove();
                }, 3000);
            },

            // --- 액션 핸들러 ---
            
            goHome: function() {
                state.selectedPostId = null;
                this.renderApp();
            },

            goList: function() {
                state.selectedPostId = null;
                this.renderApp();
            },

            selectPost: function(id) {
                state.selectedPostId = id;
                this.renderApp();
            },

            changeViewMode: function(mode) {
                state.viewMode = mode;
                this.renderApp();
            },

            toggleAdmin: function() {
                if (state.isAdmin) {
                    state.isAdmin = false;
                    this.showToast("관리자 모드가 종료되었습니다.");
                    this.renderApp();
                } else {
                    this.openModal('login');
                }
            },

            openModal: function(type) {
                state.modalType = type;
                this.renderApp();
            },

            closeModal: function() {
                state.modalType = null;
                state.deleteTargetId = null;
                this.renderApp();
            },

            submitLogin: function() {
                const input = document.getElementById('pw-input');
                if (input.value === ADMIN_PASSWORD) {
                    state.isAdmin = true;
                    this.showToast("관리자 모드로 전환되었습니다.");
                    this.closeModal();
                } else {
                    this.showToast("비밀번호가 일치하지 않습니다.");
                }
            },

            submitPost: function() {
                const title = document.getElementById('title-input').value;
                const content = document.getElementById('content-input').value;
                const isMustRead = document.getElementById('must-read-check').checked;

                if (!title.trim() || !content.trim()) {
                    this.showToast("제목과 내용을 모두 입력해주세요.");
                    return;
                }

                const today = new Date();
                const dateString = `${today.getFullYear()}.${String(today.getMonth() + 1).padStart(2, '0')}.${String(today.getDate()).padStart(2, '0')}`;

                const newPost = {
                    id: Date.now(),
                    title: title,
                    date: dateString,
                    content: content,
                    isNew: true,
                    isArchived: false,
                    isMustRead: isMustRead
                };

                state.posts.unshift(newPost);
                this.showToast(isMustRead ? "필독 공지가 등록되었습니다." : "새로운 공지사항이 등록되었습니다.");
                
                state.viewMode = 'current'; // 새 글은 현재 목록으로
                this.closeModal();
            },

            requestDelete: function(id) {
                state.deleteTargetId = id;
                this.openModal('delete');
            },

            confirmDelete: function() {
                state.posts = state.posts.filter(p => p.id !== state.deleteTargetId);
                
                // 만약 현재 보고 있는 글을 삭제했다면 목록으로 이동
                if (state.selectedPostId === state.deleteTargetId) {
                    state.selectedPostId = null;
                }

                this.showToast("게시글이 삭제되었습니다.");
                this.closeModal();
            },

            toggleArchive: function(id) {
                const post = state.posts.find(p => p.id === id);
                if (!post) return;

                post.isArchived = !post.isArchived;
                
                if (post.isArchived) {
                    this.showToast("게시글이 보관함으로 이동되었습니다.");
                    if (state.viewMode === 'current' && state.selectedPostId) state.selectedPostId = null;
                } else {
                    this.showToast("게시글이 공지사항으로 복원되었습니다.");
                    if (state.viewMode === 'archived' && state.selectedPostId) state.selectedPostId = null;
                }

                this.renderApp();
            }
        };

        // 앱 시작
        app.init();
    </script>
</body>
</html>
