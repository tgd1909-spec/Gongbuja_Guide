<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íƒœê·¹ë„ ê³µë¶€ ê¸¸ë¼ì¡ì´</title>
    
    <!-- PWA ë° ì•„ì´ì½˜ ì„¤ì • -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <meta name="theme-color" content="#1565c0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="íƒœê·¹ë„ ê³µë¶€">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@400;600;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'k-bg': '#fdfbf7',
                        'k-text': '#1a1a1a',
                        'k-sub': '#555555',
                        'theme-navy': '#2c3e50',
                        'theme-apricot': '#d97706',
                        'theme-teal': '#0f766e',
                        'theme-crimson': '#be123c',
                    },
                    fontFamily: {
                        serif: ['"Noto Serif KR"', 'serif'],
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e6e2d3 1px, transparent 1px);
            background-size: 24px 24px;
            color: #1a1a1a;
            -webkit-font-smoothing: antialiased;
        }
        .keep-all {
            word-break: keep-all;
            word-wrap: break-word;
        }
        /* ëª¨ë°”ì¼ì—ì„œ ì œëª©ì´ í•œ ì¤„ë¡œ ìœ ì§€ë˜ë„ë¡ ë•ëŠ” ìŠ¤íƒ€ì¼ */
        .title-container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        /* ê²€ìƒ‰ ê²°ê³¼ì°½ì˜ ìŠ¤í¬ë¡¤ë°” ë””ìì¸ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 md:p-8 font-sans">

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="relative w-full max-w-5xl bg-white/90 backdrop-blur-md border border-stone-200 shadow-2xl rounded-2xl overflow-hidden p-6 md:p-10 lg:p-14">
        
        <!-- í™ˆ ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) -->
        <a href="index.html" class="absolute top-6 right-6 md:top-8 md:right-8 group flex items-center gap-2 text-stone-500 hover:text-k-text transition-colors duration-300 p-2 z-10">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="hidden md:inline font-serif text-sm font-bold tracking-widest pt-0.5">í™ˆìœ¼ë¡œ</span>
        </a>

        <!-- í—¤ë” ì„¹ì…˜ -->
        <header class="text-center mb-8 mt-4 relative">
            <div class="mx-auto w-24 h-24 md:w-28 md:h-28 mb-6 flex items-center justify-center transform hover:scale-105 transition-transform duration-500">
                <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" class="w-full h-full drop-shadow-md">
                    <circle cx="100" cy="100" r="95" fill="none" stroke="#ddd" stroke-width="1.5" />
                    <path d="M100,5 L100,20 M100,180 L100,195 M5,100 L20,100 M180,100 L195,100" stroke="#ccc" stroke-width="2"/>
                    <path d="M100,25 A75,75 0 0,0 100,175 A37.5,37.5 0 0,0 100,100 A37.5,37.5 0 0,1 100,25 Z" fill="#1565c0" />
                    <path d="M100,175 A75,75 0 0,0 100,25 A37.5,37.5 0 0,0 100,100 A37.5,37.5 0 0,1 100,175 Z" fill="#c62828" />
                </svg>
            </div>
            
            <h1 class="font-serif text-3xl md:text-5xl lg:text-6xl font-black mb-5 tracking-tight leading-snug text-black keep-all">
                íƒœê·¹ë„ ê³µë¶€ ê¸¸ë¼ì¡ì´
            </h1>
            <p class="font-sans text-stone-600 text-sm md:text-lg font-medium tracking-wide keep-all leading-relaxed px-2">
                ë„ë¥¼ êµ¬í•˜ëŠ” ë§ˆìŒìœ¼ë¡œ <span class="text-stone-800 font-bold underline decoration-stone-300 decoration-2 underline-offset-4">ê³µë¶€ì— ì²«ê±¸ìŒ</span>ì„ ë‚´ë””ë”˜ ë„ì¸ë¶„ë“¤ì„ í™˜ì˜í•©ë‹ˆë‹¤.<br class="hidden md:block"/>
                ì˜¬ë°”ë¥¸ ì˜ˆë²•ê³¼ ë§ˆìŒê°€ì§ì„ ìœ„í•œ ì•ˆë‚´ì„œì…ë‹ˆë‹¤.
            </p>
        </header>

        <!-- ì§€ë¯¼ë‹˜ì´ ì›í•˜ì‹  ê²€ìƒ‰ì°½ ìœ„ì¹˜ (í—¤ë” ì•„ë˜, ë„¤ë¹„ê²Œì´ì…˜ ìœ„) -->
        <div class="mb-12 flex flex-col items-center w-full relative z-20">
            <div class="relative w-full max-w-md">
                <!-- ë‹ë³´ê¸° ì•„ì´ì½˜ -->
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <!-- ê²€ìƒ‰ ì…ë ¥ì°½ (type="module" ëŒ€ì‘ì„ ìœ„í•´ id í™œìš©) -->
                <input type="text" id="searchInput" placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš” (ì˜ˆ: ì˜ˆì ˆ)" class="w-full pl-11 pr-20 py-3 rounded-full border border-stone-300 bg-white focus:outline-none focus:border-theme-navy focus:ring-2 focus:ring-theme-navy/20 shadow-sm transition-all text-sm md:text-base text-stone-700">
                <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
                <button id="searchButton" class="absolute right-1.5 top-1/2 -translate-y-1/2 bg-theme-navy hover:bg-slate-700 text-white px-4 py-1.5 rounded-full text-sm font-medium transition-colors duration-300 shadow-sm">
                    ê²€ìƒ‰
                </button>
            </div>
            <!-- ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
            <div id="searchResults" class="w-full max-w-md mt-4 text-left text-sm md:text-base text-stone-700 empty:hidden"></div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ ê·¸ë¦¬ë“œ -->
        <nav class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 w-full mx-auto">
            
            <!-- 1. ë²•ì‹ ì•ˆë‚´ -->
            <a href="04.html" class="group relative flex flex-col bg-white rounded-xl border-2 border-stone-100 hover:border-theme-navy transition-all duration-300 shadow-sm hover:shadow-xl transform hover:-translate-y-1 overflow-hidden">
                <div class="h-1.5 w-full bg-theme-navy opacity-80 group-hover:opacity-100 transition-opacity"></div>
                <div class="p-5 md:p-8 flex items-start gap-4 md:gap-5">
                    <div class="shrink-0 w-12 h-12 md:w-14 md:h-14 rounded-full bg-slate-50 border border-slate-100 flex items-center justify-center text-theme-navy group-hover:bg-theme-navy group-hover:text-white transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            <path d="M8 10h8"/><path d="M12 10v4"/>
                        </svg>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <div class="title-container mb-2">
                            <span class="whitespace-nowrap text-[10px] md:text-xs font-bold text-theme-navy bg-slate-100 px-2 py-0.5 rounded-md border border-slate-200">ì œ1ì¥</span>
                            <h2 class="font-serif text-xl md:text-2xl font-bold text-k-text group-hover:text-theme-navy transition-colors">ë²•ì‹ ì•ˆë‚´</h2>
                        </div>
                        <p class="text-stone-600 text-sm md:text-base leading-relaxed keep-all group-hover:text-stone-800">
                            ë„ì¥ ë‚´ì—ì„œ í–‰í•˜ëŠ” <strong class="text-theme-navy font-bold">ë°°ë¡€ì™€ ë´‰ì‹¬</strong> ë“± <strong class="text-theme-navy font-bold">ê¸°ë³¸ ì˜ˆì ˆ</strong>ì„ ìµí™ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </a>

            <!-- 2. ê³µë¶€ ë“œëŠ” ì¤€ë¹„ -->
            <a href="01.html" class="group relative flex flex-col bg-white rounded-xl border-2 border-stone-100 hover:border-theme-apricot transition-all duration-300 shadow-sm hover:shadow-xl transform hover:-translate-y-1 overflow-hidden">
                <div class="h-1.5 w-full bg-theme-apricot opacity-80 group-hover:opacity-100 transition-opacity"></div>
                <div class="p-5 md:p-8 flex items-start gap-4 md:gap-5">
                    <div class="shrink-0 w-12 h-12 md:w-14 md:h-14 rounded-full bg-orange-50 border border-orange-100 flex items-center justify-center text-theme-apricot group-hover:bg-theme-apricot group-hover:text-white transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.38 3.46L16 2a4 4 0 01-8 0L3.62 3.46a2 2 0 00-1.34 2.23l.58 3.47a1 1 0 00.99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 002-2V10h2.15a1 1 0 00.99-.84l.58-3.47a2 2 0 00-1.34-2.23z"/>
                        </svg>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <div class="title-container mb-2">
                            <span class="whitespace-nowrap text-[10px] md:text-xs font-bold text-theme-apricot bg-orange-50 px-2 py-0.5 rounded-md border border-orange-100">ì œ2ì¥</span>
                            <h2 class="font-serif text-xl md:text-2xl font-bold text-k-text group-hover:text-theme-apricot transition-colors">ê³µë¶€ ë“œëŠ” ì¤€ë¹„</h2>
                        </div>
                        <p class="text-stone-600 text-sm md:text-base leading-relaxed keep-all group-hover:text-stone-800">
                            ë„ì¥ì— ë“¤ì–´ì„œê¸° ì „ ê°–ì¶”ì–´ì•¼ í•  ë‹¨ì •í•œ <strong class="text-theme-apricot font-bold">ë³µì¥</strong>ê³¼ ì •ê°ˆí•œ <strong class="text-theme-apricot font-bold">ë§ˆìŒê°€ì§</strong>ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </a>

            <!-- 3. ì¼ê³¼í‘œ -->
            <a href="02.html" class="group relative flex flex-col bg-white rounded-xl border-2 border-stone-100 hover:border-theme-teal transition-all duration-300 shadow-sm hover:shadow-xl transform hover:-translate-y-1 overflow-hidden">
                <div class="h-1.5 w-full bg-theme-teal opacity-80 group-hover:opacity-100 transition-opacity"></div>
                <div class="p-5 md:p-8 flex items-start gap-4 md:gap-5">
                    <div class="shrink-0 w-12 h-12 md:w-14 md:h-14 rounded-full bg-teal-50 border border-teal-100 flex items-center justify-center text-theme-teal group-hover:bg-theme-teal group-hover:text-white transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M6.34 17.66l-1.41 1.41"/><path d="M19.07 4.93l-1.41 1.41"/><circle cx="12" cy="12" r="4" />
                        </svg>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <div class="title-container mb-2">
                            <span class="whitespace-nowrap text-[10px] md:text-xs font-bold text-theme-teal bg-teal-50 px-2 py-0.5 rounded-md border border-teal-100">ì œ3ì¥</span>
                            <h2 class="font-serif text-xl md:text-2xl font-bold text-k-text group-hover:text-theme-teal transition-colors">ì¼ê³¼í‘œ</h2>
                        </div>
                        <p class="text-stone-600 text-sm md:text-base leading-relaxed keep-all group-hover:text-stone-800">
                            ë„ì¸ìœ¼ë¡œì„œ í•˜ë£¨ì˜ ì‹œì‘ê³¼ ë, ì§€ì¼œì•¼ í•  <strong class="text-theme-teal font-bold">í•˜ë£¨ ì¼ê³¼</strong>ì™€ <strong class="text-theme-teal font-bold">ê³µë¶€ ë°©ë²•</strong>ì„ í™•ì¸í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </a>

            <!-- 4. ê³µì§€ì‚¬í•­ -->
            <a href="03.html" class="group relative flex flex-col bg-white rounded-xl border-2 border-stone-100 hover:border-theme-crimson transition-all duration-300 shadow-sm hover:shadow-xl transform hover:-translate-y-1 overflow-hidden">
                <div class="h-1.5 w-full bg-theme-crimson opacity-80 group-hover:opacity-100 transition-opacity"></div>
                <div class="p-5 md:p-8 flex items-start gap-4 md:gap-5">
                    <div class="shrink-0 w-12 h-12 md:w-14 md:h-14 rounded-full bg-rose-50 border border-rose-100 flex items-center justify-center text-theme-crimson group-hover:bg-theme-crimson group-hover:text-white transition-colors duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="9" /><path d="M12 12v.01"/><path d="M12 8v4"/><path d="M12 3V2"/>
                        </svg>
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <div class="title-container mb-2">
                            <span class="whitespace-nowrap text-[10px] md:text-xs font-bold text-theme-crimson bg-rose-50 px-2 py-0.5 rounded-md border border-rose-100">ì œ4ì¥</span>
                            <h2 class="font-serif text-xl md:text-2xl font-bold text-k-text group-hover:text-theme-crimson transition-colors">ê³µì§€ì‚¬í•­</h2>
                        </div>
                        <p class="text-stone-600 text-sm md:text-base leading-relaxed keep-all group-hover:text-stone-800">
                            ë„ì¥ì˜ <strong class="text-theme-crimson font-bold">ì£¼ìš” ì¼ì •</strong>, í–‰ì‚¬ ì†Œì‹ ë° ì´ˆì‹¬ìê°€ ê¼­ ì•Œì•„ì•¼ í•  <strong class="text-theme-crimson font-bold">ì•Œë¦¼ ì‚¬í•­</strong>ì„ ì „í•´ë“œë¦½ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </a>

        </nav>

        <!-- í‘¸í„° -->
        <footer class="mt-12 md:mt-16 text-center border-t border-stone-200 pt-8">
            <p class="font-sans text-stone-500 text-xs md:text-sm font-medium tracking-wide">
                &copy; íƒœê·¹ë„ ë³¸ë¶€. All rights reserved.
            </p>
        </footer>

    </main>

    <!-- ê²€ìƒ‰ ê¸°ëŠ¥ì„ ìœ„í•œ Firebase í†µí•© ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 1. 04.html (ë²•ì‹ ì•ˆë‚´) Firebase ì„¤ì •
        const guideConfig = {
            apiKey: "AIzaSyAoUdyZJQjcT81_2YKzX1rzMJlNAoHcbAw",
            authDomain: "taegeuk-rules.firebaseapp.com",
            projectId: "taegeuk-rules",
            storageBucket: "taegeuk-rules.firebasestorage.app",
            messagingSenderId: "388014641769",
            appId: "1:388014641769:web:f9fd06f30a222663b448f8"
        };

        // 2. 03.html (ê³µì§€ì‚¬í•­) Firebase ì„¤ì •
        const noticeConfig = {
            apiKey: "AIzaSyDe1mpaPcDfiNG63peU7EFNXXNJQmKc2rM",
            authDomain: "taegukdo-notice.firebaseapp.com",
            projectId: "taegukdo-notice",
            storageBucket: "taegukdo-notice.firebasestorage.app",
            messagingSenderId: "322790351041",
            appId: "1:322790351041:web:aa43db9559a99792d3f440"
        };

        // ë‘ ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ Firebase ì•±ì„ ê°ê° ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
        const guideApp = initializeApp(guideConfig, "guideApp");
        const noticeApp = initializeApp(noticeConfig, "noticeApp");

        const guideDb = getFirestore(guideApp);
        const noticeDb = getFirestore(noticeApp);
        const guideAuth = getAuth(guideApp);
        const noticeAuth = getAuth(noticeApp);

        let cachedFirebasePosts = null;

        window.searchAllPages = async function() {
            const keyword = document.getElementById('searchInput').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!keyword) {
                resultsDiv.innerHTML = "<p class='text-center text-theme-crimson font-medium bg-rose-50 p-3 rounded-lg'>ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>";
                return;
            }

            resultsDiv.innerHTML = "<p class='text-center text-stone-500 bg-slate-50 p-3 rounded-lg animate-pulse'>ğŸ” ë¬¸ì„œë¥¼ ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</p>";
            let finalHTML = "";

            // --- 1. ì •ì  ë¬¸ì„œ ê²€ìƒ‰ (01.html, 02.html) ---
            const staticPages = ['01.html', '02.html'];
            const pageTitles = { '01.html': 'ê³µë¶€ ë“œëŠ” ì¤€ë¹„', '02.html': 'ì¼ê³¼í‘œ' };
            const mockDataForPreview = {
                '01.html': 'ë„ì¥ì— ë“¤ì–´ì„œê¸° ì „ ê°–ì¶”ì–´ì•¼ í•  ë‹¨ì •í•œ ë³µì¥ê³¼ ë§ˆìŒê°€ì§ ì˜ˆì‹œë¥¼ í™•ì¸í•©ë‹ˆë‹¤.',
                '02.html': 'ë„ì¸ìœ¼ë¡œì„œ í•˜ë£¨ì˜ ì‹œì‘ê³¼ ë, ì§€ì¼œì•¼ í•  ì˜ˆì ˆê³¼ ì¼ê³¼ ì˜ˆì‹œì…ë‹ˆë‹¤.'
            };

            for (let page of staticPages) {
                try {
                    let text = "";
                    try {
                        const response = await fetch(page);
                        if (response.ok) text = await response.text();
                        else throw new Error('Not found');
                    } catch (e) {
                        text = mockDataForPreview[page]; 
                    }

                    const tempDiv = document.createElement("div");
                    tempDiv.innerHTML = text;
                    const pureText = tempDiv.innerText || tempDiv.textContent;
                    const index = pureText.indexOf(keyword);
                    
                    if (index !== -1) {
                        const start = Math.max(0, index - 30);
                        const end = Math.min(pureText.length, index + keyword.length + 30);
                        let snippet = pureText.substring(start, end);
                        const highlightKeyword = new RegExp(keyword, 'g');
                        snippet = snippet.replace(highlightKeyword, `<b class="text-theme-apricot bg-orange-50 px-1 rounded">${keyword}</b>`);

                        const pageName = pageTitles[page];
                        const targetUrl = `${page}?search=${encodeURIComponent(keyword)}#:~:text=${encodeURIComponent(keyword)}`;

                        finalHTML += `
                            <div class="mb-3 p-4 bg-slate-50 border border-slate-100 rounded-xl hover:border-theme-navy transition-colors duration-300">
                                <h3 class="font-bold text-theme-navy mb-1.5 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    <a href="${targetUrl}" class="hover:underline underline-offset-4 decoration-2">${pageName}</a>
                                </h3>
                                <p class="text-sm text-stone-600 leading-relaxed break-keep">...${snippet}...</p>
                            </div>
                        `;
                    }
                } catch (error) { console.log(`${page} ì²˜ë¦¬ ì˜¤ë¥˜`); }
            }

            // --- 2. ë™ì  ë¬¸ì„œ ê²€ìƒ‰ (Firebase ë‘ ê³³ ëª¨ë‘ ì¡°íšŒ) ---
            try {
                if (!guideAuth.currentUser) await signInAnonymously(guideAuth);
                if (!noticeAuth.currentUser) await signInAnonymously(noticeAuth);

                if (!cachedFirebasePosts) {
                    cachedFirebasePosts = [];
                    
                    // 04.html ë°ì´í„° ìˆ˜ì§‘ (ë²•ì‹ ì•ˆë‚´)
                    try {
                        const guideSnap = await getDocs(collection(guideDb, 'artifacts', 'tgd-guide-public', 'public', 'data', 'posts'));
                        guideSnap.docs.forEach(doc => {
                            cachedFirebasePosts.push({ ...doc.data(), _sourceMeta: { pageTitle: 'ë²•ì‹ ì•ˆë‚´', pageUrl: '04.html' } });
                        });
                    } catch (e) { console.warn('ë²•ì‹ ì•ˆë‚´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); }

                    // 03.html ë°ì´í„° ìˆ˜ì§‘ (ê³µì§€ì‚¬í•­ - ë£¨íŠ¸ posts ì»¬ë ‰ì…˜ ì‚¬ìš©)
                    try {
                        const noticeSnap = await getDocs(collection(noticeDb, 'posts'));
                        noticeSnap.docs.forEach(doc => {
                            cachedFirebasePosts.push({ ...doc.data(), _sourceMeta: { pageTitle: 'ê³µì§€ì‚¬í•­', pageUrl: '03.html' } });
                        });
                    } catch (e) { console.warn('ê³µì§€ì‚¬í•­ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'); }
                }

                cachedFirebasePosts.forEach(post => {
                    const textToSearch = (post.title || "") + " " + (post.content || post.desc || "");
                    const index = textToSearch.indexOf(keyword);
                    
                    if (index !== -1) {
                        const start = Math.max(0, index - 30);
                        const end = Math.min(textToSearch.length, index + keyword.length + 30);
                        let snippet = textToSearch.substring(start, end);
                        const highlightKeyword = new RegExp(keyword, 'g');
                        snippet = snippet.replace(highlightKeyword, `<b class="text-theme-apricot bg-orange-50 px-1 rounded">${keyword}</b>`);

                        const pageName = `${post._sourceMeta.pageTitle} > ${post.category || 'ìƒˆì†Œì‹'}`;
                        const targetUrl = `${post._sourceMeta.pageUrl}?search=${encodeURIComponent(keyword)}#:~:text=${encodeURIComponent(keyword)}`;

                        finalHTML += `
                            <div class="mb-3 p-4 bg-slate-50 border border-slate-100 rounded-xl hover:border-theme-navy transition-colors duration-300">
                                <h3 class="font-bold text-theme-navy mb-1.5 flex items-center gap-2">
                                    <svg class="w-4 h-4 text-theme-apricot" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    <a href="${targetUrl}" class="hover:underline underline-offset-4 decoration-2">${pageName}</a>
                                </h3>
                                <p class="text-sm text-stone-600 leading-relaxed break-keep">...${snippet}...</p>
                            </div>
                        `;
                    }
                });
            } catch (error) { console.error("Firebase ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error); }

            // --- 3. ë Œë”ë§ ---
            if (finalHTML === "") {
                resultsDiv.innerHTML = "<p class='text-center text-stone-600 bg-slate-50 p-4 rounded-lg'>ì¼ì¹˜í•˜ëŠ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            } else {
                resultsDiv.innerHTML = `<div class="max-h-60 overflow-y-auto pr-1 custom-scrollbar">${finalHTML}</div>`;
            }
        };

        document.getElementById('searchButton').addEventListener('click', window.searchAllPages);
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') window.searchAllPages();
        });
    </script>
</body>
</html>
