<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µë¶€ì ê°€ì´ë“œ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Config: Simple Wood Palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Wood Theme Colors
                        wood: {
                            50: '#FAF6F1',   // Background (Warm White)
                            100: '#EBE0D0',  // Light Beige
                            200: '#DCC8B0',  // Border Beige
                            300: '#B08D70',  // Soft Brown
                            500: '#8D6E63',  // Medium Brown
                            700: '#5D4037',  // Dark Brown (Primary Text)
                            800: '#4E342E',  // Deep Brown (Headings)
                            900: '#3E2723',  // Almost Black
                        },
                        // Role Colors (Earthy tones)
                        member: '#C27803',   // Gold/Amber
                        oesu: '#3B6888',     // Muted Blue
                        naesu: '#A84545',    // Muted Red
                    },
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                        serif: ['Noto Serif KR', 'serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Import Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;700&display=swap');
        
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #FAF6F1; 
            color: #4E342E;
        }
        
        h1, h2, h3, h4, h5, h6, .font-serif { font-family: 'Noto Serif KR', serif; }

        /* Clean Tab Styling */
        .tab-btn {
            position: relative;
            color: #B08D70;
            transition: color 0.2s ease;
        }
        .tab-active {
            color: #5D4037;
            font-weight: 700;
        }
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #5D4037;
        }
        .tab-inactive:hover {
            color: #8D6E63;
        }

        /* Timeline Line */
        .timeline-line::before {
            content: '';
            position: absolute;
            top: 24px;
            bottom: 24px;
            left: 15px;
            width: 2px;
            background-color: #EBE0D0;
            z-index: 0;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Current Item Highlight */
        .current-item {
            border-color: #8D6E63 !important;
            background-color: #FFFFFF !important;
            box-shadow: 0 4px 12px rgba(93, 64, 55, 0.08);
        }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-[#FAF6F1] border-b border-wood-200 sticky top-0 z-50">
        <div class="container mx-auto max-w-3xl px-4 py-4 flex justify-between items-center">
            <div class="flex flex-col">
                <h1 class="text-2xl font-bold font-serif text-wood-800 flex items-center gap-2">
                    <span class="text-wood-500">â–</span> ê³µë¶€ì ê°€ì´ë“œ
                </h1>
                <span class="text-xs text-wood-500 mt-1 tracking-wide">ì˜¤ëŠ˜ì˜ ë§ˆìŒê°€ì§: ì •ì„±</span>
            </div>
            
            <a href="index.html" class="text-sm font-bold text-wood-500 hover:text-wood-800 transition-colors flex items-center gap-1 border border-wood-200 px-3 py-1.5 rounded-lg bg-white">
                <span>ğŸ </span> <span class="hidden sm:inline">í™ˆìœ¼ë¡œ</span>
            </a>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-[#FAF6F1] border-b border-wood-200 sticky top-[77px] z-40">
        <div class="container mx-auto max-w-3xl flex">
            <button onclick="switchTab('schedule')" id="nav-schedule" class="flex-1 py-4 text-center tab-btn tab-active text-base md:text-lg">ì¼ê³¼í‘œ</button>
            <button onclick="switchTab('practice')" id="nav-practice" class="flex-1 py-4 text-center tab-btn tab-inactive text-base md:text-lg">ê°œë³„ ê³µë¶€ ë° ì—­í• </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto max-w-3xl px-4 py-8 flex-grow">

        <!-- SECTION 1: DAILY SCHEDULE -->
        <section id="view-schedule" class="space-y-8 animate-fade-in">
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 mb-8 pb-4 border-b border-wood-200">
                <div>
                    <h2 class="text-2xl font-bold text-wood-800 font-serif">í•˜ë£¨ì˜ íë¦„</h2>
                    <p class="text-wood-500 mt-2">
                        ëª¨ë“  ì§‘í•© ì‹œê°„ <span class="font-bold text-naesu">10~20ë¶„ ì „ ë„ì°©</span> ì›ì¹™
                    </p>
                </div>
                
                <!-- Sasu Toggle -->
                <label class="flex items-center gap-2 cursor-pointer select-none group bg-white px-3 py-2 rounded-lg border border-wood-200 shadow-sm">
                    <input type="checkbox" id="sasu-toggle" onchange="renderSchedule()" class="w-4 h-4 text-wood-700 rounded border-wood-300 focus:ring-wood-500 accent-wood-700">
                    <span class="text-sm font-medium text-wood-700">ì‚¬ìˆ˜ ì—­í•  í¬í•¨í•˜ê¸°</span>
                </label>
            </div>

            <!-- Timeline -->
            <div class="relative timeline-line pl-0 md:pl-2" id="timeline-container">
                <!-- Javascript will populate this -->
            </div>
        </section>

        <!-- SECTION 2: PRACTICE & ROLES -->
        <section id="view-practice" class="hidden space-y-8 animate-fade-in">
            
            <div class="pb-4 border-b border-wood-200 mb-8">
                <h2 class="text-2xl font-bold text-wood-800 font-serif mb-2">ë‚˜ì˜ ê³µë¶€ ë° ì—­í• </h2>
                <p class="text-wood-500">ì‹œê°„ íë¦„ì— ë”°ë¥¸ êµ¬ì²´ì ì¸ ì„ë¬´ì™€ ì ˆì°¨ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
            </div>

            <!-- Inputs Wrapper -->
            <div class="bg-white rounded-xl border border-wood-200 p-6 md:p-8 flex flex-col items-center gap-8 shadow-sm">
                
                <!-- Time Input -->
                <div class="flex flex-col md:flex-row items-center justify-center gap-4 w-full border-b border-wood-100 pb-8">
                    <span class="text-xl text-wood-700 font-serif font-bold">ë‚˜ëŠ”</span>
                    <div class="relative">
                        <input type="number" id="practice-hour" min="1" max="12" value="3" onchange="generateRitualTimeline()" 
                            class="text-5xl font-bold text-center w-24 border-b-2 border-wood-300 focus:border-wood-700 focus:outline-none bg-transparent transition-colors font-serif text-wood-800 p-1">
                    </div>
                    <span class="text-xl text-wood-700 font-serif font-bold">ì‹œ ê³µë¶€ìì…ë‹ˆë‹¤.</span>
                </div>

                <!-- Role Filter -->
                <div class="w-full max-w-xl">
                    <p class="text-center text-xs text-wood-400 mb-3 tracking-widest font-bold">â–¼ ì§ì±… ì„ íƒ</p>
                    <div class="grid grid-cols-4 gap-2 md:gap-4">
                        <button onclick="setRoleFilter('all')" id="btn-role-all" class="py-2 md:py-3 text-sm md:text-base rounded-lg transition-colors border border-wood-300 bg-wood-700 text-white font-medium shadow-sm">ì „ì²´</button>
                        <button onclick="setRoleFilter('member')" id="btn-role-member" class="py-2 md:py-3 text-sm md:text-base rounded-lg transition-colors border border-wood-200 hover:bg-wood-50 text-wood-600">íšŒì›</button>
                        <button onclick="setRoleFilter('oesu')" id="btn-role-oesu" class="py-2 md:py-3 text-sm md:text-base rounded-lg transition-colors border border-wood-200 hover:bg-wood-50 text-wood-600">ì™¸ìˆ˜</button>
                        <button onclick="setRoleFilter('naesu')" id="btn-role-naesu" class="py-2 md:py-3 text-sm md:text-base rounded-lg transition-colors border border-wood-200 hover:bg-wood-50 text-wood-600">ë‚´ìˆ˜</button>
                    </div>
                </div>
            </div>

            <!-- Steps Timeline -->
            <div id="ritual-steps" class="space-y-6 relative mt-8">
                <!-- Javascript will populate this -->
            </div>

            <!-- Core Rules -->
            <div class="mt-12 pt-8 border-t border-wood-200">
                <h3 class="font-bold text-xl text-wood-800 mb-6 font-serif">ì£¼ìš” ì¤€ìˆ˜ ì‚¬í•­</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex gap-4 items-center p-4 rounded-lg bg-white border border-wood-100 shadow-sm">
                        <span class="text-wood-500 text-xl">âœ”</span>
                        <div>
                            <span class="font-bold text-wood-800 block mb-1">ì‹œê°„ ì—„ìˆ˜</span>
                            <span class="text-sm text-wood-500">ëª¨ë“  ì§‘í•© 10~20ë¶„ ì „ ë„ì°©</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-4 rounded-lg bg-white border border-wood-100 shadow-sm">
                        <span class="text-wood-500 text-xl">âœ”</span>
                        <div>
                            <span class="font-bold text-wood-800 block mb-1">ì™¼ë°œ ë¨¼ì €</span>
                            <span class="text-sm text-wood-500">ê³„ë‹¨, ë¬¸í„± ë„˜ì„ ë•Œ í•­ìƒ ì™¼ë°œë¶€í„°</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-4 rounded-lg bg-white border border-wood-100 shadow-sm">
                        <span class="text-wood-500 text-xl">âœ”</span>
                        <div>
                            <span class="font-bold text-wood-800 block mb-1">ì •ìˆ™ (ë¬µì–¸)</span>
                            <span class="text-sm text-wood-500">ëŒ€ê¸° ì¤‘ ì¡ë‹´ ê¸ˆì§€</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-4 rounded-lg bg-white border border-wood-100 shadow-sm">
                        <span class="text-wood-500 text-xl">âœ”</span>
                        <div>
                            <span class="font-bold text-wood-800 block mb-1">êµ­ê¶ ìœ ì§€</span>
                            <span class="text-sm text-wood-500">ì´ë™ ì™„ë£Œ ì‹œê¹Œì§€ í—ˆë¦¬ ìˆ™ì¸ ìì„¸</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-4 rounded-lg bg-[#FFF8E1] border border-[#FFE082] shadow-sm md:col-span-2">
                        <span class="text-[#F57F17] text-xl">ğŸ“¢</span>
                        <div>
                            <span class="font-bold text-[#F57F17] block mb-1">ì£¼ë¬¸ ì—°ê²°</span>
                            <span class="text-sm text-[#F9A825]">ì£¼ë¬¸ì´ ëŠê¸°ì§€ ì•Šë„ë¡ ì• ì‹œê°„ ê³µë¶€ìì˜ ì£¼ì„±ì— ê·€ ê¸°ìš¸ì—¬ ì£¼ì„¸ìš”.</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="border-t border-wood-200 py-8 mt-8 text-center bg-white text-wood-500">
        <p class="font-bold font-serif mb-1 text-wood-700">ë¶€ì‚° íƒœê·¹ë„</p>
        <p class="text-xs">ì´ˆì‹¬ìë¥¼ ìœ„í•œ ìˆ˜ë ¨ ê°€ì´ë“œ</p>
    </footer>

    <!-- Logic -->
    <script>
        // Data
        const timelineItems = [
            { time: "01:30", title: "ì¶•ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "01:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "02:00", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
            { time: "07:15", title: "ê¸°ìƒ", loc: "-", note: "", role: "all" },
            { time: "07:30", title: "ì§„ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "07:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "07:50", title: "ì•„ì¹¨ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "08:15", title: "ë°©ì¥ íšŒì˜", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ í•„ìˆ˜ ì°¸ì„", role: "sasu" },
            { time: "09:00", title: "ì²­ì†Œ", loc: "ì§€ì • êµ¬ì—­", note: "", role: "learner_only" }, 
            { time: "09:00", title: "ì‚¬ìˆ˜ ê°ì˜¤", loc: "ë³„ê´€", note: "", role: "sasu" },
            { time: "10:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "10:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "10:30", title: "ì˜¤ì „ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "10:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "11:30", title: "ì ì‹¬ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "12:00", title: "í† ë¡ ", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "13:30", title: "ë¯¸ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "13:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "14:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "15:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "16:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "16:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "16:30", title: "ì˜¤í›„ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "16:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "17:00", title: "ì‚¬ìˆ˜ ë³´ê³ ", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ ì¼ì • ì¢…ë£Œ ë³´ê³ ", role: "sasu" },
            { time: "17:30", title: "ì €ë… ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "19:30", title: "ìˆ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "19:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "19:50", title: "ì²´ì¡°", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "20:00ê¹Œì§€", role: "all" },
            { time: "20:00", title: "ì‚¬ìˆ˜ êµëŒ€", loc: "ë³„ê´€", note: "ì†Œê° ë°œí‘œ", role: "sasu" },
            { time: "20:00", title: "ììœ ì‹œê°„", loc: "-", note: "í˜¹ì€ ì¼ëŒ€ì¼ ë§Œë‚¨", role: "learner_only" },
            { time: "23:30", title: "í‡´ë°° ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ ìŠ¹ì •ë¬¸", note: "23:20ê¹Œì§€ ì •ë ¬, í•˜ë£¨ ì¼ê³¼ ë§ˆë¬´ë¦¬", role: "all" },
            { time: "23:50", title: "í‡´ë°° ì¢…ë£Œ", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "ì¸ì‚¬ í›„ ê·€ê°€", role: "all" },
            { time: "24:00", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
        ];

        let currentTab = 'schedule';
        let currentRoleFilter = 'all';

        function switchTab(tabId) {
            ['schedule', 'practice'].forEach(id => {
                const view = document.getElementById(`view-${id}`);
                const nav = document.getElementById(`nav-${id}`);
                if(view) view.classList.add('hidden');
                if(nav) {
                    nav.classList.remove('tab-active');
                    nav.classList.add('tab-inactive');
                }
            });

            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${tabId}`);
            activeNav.classList.add('tab-active');
            activeNav.classList.remove('tab-inactive');
            
            currentTab = tabId;

            if(tabId === 'practice') {
                setRoleFilter(currentRoleFilter);
            } else if (tabId === 'schedule') {
                renderSchedule();
            }
        }

        function getCurrentTimeInMinutes() {
            const now = new Date();
            return now.getHours() * 60 + now.getMinutes();
        }

        function timeStringToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function renderSchedule() {
            const container = document.getElementById('timeline-container');
            const isSasuMode = document.getElementById('sasu-toggle').checked;
            const nowMinutes = getCurrentTimeInMinutes();
            
            const sortedItems = [...timelineItems].sort((a, b) => a.time.localeCompare(b.time));

            const filteredData = sortedItems.filter(item => {
                if (item.role === 'all') return true;
                if (item.role === 'sasu') return isSasuMode;
                if (item.role === 'learner_only') return !isSasuMode;
                return false;
            });
            
            let activeIndex = -1;
            for (let i = 0; i < filteredData.length; i++) {
                const itemTime = timeStringToMinutes(filteredData[i].time);
                if (nowMinutes >= itemTime) {
                    if (i < filteredData.length - 1) {
                        const nextItemTime = timeStringToMinutes(filteredData[i+1].time);
                        if (nowMinutes < nextItemTime) {
                            activeIndex = i;
                            break;
                        }
                    } else {
                        activeIndex = i;
                    }
                }
            }

            container.innerHTML = filteredData.map((item, index) => {
                const isSasuItem = item.role === 'sasu';
                const isActive = (index === activeIndex);
                
                let activeClass = isActive ? 'current-item border-l-4 border-wood-500' : 'bg-white border-l-4 border-transparent';
                let activeBadge = isActive ? `<div class="mb-2 text-xs font-bold text-wood-700 bg-wood-100 inline-block px-2 py-1 rounded border border-wood-200">â° í˜„ì¬ ì§„í–‰ì¤‘</div>` : '';
                
                // Override for Sasu
                if (isSasuItem && !isActive) {
                    activeClass = 'bg-wood-50 border-l-4 border-wood-300';
                }

                return `
                <div class="relative pl-10 md:pl-12 py-2 animate-fade-in group" id="schedule-item-${index}">
                    <!-- Dot -->
                    <div class="absolute left-[8px] top-6 w-6 h-6 rounded-full ${isActive ? 'bg-wood-700 scale-110' : (isSasuItem ? 'bg-wood-300' : 'bg-wood-200')} border-4 border-[#FAF6F1] shadow-sm z-10 transition-all flex items-center justify-center">
                        ${isActive ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                    </div>
                    
                    <!-- Content Card -->
                    <div class="${activeClass} p-5 rounded-lg border border-wood-100 transition-all shadow-sm">
                        ${activeBadge}
                        <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2">
                            <div>
                                <div class="flex items-baseline gap-3 mb-1">
                                    <span class="font-bold text-2xl ${isActive ? 'text-wood-900' : 'text-wood-700'} font-serif">${item.time}</span>
                                    ${item.loc !== '-' ? `<span class="text-sm font-bold text-wood-600 bg-wood-100 px-2 py-1 rounded">${item.loc}</span>` : ''}
                                </div>
                                <h3 class="text-xl font-bold text-wood-800 ${isSasuItem ? 'text-wood-600' : ''}">
                                    ${item.title}
                                    ${isSasuItem ? '<span class="text-xs bg-wood-200 text-wood-700 px-2 py-1 rounded-full ml-2 align-middle border border-wood-300">ì‚¬ìˆ˜</span>' : ''}
                                </h3>
                            </div>
                        </div>
                        ${item.note ? `<p class="text-base text-wood-600 mt-3 p-3 bg-[#FAF6F1] rounded border border-wood-200">ğŸ’¡ ${item.note}</p>` : ''}
                    </div>
                </div>
            `}).join('');
            
            if (activeIndex !== -1 && !window.hasScrolledToActive) {
                setTimeout(() => {
                    const el = document.getElementById(`schedule-item-${activeIndex}`);
                    if (el) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        window.hasScrolledToActive = true;
                    }
                }, 500);
            }
        }

        function setRoleFilter(role) {
            currentRoleFilter = role;
            
            // Minimal button styles
            const defaultStyle = "bg-white text-wood-500 border border-wood-200 hover:bg-wood-50 hover:text-wood-700 hover:border-wood-300";
            
            // Custom role specific active colors
            const styles = {
                all: "bg-wood-700 text-white border-wood-700 shadow-md font-bold",
                member: "bg-member text-white border-member shadow-md font-bold",
                oesu: "bg-oesu text-white border-oesu shadow-md font-bold",
                naesu: "bg-naesu text-white border-naesu shadow-md font-bold"
            };

            ['all', 'member', 'oesu', 'naesu'].forEach(r => {
                const btn = document.getElementById(`btn-role-${r}`);
                if (r === role) {
                    btn.className = `py-3 text-sm md:text-base rounded-lg transition-all ${styles[r]}`;
                } else {
                    btn.className = `py-3 text-sm md:text-base rounded-lg transition-all ${defaultStyle}`;
                }
            });

            generateRitualTimeline();
        }

        function generateRitualTimeline() {
            const inputHour = document.getElementById('practice-hour').value;
            if (!inputHour) return;

            const hour = parseInt(inputHour);
            const date = new Date();
            date.setHours(hour, 0, 0, 0);

            const fmt = (d) => {
                let h = d.getHours();
                let m = d.getMinutes();
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            };
            
            const addMin = (min) => {
                const newD = new Date(date.getTime());
                newD.setMinutes(date.getMinutes() + min);
                return fmt(newD);
            };

            const rawSteps = [
                { time: addMin(-15), title: "ì¤€ë¹„ ë° ì£¼ì„± ì—°ìŠµ", desc: "ëŒ€ê°•ì „ 1ì¸µ ë„ì°©, ì£¼ë¬¸ ì—°ìŠµ ì‹œì‘.", roleInfo: null },
                { time: addMin(20), title: "ì´ë™ ëŒ€ê¸° ë° ì¶œë°œ", desc: "ì£¼ë¬¸ ì—°ìŠµ ì¢…ë£Œ í›„ 3ì¸µìœ¼ë¡œ ì´ë™ ì¤€ë¹„.", highlight: true, roleInfo: { member: "1ì—´ (ê°€ì¥ ë¨¼ì € ì¶œë°œ)", oesu: "2ì—´ (íšŒì› ë’¤)", naesu: "3ì—´ (ë§ˆì§€ë§‰, ë¬¸ë‹¨ì†)" } },
                { time: addMin(25), title: "ê³µë¶€ë°© ì• ëŒ€ê¸° & ì…ì¥", desc: "ê³µë¶€ë°© ì• ë„ì°© ë° ì…ì¥.", roleInfo: { member: "ì‹ ë°œ ë²—ê³  1ë²ˆ ì…ì¥", oesu: "ì‹ ë°œ ì •ë¦¬, ë¬¸ ì—´ê¸°, 3ë²ˆ ì…ì¥", naesu: "2ë²ˆ ì…ì¥" } },
                { time: addMin(27), title: "êµëŒ€ ì‹ í˜¸", desc: "27ë¶„ 30ì´ˆê²½ ê³µë¶€ êµëŒ€ ì‹ í˜¸.", roleInfo: { member: "â˜… í¬ê²Œ í—›ê¸°ì¹¨ ì‹ í˜¸", oesu: "ëŒ€ê¸°", naesu: "ëŒ€ê¸°" } },
                { time: addMin(30), title: "ê³µë¶€ë°© ì…ì‹¤", desc: "ì¢…ì´ ìš¸ë¦¬ë©´ ë°©ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.", roleInfo: { member: "1ë²ˆ ì…ì¥. í–¥ ë¶ˆ ë¶™ì´ê¸°. ì¢Œë°° ì£¼ë„.", oesu: "3ë²ˆ ì…ì¥. ì†Œë…/ì²­ì†Œ.", naesu: "2ë²ˆ ì…ì¥. ì™¸ê³½ ì´ë™. ì†Œë…/ì²­ì†Œ." } },
                { time: addMin(90), title: "í‡´ì‹¤ ì¤€ë¹„", desc: "ë‹¤ìŒ íƒ€ì„ êµëŒ€ ë° í‡´ì‹¤.", roleInfo: { member: "ì¢Œë°° êµ¬ë ¹. ë¨¼ì € ë’¤ë¡œ ì´ë™.", oesu: "ë‚˜ì¤‘ ì´ë™. ì†ìˆ˜ê±´ ë’·ì‚¬ëŒ ì „ë‹¬.", naesu: "ë¨¼ì € ì´ë™. ì†ìˆ˜ê±´ ë’·ì‚¬ëŒ ì „ë‹¬." } },
                { time: addMin(95), title: "ì¢…ë£Œ ë° í•´ì‚°", desc: "ë¬¸ë‹¨ì† í›„ 1ì¸µì—ì„œ ì¸ì‚¬.", roleInfo: { member: "1ì¸µ ì´ë™.", oesu: "â˜… ë°”ê¹¥ ë¬¸ ë‹«ê¸°", naesu: "â˜… ì•ˆìª½ ë¬¸ ë‹«ê¸°" } }
            ];

            const container = document.getElementById('ritual-steps');
            
            container.innerHTML = rawSteps.map(step => {
                let roleHTML = '';
                
                if (currentRoleFilter !== 'all' && step.roleInfo) {
                    const info = step.roleInfo[currentRoleFilter];
                    if (info) {
                        let colorClass = 'bg-wood-100 text-wood-800';
                        if(currentRoleFilter === 'member') colorClass = 'bg-yellow-50 text-member border-l-4 border-member';
                        if(currentRoleFilter === 'oesu') colorClass = 'bg-blue-50 text-oesu border-l-4 border-oesu';
                        if(currentRoleFilter === 'naesu') colorClass = 'bg-red-50 text-naesu border-l-4 border-naesu';

                        roleHTML = `<div class="mt-4 p-4 rounded-r-lg text-lg font-bold shadow-sm ${colorClass}">${info}</div>`;
                    }
                } else if (currentRoleFilter === 'all' && step.roleInfo) {
                    roleHTML = `
                        <div class="mt-4 space-y-3 text-base">
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-12 text-center bg-member text-white font-bold text-sm px-1 py-0.5 rounded">íšŒì›</span> <span class="text-wood-700 font-medium">${step.roleInfo.member}</span></div>
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-12 text-center bg-oesu text-white font-bold text-sm px-1 py-0.5 rounded">ì™¸ìˆ˜</span> <span class="text-wood-700 font-medium">${step.roleInfo.oesu}</span></div>
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-12 text-center bg-naesu text-white font-bold text-sm px-1 py-0.5 rounded">ë‚´ìˆ˜</span> <span class="text-wood-700 font-medium">${step.roleInfo.naesu}</span></div>
                        </div>
                    `;
                }

                return `
                <div class="flex gap-4 group mb-2">
                    <div class="w-20 text-right pt-2 hidden md:block">
                        <span class="font-bold text-wood-700 font-serif text-2xl">${step.time}</span>
                    </div>
                    <div class="relative flex-grow border-l-4 border-wood-200 pl-6 pb-10 last:pb-0">
                        <!-- Dot -->
                        <div class="absolute -left-[10px] top-3 w-4 h-4 rounded-full bg-wood-200 border-2 border-white group-hover:bg-wood-400 transition-colors"></div>
                        
                        <div class="bg-white p-6 rounded-lg border border-wood-100 shadow-sm hover:shadow-md transition-shadow">
                            <div class="md:hidden font-bold text-wood-700 font-serif text-xl mb-1">${step.time}</div>
                            <h4 class="font-bold text-wood-800 text-xl font-serif mb-2">${step.title}</h4>
                            <p class="text-lg text-wood-600 leading-relaxed">${step.desc}</p>
                            ${roleHTML}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        window.onload = function() {
            renderSchedule();
            setInterval(renderSchedule, 60000);
        };
    </script>
</body>
</html>
