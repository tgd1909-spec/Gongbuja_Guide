<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µë¶€ì ê°€ì´ë“œ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Config: Korean Minimalist Teal Theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'k-bg': '#fdfbf7',      // í•œì§€ ë°°ê²½ìƒ‰
                        'k-text': '#1a1a1a',    // ì§„í•œ ë¨¹ìƒ‰ í…ìŠ¤íŠ¸
                        'theme': {
                            DEFAULT: '#0f766e', // ì²­ììƒ‰ (Teal)
                            light: '#115e59',
                            50: '#f0fdfa',      // teal-50
                            100: '#ccfbf1',     // teal-100
                        },
                        'sub': '#4a4a4a',
                        
                        // ì—­í• ë³„ ìƒ‰ìƒ ìœ ì§€
                        member: '#d97706',
                        oesu: '#2563eb',
                        naesu: '#dc2626',
                    },
                    fontFamily: {
                        serif: ['"Noto Serif KR"', 'serif'],
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                    },
                    backgroundImage: {
                        'hanji-pattern': 'radial-gradient(#e6e2d3 1px, transparent 1px)',
                    },
                    backgroundSize: {
                        'hanji-size': '24px 24px',
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                        'paper': '0 10px 30px -5px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@400;600;700&display=swap');
        
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #fdfbf7; 
            color: #1a1a1a;
            /* Hanji Pattern applied via Tailwind config class */
        }
        
        h1, h2, h3, h4, h5, h6, .font-serif { font-family: 'Noto Serif KR', serif; }
        .break-keep { word-break: keep-all; }

        /* Card & Box Styles */
        .white-box {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Interactive Elements */
        .interactive-item {
            transition: all 0.2s ease;
            cursor: pointer;
            border: 2px solid #e5e5e5;
            background-color: white;
        }
        .interactive-item:hover {
            border-color: #0f766e; /* theme color */
            background-color: #f0fdfa; /* theme-50 */
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.15);
        }

        /* Badge Style */
        .badge-theme {
            display: inline-flex;
            align-items: center;
            background-color: rgba(15, 118, 110, 0.1);
            color: #0f766e;
            padding: 0.2rem 0.6rem;
            border-radius: 9999px;
            font-weight: 700;
            font-size: 0.8rem;
        }

        /* Timeline Line */
        .timeline-line::before {
            content: '';
            position: absolute;
            top: 24px;
            bottom: 24px;
            left: 23px;
            width: 2px;
            background-color: #cbd5e1; /* slate-300 */
            z-index: 0;
        }

        /* Navigation */
        .nav-btn {
            background-color: transparent; /* Changed to transparent for hanji bg */
            border-bottom: 3px solid transparent;
            color: #78716c;
            font-weight: 500;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .nav-btn:hover {
            color: #0f766e;
            background-color: rgba(240, 253, 250, 0.3);
        }
        .nav-active {
            color: #0f766e;
            border-bottom: 3px solid #0f766e;
            font-weight: 700;
            background-color: rgba(240, 253, 250, 0.5); /* subtle teal bg */
        }
        .nav-active svg {
            stroke-width: 2.5px;
        }

        /* Current Item Highlight */
        .current-item {
            border: 2px solid #0f766e !important;
            background-color: #ffffff !important;
            box-shadow: 0 8px 20px rgba(15, 118, 110, 0.1) !important;
        }

        /* Custom Scrollbar hide for nav */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-k-bg bg-hanji-pattern bg-[length:24px_24px] min-h-screen flex flex-col items-center">

    <!-- Central Container -->
    <div class="w-full max-w-4xl bg-k-bg bg-hanji-pattern bg-[length:24px_24px] min-h-screen shadow-paper border-x border-stone-100 flex flex-col relative">
        
        <!-- Header -->
        <header class="sticky top-0 z-50 bg-k-bg/95 backdrop-blur-sm border-b border-stone-200 px-6 py-5">
            <div class="flex justify-between items-start">
                <div class="flex flex-col gap-2">
                    <a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
                        <!-- Modern Guide Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-theme flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        <h1 class="text-2xl md:text-3xl font-serif font-bold text-k-text tracking-tight break-keep">ê³µë¶€ì ê°€ì´ë“œ</h1>
                    </a>
                    <!-- Divider -->
                    <div class="h-1 w-12 bg-theme rounded-full"></div>
                    <p class="text-sm text-sub font-medium mt-1">ì˜¤ëŠ˜ì˜ ë§ˆìŒê°€ì§: ì •ì„±(ç²¾èª )</p>
                </div>

                <!-- Home Button (Responsive) -->
                <a href="index.html" class="group flex items-center gap-2 px-3 py-2 md:px-4 bg-white border border-stone-200 rounded-lg hover:border-theme hover:text-theme transition-colors shadow-sm shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sub group-hover:text-theme transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    <span class="hidden md:inline text-sm font-bold text-sub group-hover:text-theme whitespace-nowrap">í™ˆìœ¼ë¡œ</span>
                </a>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-k-bg/95 border-b border-stone-200 sticky top-[105px] md:top-[97px] z-40">
            <div class="flex no-scrollbar overflow-x-auto">
                <button onclick="switchTab('schedule')" id="nav-schedule" class="flex-1 py-4 px-6 text-center nav-btn nav-active whitespace-nowrap text-lg">
                    <!-- Calendar Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    <span>ì¼ê³¼í‘œ</span>
                </button>
                <button onclick="switchTab('practice')" id="nav-practice" class="flex-1 py-4 px-6 text-center nav-btn whitespace-nowrap text-lg">
                    <!-- Book Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    <span>ê³µë¶€ ë° ì—­í• </span>
                </button>
                <button onclick="switchTab('simulator')" id="nav-simulator" class="flex-1 py-4 px-6 text-center nav-btn whitespace-nowrap text-lg">
                    <!-- Cube/Simulation Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                    <span>ì‹œë®¬ë ˆì´í„°</span>
                </button>
            </div>
        </nav>

        <!-- Main Content (Background is Hanji, Boxes are White) -->
        <main class="flex-grow p-6 md:p-10">

            <!-- SECTION 1: DAILY SCHEDULE -->
            <section id="view-schedule" class="space-y-10 animate-fade-in">
                
                <div class="white-box p-8">
                    <div class="flex flex-col gap-4 border-b border-stone-100 pb-6 mb-6">
                        <div class="flex items-center gap-2">
                            <span class="badge-theme">ì•ˆë‚´</span>
                            <h2 class="text-2xl font-serif font-bold text-k-text">í•˜ë£¨ì˜ íë¦„</h2>
                        </div>
                        <p class="text-lg text-sub font-medium leading-relaxed break-keep">
                            ê·œì¹™ì ì¸ íë¦„ ì†ì—ì„œ ë§ˆìŒì„ ë§‘ê²Œ í•˜ì„¸ìš”.<br>
                            ëª¨ë“  ì§‘í•© ì‹œê°„ <strong class="text-theme border-b-2 border-theme/20">10~20ë¶„ ì „</strong>ê¹Œì§€ ë¯¸ë¦¬ ë„ì°©í•˜ì—¬ ì¤€ë¹„í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    
                    <div class="flex flex-wrap gap-4">
                        <label class="interactive-item flex items-center gap-3 px-5 py-4 rounded-lg flex-grow md:flex-grow-0">
                            <input type="checkbox" id="sunday-toggle" onchange="toggleSundayMode(this.checked)" class="w-5 h-5 text-theme rounded border-stone-300 focus:ring-theme accent-theme">
                            <span class="text-base font-bold text-k-text">ì£¼ì¼ ì¼ì • ë³´ê¸°</span>
                        </label>

                        <label class="interactive-item flex items-center gap-3 px-5 py-4 rounded-lg flex-grow md:flex-grow-0">
                            <input type="checkbox" id="sasu-toggle" onchange="renderSchedule()" class="w-5 h-5 text-theme rounded border-stone-300 focus:ring-theme accent-theme">
                            <span class="text-base font-bold text-k-text">ì‚¬ìˆ˜ ì—­í•  í¬í•¨í•˜ê¸°</span>
                        </label>
                    </div>
                </div>

                <!-- Next Step Button (Top) -->
                <button onclick="switchTab('practice')" class="w-full bg-white border-2 border-theme text-theme hover:bg-theme hover:text-white py-4 rounded-xl text-lg font-bold shadow-md transition-all flex items-center justify-center gap-2 group">
                    <span>ë‹¤ìŒ ë‹¨ê³„: ë‚˜ì˜ ê³µë¶€ ë° ì—­í•  í™•ì¸í•˜ê¸°</span>
                    <!-- Arrow Right Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </button>

                <!-- Timeline -->
                <div class="relative timeline-line pl-2" id="timeline-container">
                    <!-- Javascript will populate this -->
                </div>

                <!-- Next Step Button (Bottom) -->
                <button onclick="switchTab('practice')" class="w-full bg-white border-2 border-theme text-theme hover:bg-theme hover:text-white py-5 rounded-xl text-xl font-bold shadow-md transition-all flex items-center justify-center gap-2 group mt-10">
                    <span>ë‹¤ìŒ ë‹¨ê³„: ë‚˜ì˜ ê³µë¶€ ë° ì—­í•  í™•ì¸í•˜ê¸°</span>
                    <!-- Arrow Right Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </button>
            </section>

            <!-- SECTION 2: PRACTICE & ROLES -->
            <section id="view-practice" class="hidden space-y-10 animate-fade-in">
                
                <!-- ì•ˆë‚´ -->
                <div class="white-box p-8 border-l-4 border-l-theme">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="badge-theme">ì¤‘ìš”</span>
                        <h2 class="text-2xl font-serif font-bold text-k-text">ë‚˜ì˜ ê³µë¶€ ë° ì—­í• </h2>
                    </div>
                    <p class="text-lg text-sub font-medium leading-relaxed break-keep">
                        ì‹œê°„ íë¦„ì— ë”°ë¥¸ êµ¬ì²´ì ì¸ ì„ë¬´ì™€ ì ˆì°¨ë¥¼ í™•ì¸í•˜ì„¸ìš”.<br>
                        <strong class="text-theme">ëª¨ë“  í–‰ë™ì€ íšŒì›ì„ ì¤‘ì‹¬ìœ¼ë¡œ ë§ì¶”ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</strong>
                    </p>
                </div>

                <!-- Core Rules (Moved to Top) -->
                <div class="space-y-10">
                    <!-- 1. Daegangjeon Precautions -->
                    <section>
                        <h3 class="font-bold text-xl text-k-text mb-5 font-serif flex items-center gap-2 border-b border-stone-300 pb-3">
                            <span class="text-2xl">ğŸ›ï¸</span> ëŒ€ê°•ì „ ë‚´ ì£¼ì˜ì‚¬í•­
                        </h3>
                        <div class="white-box p-6 md:p-8">
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-y-8 gap-x-6">
                                <div class="flex flex-col gap-2">
                                    <div class="flex items-center gap-2">
                                        <span class="badge-theme">ë©´ìˆ˜</span>
                                    </div>
                                    <p class="text-sm text-sub leading-snug pl-1 break-keep">ë°”ë¥´ê²Œ ì„œì„œ í„±ì„ ì‚´ì§ ë‹¹ê²¨ ì‹œì„ ì„ ì•„ë˜ìª½ìœ¼ë¡œ ì²˜ë¦¬í•œ ìì„¸</p>
                                </div>
                                <div class="flex flex-col gap-2">
                                    <div class="flex items-center gap-2">
                                        <span class="badge-theme">ì–‘ìˆ˜êµì§€</span>
                                    </div>
                                    <p class="text-sm text-sub leading-snug pl-1 break-keep">ì—„ì§€ ì†ê°€ë½ì„ êµì°¨í•˜ì—¬ ì†ì„ ëª¨ìœ¼ê³  ìˆëŠ” ìì„¸</p>
                                </div>
                                <div class="flex items-center gap-3 text-base text-k-text font-bold bg-stone-50 px-4 py-3 rounded-lg border border-stone-200">
                                    <span class="text-theme text-xs">â—</span> í°ì†Œë¦¬ ë‚´ì§€ ì•Šê¸°
                                </div>
                                <div class="flex items-center gap-3 text-base text-k-text font-bold bg-stone-50 px-4 py-3 rounded-lg border border-stone-200">
                                    <span class="text-theme text-xs">â—</span> ë›°ì§€ ì•Šê¸°
                                </div>
                                <div class="flex items-center gap-3 text-base text-k-text font-bold bg-stone-50 px-4 py-3 rounded-lg border border-stone-200">
                                    <span class="text-theme text-xs">â—</span> ì¡ë‹´í•˜ì§€ ì•Šê¸°
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Next Step Button (Top) -->
                <button onclick="switchTab('simulator')" class="w-full bg-white border-2 border-theme text-theme hover:bg-theme hover:text-white py-4 rounded-xl text-lg font-bold shadow-md transition-all flex items-center justify-center gap-2 group">
                    <span>ë‹¤ìŒ ë‹¨ê³„: ì…ì‹¤ ì‹œë®¬ë ˆì´í„° ì²´í—˜í•˜ê¸°</span>
                    <!-- Arrow Right Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </button>

                <!-- Inputs Wrapper -->
                <div class="white-box p-8 md:p-10 flex flex-col items-center gap-8">
                    <div class="w-full flex justify-end">
                        <label class="interactive-item inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm">
                            <input type="checkbox" id="practice-sunday-toggle" onchange="toggleSundayMode(this.checked)" class="w-4 h-4 text-theme rounded border-stone-300 focus:ring-theme accent-theme">
                            <span class="font-bold text-sub">ì£¼ì¼ ì¼ì • ë°˜ì˜</span>
                        </label>
                    </div>

                    <!-- Time Input -->
                    <div class="flex flex-col md:flex-row items-center justify-center gap-4 w-full bg-stone-50 p-6 rounded-xl border border-stone-200">
                        <span class="text-xl text-k-text font-serif font-bold">ë‚˜ëŠ”</span>
                        <div class="relative">
                            <input type="number" id="practice-hour" min="1" max="12" value="3" onchange="generateRitualTimeline()" 
                                class="text-4xl font-bold text-center w-28 border-b-2 border-stone-300 focus:border-theme focus:outline-none bg-transparent transition-colors font-serif text-theme p-2">
                        </div>
                        <span class="text-xl text-k-text font-serif font-bold">ì‹œ ê³µë¶€ìì…ë‹ˆë‹¤.</span>
                    </div>

                    <!-- Role Filter -->
                    <div class="w-full max-w-2xl">
                        <div class="text-center mb-4">
                            <span class="text-xs font-bold text-theme tracking-widest uppercase">Select Role</span>
                        </div>
                        <div class="grid grid-cols-4 gap-3">
                            <button onclick="setRoleFilter('all')" id="btn-role-all" class="py-3 rounded-lg border-2 border-theme bg-theme text-white font-bold shadow-md hover:opacity-90 transition-all">ì „ì²´</button>
                            <button onclick="setRoleFilter('member')" id="btn-role-member" class="interactive-item py-3 rounded-lg text-sub font-bold hover:text-theme">íšŒì›</button>
                            <button onclick="setRoleFilter('oesu')" id="btn-role-oesu" class="interactive-item py-3 rounded-lg text-sub font-bold hover:text-theme">ì™¸ìˆ˜</button>
                            <button onclick="setRoleFilter('naesu')" id="btn-role-naesu" class="interactive-item py-3 rounded-lg text-sub font-bold hover:text-theme">ë‚´ìˆ˜</button>
                        </div>
                    </div>
                </div>

                <!-- Steps Timeline -->
                <div id="ritual-steps" class="space-y-6 relative mt-8">
                    <!-- Javascript will populate this -->
                </div>

                <!-- Next Step Button (Bottom) -->
                <button onclick="switchTab('simulator')" class="w-full bg-white border-2 border-theme text-theme hover:bg-theme hover:text-white py-5 rounded-xl text-xl font-bold shadow-md transition-all flex items-center justify-center gap-2 group mt-12">
                    <span>ë‹¤ìŒ ë‹¨ê³„: ì…ì‹¤ ì‹œë®¬ë ˆì´í„° ì²´í—˜í•˜ê¸°</span>
                    <!-- Arrow Right Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                </button>
            </section>

            <!-- SECTION 3: SIMULATOR -->
            <section id="view-simulator" class="hidden space-y-10 animate-fade-in">
                <div class="white-box p-8">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="badge-theme">êµìœ¡</span>
                        <h2 class="text-2xl font-serif font-bold text-k-text">ê³µë¶€ë°© ì…ì‹¤ ì‹œë®¬ë ˆì´í„°</h2>
                    </div>
                    <div class="space-y-6">
                        <p class="text-lg text-sub font-medium leading-relaxed">
                            ë³µì¡í•œ ì…ì‹¤ ë™ì„ ì„ ì‹œê°ì ìœ¼ë¡œ ìµí˜€ë³´ì„¸ìš”.<br>
                            íšŒì›ê³¼ ë‚´ìˆ˜ëŠ” ë’¤ë¡œ ë¬¼ëŸ¬ë‚˜ê³ , ë“¤ì–´ì˜¤ëŠ” ì‚¬ëŒì€ ê¸°ì¡´ ì‚¬ëŒë“¤ì˜ ë’¤ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
                        </p>
                        
                        <div class="bg-stone-50 border border-stone-200 rounded-lg p-6 text-base text-k-text font-medium leading-loose">
                            <ul class="list-disc pl-5 space-y-3">
                                <li><strong class="text-theme bg-white px-2 py-0.5 rounded border border-stone-200 shadow-sm">ê³¼í•œ ì¸ì‚¬ ì§€ì–‘</strong> ì…ì‹¤ í›„ì—ëŠ” ë„ˆë¬´ ê³¼í•œ ì¸ì‚¬ë¥¼ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¢Œë°°(åæ‹œ)ë¡œ ì‹œì‘í•´ì„œ ì¢Œë°°ë¡œ ëë‚  ìˆ˜ ìˆë„ë¡ ê³¼í•œ ë¶€ë³µ(ì—ë“œë ¤ ì ˆí•¨)ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
                                <li><strong class="text-theme bg-white px-2 py-0.5 rounded border border-stone-200 shadow-sm">íšŒì›ì—ê²Œ ì†ë„ ë§ì¶¤</strong> ì˜†ì˜ íšŒì›ì´ ìë¦¬ì— ì•‰ìœ¼ë©´ ì²­ì†Œë¥¼ ë©ˆì¶”ê³  ì •ëˆí•©ë‹ˆë‹¤. ëª¨ë“  í–‰ë™ì˜ ì†ë„ëŠ” íšŒì›ì—ê²Œ ë§ì¶°ì•¼ í•©ë‹ˆë‹¤.</li>
                                <li><strong class="text-theme bg-white px-2 py-0.5 rounded border border-stone-200 shadow-sm">êµëŒ€ ì‹œ ê±°ë¦¬ í™•ë³´</strong> íšŒì›ê³¼ ë‚´ìˆ˜ê°€ ì—‰ë©ì´ë¥¼ ë’¤ë¡œ ë¬¼ë¦´ ë•Œ, ë‹¤ìŒ ê³µë¶€ìê°€ ì§€ë‚˜ê°ˆ ìˆ˜ ìˆëŠ” ê±°ë¦¬ë¥¼ í™•ë³´í•˜ê³  ë¬¼ëŸ¬ë‚˜ì•¼ í•©ë‹ˆë‹¤. ë„ˆë¬´ ë’¤ë¡œ ë¬¼ëŸ¬ë‚˜ë©´ ë²½ê³¼ì˜ ê³µê°„ì´ ì—†ì–´ í†µí–‰ì´ ì–´ë µìŠµë‹ˆë‹¤.</li>
                                <!-- ì£¼ë¬¸ ì—°ê²° í•­ëª©ì´ ì´ê³³ìœ¼ë¡œ ì´ë™ë¨ -->
                                <li><strong class="text-theme bg-white px-2 py-0.5 rounded border border-stone-200 shadow-sm">ì£¼ë¬¸ ì—°ê²°</strong> ì£¼ë¬¸ì´ ëŠê¸°ì§€ ì•Šë„ë¡ ì• ì‹œê°„ ê³µë¶€ìì˜ ì£¼ì„±ì— ê·€ ê¸°ìš¸ì—¬ ì£¼ì„¸ìš”.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="white-box p-6 shadow-lg flex flex-col items-center">
                    <div class="relative w-full max-w-[500px] aspect-square bg-[#F5F5DC] border-4 border-[#8D6E63] rounded-lg mb-6 overflow-hidden shadow-inner">
                        <!-- Table -->
                        <div class="absolute top-0 left-[60%] -translate-x-1/2 w-1/3 h-3 bg-[#5D4037] rounded-b-md shadow-sm"></div>
                        <div class="absolute top-4 left-[60%] -translate-x-1/2 text-[#5D4037] text-sm font-bold bg-[#F5F5DC]/80 px-2 rounded">í–¥ íƒì (ì•)</div>
                        <div class="absolute top-1/2 left-0 -translate-y-1/2 w-3 h-20 bg-[#3E2723] rounded-r shadow-md"></div>
                        <div class="absolute top-1/2 left-5 -translate-y-1/2 text-[#3E2723] text-sm font-bold -rotate-90">ì¶œì…ë¬¸</div>
                        <canvas id="simCanvas" width="500" height="500" class="w-full h-full"></canvas>
                    </div>

                    <div class="w-full max-w-[500px] flex flex-col gap-4">
                        <div class="bg-stone-50 p-6 rounded-xl border border-stone-200 min-h-[100px] flex items-center justify-center text-center shadow-sm">
                            <p id="step-description" class="text-lg font-bold text-k-text transition-all break-keep leading-relaxed">ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
                        </div>

                        <div class="flex justify-between gap-3">
                            <button onclick="simController.prev()" class="interactive-item flex-1 py-4 text-lg text-k-text rounded-lg font-bold bg-white">â—€ ì´ì „</button>
                            <button onclick="simController.play()" class="interactive-item flex-1 py-4 text-lg text-white rounded-lg font-bold bg-theme border-theme hover:bg-theme-light">â–¶ ì¬ìƒ/ì •ì§€</button>
                            <button onclick="simController.next()" class="interactive-item flex-1 py-4 text-lg text-k-text rounded-lg font-bold bg-white">ë‹¤ìŒ â–¶</button>
                        </div>
                        <button onclick="simController.reset()" class="w-full py-3 text-sub font-medium hover:text-theme text-sm underline decoration-stone-300 underline-offset-4">â†º ì²˜ìŒìœ¼ë¡œ ë¦¬ì…‹</button>
                    </div>
                </div>
            </section>

        </main>
        
        <!-- Floating Scroll Buttons -->
        <div class="fixed bottom-8 right-8 z-50 flex flex-col gap-3">
            <!-- Top Scroll -->
            <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-3 bg-white border-2 border-stone-200 rounded-full shadow-lg text-[#0f766e] hover:bg-[#0f766e] hover:text-white hover:border-[#0f766e] transition-all" aria-label="ë§¨ ìœ„ë¡œ">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
                </svg>
            </button>
            <!-- Bottom Scroll -->
            <button onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})" class="p-3 bg-white border-2 border-stone-200 rounded-full shadow-lg text-[#0f766e] hover:bg-[#0f766e] hover:text-white hover:border-[#0f766e] transition-all" aria-label="ë§¨ ì•„ë˜ë¡œ">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Script Logic -->
    <script>
        let isGlobalSundayMode = false;

        // Data - Weekday Schedule
        const weekdayItems = [
            // --- ì…ì‹¤ ë‹¹ì¼ (ì „ë‚  ì €ë…) ---
            { time: "20:00", title: "ì‚¬ìˆ˜ êµëŒ€", loc: "ë³„ê´€", note: "ì†Œê° ë°œí‘œ", role: "sasu" },
            { time: "20:00", title: "ììœ ì‹œê°„", loc: "-", note: "í˜¹ì€ ì¼ëŒ€ì¼ ë§Œë‚¨", role: "learner_only" },
            { time: "20:30", title: "ê³µì§€ì‚¬í•­ ë° ëª…ìƒ", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "21:10ê¹Œì§€ ì§„í–‰", role: "all" },
            { time: "21:30", title: "ì í˜¸", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "ì í˜¸ ì „ê¹Œì§€ í˜ˆì•• ì²´í¬ ì™„ë£Œí•˜ê¸°", role: "all" },
            { time: "22:30", title: "ë“œëŠ” ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ ìŠ¹ì •ë¬¸ ì•", note: "22:20ê¹Œì§€ ì‹œë¦½", role: "all" },
            { time: "23:30", title: "í‡´ë°° ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ ìŠ¹ì •ë¬¸", note: "23:20ê¹Œì§€ ì •ë ¬, í•˜ë£¨ ì¼ê³¼ ë§ˆë¬´ë¦¬", role: "all" },
            { time: "23:50", title: "í‡´ë°° ì¢…ë£Œ", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "ì¸ì‚¬ í›„ ê·€ê°€", role: "all" },
            { time: "24:00", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
            // --- ê³µë¶€ ë‹¹ì¼ ---
            { time: "01:30", title: "ì¶•ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "01:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "02:00", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
            { time: "07:10", title: "ì²´ì¡°", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "", role: "all" },
            { time: "07:30", title: "ì§„ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "07:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "07:50", title: "ì•„ì¹¨ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "08:15", title: "ë°©ì¥ íšŒì˜", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ í•„ìˆ˜ ì°¸ì„", role: "sasu" },
            { time: "08:27", title: "ì²´ì¡°", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "08:35", title: "ê³µì§€ì‚¬í•­", loc: "ì²­í•™ê´€", note: "08:40ê¹Œì§€", role: "all" },
            { time: "08:40", title: "ì²­ì†Œ", loc: "ì§€ì • êµ¬ì—­", note: "09:20ê¹Œì§€ ì§„í–‰", role: "learner_only" }, 
            { time: "08:50", title: "ì‚¬ìˆ˜ íšŒì˜", loc: "ë³„ê´€", note: "", role: "sasu" },
            { time: "10:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "10:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "10:30", title: "ì˜¤ì „ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "10:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "11:30", title: "ì ì‹¬ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "12:00", title: "í† ë¡ ", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "13:30", title: "ë¯¸ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "13:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "14:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "15:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "16:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "16:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "16:30", title: "ì˜¤í›„ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "16:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "17:00", title: "ì‚¬ìˆ˜ íšŒì˜", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ ì¼ì • ì¢…ë£Œ ë³´ê³ ", role: "sasu" },
            { time: "17:30", title: "ì €ë… ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "19:30", title: "ìˆ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "19:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "19:50", title: "ì²´ì¡°", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "20:00ê¹Œì§€", role: "all" }
        ];

        // Data - Sunday Schedule
        const sundayItems = [
            // --- ì…ì‹¤ ë‹¹ì¼ (ì£¼ì¼ ì „ë‚  ì €ë…) ---
            { time: "20:00", title: "ììœ ì‹œê°„", loc: "-", note: "í˜¹ì€ ì¼ëŒ€ì¼ ë§Œë‚¨", role: "all" },
            { time: "20:00", title: "ì‚¬ìˆ˜ êµëŒ€", loc: "ë³„ê´€ 1ì¸µ", note: "ì‚¬ìˆ˜ í•„ìˆ˜ ì°¸ì„", role: "sasu" },
            { time: "20:30", title: "ê³µì§€ì‚¬í•­", loc: "ë³„ê´€ 1ì¸µ", note: "ë“¤ì–´ì˜¨ ê³µë¶€ìë§Œ 21:00ê¹Œì§€ ì§„í–‰", role: "all" },
            { time: "20:30", title: "ëª…ìƒ", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "21:10ê¹Œì§€ ì§„í–‰", role: "all" },
            { time: "21:30", title: "ì í˜¸", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "21:20ë¶„ê¹Œì§€ ëŒ€ê¸°. ì í˜¸ ì „ê¹Œì§€ í˜ˆì•• ì²´í¬ ì™„ë£Œí•˜ê¸°", role: "all" },
            { time: "22:30", title: "ë“œëŠ” ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "22:20ê¹Œì§€ ìŠ¹ì •ë¬¸ ì• ëŒ€ê¸°", role: "all" },
            { time: "23:30", title: "ìì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "ì£¼ì¼ ë“œëŠ” ë‚ , 23:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "23:30", title: "í‡´ë°° ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "23:20ê¹Œì§€ ìŠ¹ì •ë¬¸ ì• ëŒ€ê¸°", role: "all" },
            // --- ê³µë¶€ ë‹¹ì¼ (ì£¼ì¼) ---
            { time: "01:30", title: "ì¶•ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "01:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "05:30", title: "ë¬˜ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "05:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "07:10", title: "ì•„ì¹¨ ì²´ì¡°", loc: "-", note: "", role: "all" },
            { time: "07:30", title: "ì§„ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "07:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "07:50", title: "ì•„ì¹¨ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "08:15", title: "ë°©ì¥ íšŒì˜", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ í•„ìˆ˜ ì°¸ì„", role: "sasu" },
            { time: "09:50", title: "ì‚¬ìˆ˜ íšŒì˜", loc: "ë³„ê´€", note: "", role: "sasu" },
            { time: "09:00", title: "ì²­ì†Œ", loc: "ì§€ì • êµ¬ì—­", note: "", role: "learner_only" },
            { time: "10:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "10:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "10:30", title: "ì˜¤ì „ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "10:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "11:30", title: "ì˜¤ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "", role: "all" },
            { time: "12:00", title: "ì ì‹¬ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "12:20", title: "í† ë¡ ", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "13:30", title: "ë¯¸ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "13:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "14:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "15:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "16:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "16:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "16:30", title: "ì˜¤í›„ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "16:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "17:00", title: "ì‚¬ìˆ˜ íšŒì˜", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ ì¼ì • ì¢…ë£Œ ë³´ê³ ", role: "sasu" },
            { time: "17:30", title: "ìœ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "17:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "18:00", title: "ì €ë… ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "19:30", title: "ìˆ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "19:20ê¹Œì§€ ëŒ€ê¸° ë° ëª…ìƒ", role: "all" },
            { time: "19:50", title: "ì²´ì¡°", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "20:00ê¹Œì§€", role: "all" }
        ];

        let currentTab = 'schedule';
        let currentRoleFilter = 'all';

        function switchTab(tabId) {
            ['schedule', 'practice', 'simulator'].forEach(id => {
                const view = document.getElementById(`view-${id}`);
                const nav = document.getElementById(`nav-${id}`);
                if(view) view.classList.add('hidden');
                if(nav) {
                    nav.classList.remove('nav-active');
                }
            });

            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${tabId}`);
            activeNav.classList.add('nav-active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            currentTab = tabId;

            if(tabId === 'practice') {
                setRoleFilter(currentRoleFilter);
            } else if (tabId === 'schedule') {
                renderSchedule();
            } else if (tabId === 'simulator') {
                if(ctx) simController.init();
            }
        }

        function getCurrentTimeInMinutes() {
            const now = new Date();
            return now.getHours() * 60 + now.getMinutes();
        }

        function timeStringToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function isSundayCycle() {
            return false;
        }

        function toggleSundayMode(checked) {
            isGlobalSundayMode = checked;
            const sundayToggle = document.getElementById('sunday-toggle');
            if(sundayToggle) sundayToggle.checked = checked;
            const practiceSundayToggle = document.getElementById('practice-sunday-toggle');
            if(practiceSundayToggle) practiceSundayToggle.checked = checked;

            if(currentTab === 'schedule') renderSchedule();
            if(currentTab === 'practice') generateRitualTimeline();
        }

        function renderSchedule() {
            const container = document.getElementById('timeline-container');
            const isSasuMode = document.getElementById('sasu-toggle').checked;
            const nowMinutes = getCurrentTimeInMinutes();
            
            let itemsToRender = isGlobalSundayMode ? [...sundayItems] : [...weekdayItems];

            const filteredData = itemsToRender.filter(item => {
                if (item.role === 'all') return true;
                if (item.role === 'sasu') return isSasuMode;
                if (item.role === 'learner_only') return !isSasuMode;
                return false;
            });
            
            let activeIndex = -1;
            for (let i = 0; i < filteredData.length; i++) {
                const itemTime = timeStringToMinutes(filteredData[i].time);
                const isLast = (i === filteredData.length - 1);
                
                if (isLast) {
                    if (nowMinutes >= itemTime) activeIndex = i;
                } else {
                    const nextItemTime = timeStringToMinutes(filteredData[i+1].time);
                    if (itemTime <= nextItemTime) {
                        if (nowMinutes >= itemTime && nowMinutes < nextItemTime) {
                            activeIndex = i;
                            break;
                        }
                    } else {
                        if (nowMinutes >= itemTime || nowMinutes < nextItemTime) {
                            activeIndex = i;
                            break;
                        }
                    }
                }
            }

            container.innerHTML = filteredData.map((item, index) => {
                const isSasuItem = item.role === 'sasu';
                const isActive = (index === activeIndex);
                
                let activeClass = isActive ? 'current-item' : 'bg-white border-l-4 border-transparent';
                let activeBadge = isActive ? `<div class="mb-3 text-xs font-bold text-theme bg-teal-50 inline-block px-3 py-1 rounded-full border border-teal-100 animate-pulse">â° í˜„ì¬ ì§„í–‰ì¤‘</div>` : '';
                let titleColor = isActive ? 'text-k-text' : 'text-sub';
                
                if (isSasuItem && !isActive) {
                    activeClass = 'bg-[#f0fdfa] border-l-4 border-teal-200';
                }

                return `
                <div class="relative pl-10 md:pl-12 py-3 animate-fade-in group" id="schedule-item-${index}">
                    <div class="absolute left-[20px] top-8 w-4 h-4 rounded-full ${isActive ? 'bg-theme scale-125 ring-4 ring-teal-100' : (isSasuItem ? 'bg-teal-300' : 'bg-slate-300')} shadow-sm z-10 transition-all bg-white border-2 ${isActive ? 'border-theme' : (isSasuItem ? 'border-teal-300' : 'border-slate-300')}">
                    </div>
                    
                    <div class="${activeClass} white-box p-6 transition-all hover:border-theme/30">
                        ${activeBadge}
                        <div class="flex flex-col gap-1">
                            <div class="flex items-center flex-wrap gap-2">
                                <span class="font-bold text-2xl ${isActive ? 'text-theme' : 'text-stone-400'} font-serif tracking-tight">${item.time}</span>
                                ${item.loc !== '-' ? `<span class="text-xs font-bold text-stone-500 bg-stone-100 px-2 py-1 rounded-md border border-stone-200">${item.loc}</span>` : ''}
                            </div>
                            <h3 class="text-xl font-bold ${titleColor} ${isSasuItem ? 'text-theme' : ''}">
                                ${item.title}
                                ${isSasuItem ? '<span class="text-xs bg-teal-100 text-theme px-2 py-1 rounded-full ml-2 align-middle border border-teal-200">ì‚¬ìˆ˜</span>' : ''}
                            </h3>
                        </div>
                        ${item.note ? `<p class="text-sm text-sub font-medium mt-3 p-3 bg-stone-50 rounded-lg border border-stone-100 break-keep">ğŸ’¡ ${item.note}</p>` : ''}
                    </div>
                </div>
            `}).join('');
            
            if (activeIndex !== -1 && !window.hasScrolledToActive) {
                setTimeout(() => {
                    const el = document.getElementById(`schedule-item-${activeIndex}`);
                    if (el) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        window.hasScrolledToActive = true;
                    }
                }, 500);
            }
        }

        function setRoleFilter(role) {
            currentRoleFilter = role;
            
            const defaultStyle = "interactive-item rounded-lg text-sub font-bold hover:text-theme";
            const styles = {
                all: "rounded-lg border-2 border-theme bg-theme text-white font-bold shadow-md hover:opacity-90 transition-all",
                member: "rounded-lg border-2 border-member bg-member text-white font-bold shadow-md transition-all",
                oesu: "rounded-lg border-2 border-oesu bg-oesu text-white font-bold shadow-md transition-all",
                naesu: "rounded-lg border-2 border-naesu bg-naesu text-white font-bold shadow-md transition-all"
            };

            ['all', 'member', 'oesu', 'naesu'].forEach(r => {
                const btn = document.getElementById(`btn-role-${r}`);
                if (r === role) {
                    btn.className = `py-3 ${styles[r]}`;
                } else {
                    btn.className = `py-3 ${defaultStyle}`;
                }
            });

            generateRitualTimeline();
        }

        function generateRitualTimeline() {
            const inputHour = document.getElementById('practice-hour').value;
            if (!inputHour) return;

            const hour = parseInt(inputHour);
            const date = new Date();
            date.setHours(hour, 0, 0, 0);

            const fmt = (d) => {
                let h = d.getHours();
                let m = d.getMinutes();
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            };
            
            const addMin = (min) => {
                const newD = new Date(date.getTime());
                newD.setMinutes(date.getMinutes() + min);
                return fmt(newD);
            };

            const rawSteps = [
                { time: addMin(-15), title: "ì¤€ë¹„ ë° ì£¼ì„± ì—°ìŠµ", desc: "ëŒ€ê°•ì „ 1ì¸µ ë„ì°©, ì£¼ë¬¸ ì—°ìŠµ ì‹œì‘.", roleInfo: null },
                { time: addMin(20), title: "ì´ë™ ëŒ€ê¸° ë° ì¶œë°œ", desc: "ì£¼ë¬¸ ì—°ìŠµ ì¢…ë£Œ í›„ 3ì¸µìœ¼ë¡œ ì´ë™ ì¤€ë¹„.", highlight: true, roleInfo: { member: "1ì—´ (ê°€ì¥ ë¨¼ì € ì¶œë°œ)", oesu: "2ì—´ (íšŒì› ë’¤)", naesu: "3ì—´ (ë§ˆì§€ë§‰)" } },
                { 
                    time: addMin(25), 
                    title: "ê³µë¶€ë°© ì• ëŒ€ê¸° & ì…ì¥", 
                    desc: "ê³µë¶€ë°© ì• ë„ì°© ë° ì…ì¥. (íšŒì›ê³¼ í•¨ê»˜)", 
                    roleInfo: { 
                        member: "1ë²ˆ ì…ì¥", 
                        oesu: "ì• ì‹œê°„ ì‹ ë°œ ì •ë¦¬, ë¬¸ ì—´ê¸°, 3ë²ˆ ì…ì¥. ì…ì¥ í›„ ë¹„ì¹˜ëœ ê±¸ë ˆë¥¼ ì±™ê²¨ í•˜ë‚˜ëŠ” ë³¸ì¸ì´ ë“¤ê³ , í•˜ë‚˜ëŠ” ë‚´ìˆ˜ì—ê²Œ ì „ë‹¬.", 
                        naesu: "2ë²ˆ ì…ì¥" 
                    } 
                },
                { 
                    time: addMin(27), 
                    title: "êµëŒ€ ì‹ í˜¸ ë° ì…ì‹¤ ì¤€ë¹„", 
                    desc: `<span class="text-theme font-bold">27ë¶„ 30ì´ˆ</span>ê²½ ê³µë¶€ êµëŒ€ ì‹ í˜¸(í—›ê¸°ì¹¨). <span class="text-theme font-bold">27ë¶„ 50ì´ˆ</span> ì¢…ì´ ìš¸ë¦¬ë©´ ì…ì‹¤.`, 
                    roleInfo: { 
                        member: `â˜… <span class="text-theme font-bold">30ì´ˆ</span> í¬ê²Œ í—›ê¸°ì¹¨ ì‹ í˜¸`, 
                        oesu: "ëŒ€ê¸°", 
                        naesu: "ëŒ€ê¸°" 
                    } 
                },
                { 
                    time: addMin(30), 
                    title: "ê³µë¶€ë°© ì…ì‹¤", 
                    desc: "ì¢…ì´ ìš¸ë¦¬ë©´ ë°©ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤. (íšŒì›ì„ ì¤‘ì‹¬ìœ¼ë¡œ)", 
                    roleInfo: { 
                        member: "1ë²ˆ ì…ì¥. í–¥ ë¶ˆ ë¶™ì´ê¸°. ì¢Œë°° ì£¼ë„.", 
                        oesu: "3ë²ˆ ì…ì¥. ì†Œë…/ì²­ì†Œ. ê±¸ë ˆ ë’·ì‚¬ëŒ ì „ë‹¬.", 
                        naesu: "2ë²ˆ ì…ì¥. ì™¸ê³½ ì´ë™. ì†Œë…/ì²­ì†Œ. ê±¸ë ˆ ë’·ì‚¬ëŒ ì „ë‹¬." 
                    } 
                },
                { 
                    time: addMin(88), 
                    title: "í‡´ì‹¤ ì¤€ë¹„", 
                    desc: "ë‹¤ìŒ íƒ€ì„ êµëŒ€ ë° í‡´ì‹¤ (28ë¶„ê²½). <br><span class='text-theme font-bold'>ëˆˆì„ ëœ¨ê³  ì£¼ì„± ì†ë„ë¥¼ ì¡°ì ˆ</span>í•©ë‹ˆë‹¤. ì‹¬ê³ í•  ë•Œë„ ëˆˆì„ ëœ¨ê³  íšŒì›ì˜ ë™ì‘ì— ë§ì¶¥ë‹ˆë‹¤.", 
                    roleInfo: { member: "ì¢Œë°°. ë¨¼ì € ë’¤ë¡œ ì´ë™.", oesu: "ë‚˜ì¤‘ ì´ë™.", naesu: "ë¨¼ì € ì´ë™." } 
                },
                { time: addMin(90), title: "ì¢…ë£Œ ë° í•´ì‚°", desc: "ë¬¸ë‹¨ì† í›„ 1ì¸µì—ì„œ ì¸ì‚¬ (30ë¶„).", roleInfo: { member: "1ì¸µ ì´ë™.", oesu: "â˜… ë°”ê¹¥ ë¬¸ ë‹«ê¸°", naesu: "â˜… ì•ˆìª½ ë¬¸ ë‹«ê¸°" } }
            ];

            const h = parseInt(hour);
            if (h === 1 || h === 13) {
                rawSteps.push({ 
                    time: addMin(90),
                    title: "ë³´ì¶© ê¸°ë„ (1ì‹œ ê³µë¶€ì)",
                    desc: "ê³µë¶€ë¥¼ ë§ˆì¹˜ê³  ëŒ€ê°•ì „ 1ì¸µì—ì„œ 2:30ìœ¼ë¡œ ë³´ì¶©ê¸°ë„ë¥¼ ëª¨ì‹­ë‹ˆë‹¤. (ì˜¤í›„ì—ëŠ” 14:30)",
                    roleInfo: null,
                    special: true
                });
            }
            if (h === 5 || h === 17) {
                rawSteps.push({
                    time: addMin(90),
                    title: "ì €ë… ì‹ì‚¬ (5ì‹œ ê³µë¶€ì)",
                    desc: "ê³µë¶€ë¥¼ ë§ˆì¹˜ê³  ë‚˜ì™€ì„œ ì €ë… ì‹ì‚¬ë¥¼ í•©ë‹ˆë‹¤. (18:30~)",
                    roleInfo: null,
                    special: true
                });
            }
            if (h === 7 || h === 19) {
                rawSteps.push({
                    time: addMin(90),
                    title: "ë³´ì¶© ê¸°ë„ (7ì‹œ ê³µë¶€ì)",
                    desc: "ëŒ€ê°•ì „ 1ì¸µì—ì„œ ë³´ì¶©ê¸°ë„ë¥¼ ëª¨ì‹­ë‹ˆë‹¤. (08:30~08:45 / 20:30~20:45)",
                    roleInfo: null,
                    special: true
                });
                rawSteps.push({
                    time: addMin(105),
                    title: "ì•„ì¹¨ ì‹ì‚¬ (7ì‹œ ê³µë¶€ì)",
                    desc: "ë³´ì¶©ê¸°ë„ í›„ ì•„ì¹¨ ì‹ì‚¬ë¥¼ í•©ë‹ˆë‹¤. (08:45~09:10)",
                    roleInfo: null,
                    special: true
                });
            }
            if (h === 11 || h === 23) {
                rawSteps.push({
                    time: addMin(90),
                    title: "ì ì‹¬ ì‹ì‚¬ (11ì‹œ ê³µë¶€ì)",
                    desc: "ê³µë¶€ë¥¼ ë§ˆì¹˜ê³  ë‚˜ì™€ì„œ ì ì‹¬ì„ ë¨¹ìŠµë‹ˆë‹¤. (12:30~)",
                    roleInfo: null,
                    special: true
                });
            }
            
            rawSteps.sort((a,b) => a.time.localeCompare(b.time));

            const container = document.getElementById('ritual-steps');
            
            container.innerHTML = rawSteps.map(step => {
                let roleHTML = '';
                
                if (currentRoleFilter !== 'all' && step.roleInfo) {
                    const info = step.roleInfo[currentRoleFilter];
                    if (info) {
                        let colorClass = 'bg-stone-50 text-stone-700';
                        if(currentRoleFilter === 'member') colorClass = 'bg-amber-50 text-amber-900 border-l-4 border-member';
                        if(currentRoleFilter === 'oesu') colorClass = 'bg-blue-50 text-blue-900 border-l-4 border-oesu';
                        if(currentRoleFilter === 'naesu') colorClass = 'bg-red-50 text-red-900 border-l-4 border-naesu';

                        roleHTML = `<div class="mt-4 p-5 rounded-r-lg border-l-4 text-base font-bold shadow-sm ${colorClass}">${info}</div>`;
                    }
                } else if (currentRoleFilter === 'all' && step.roleInfo) {
                    roleHTML = `
                        <div class="mt-4 space-y-3 text-sm">
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-14 text-center bg-member text-white font-bold px-1 py-1 rounded">íšŒì›</span> <span class="text-stone-700 font-medium pt-0.5">${step.roleInfo.member}</span></div>
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-14 text-center bg-oesu text-white font-bold px-1 py-1 rounded">ì™¸ìˆ˜</span> <span class="text-stone-700 font-medium pt-0.5">${step.roleInfo.oesu}</span></div>
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-14 text-center bg-naesu text-white font-bold px-1 py-1 rounded">ë‚´ìˆ˜</span> <span class="text-stone-700 font-medium pt-0.5">${step.roleInfo.naesu}</span></div>
                        </div>
                    `;
                }

                let borderClass = step.special ? 'border-l-4 border-theme' : 'border-l-4 border-stone-200';
                let dotClass = step.special ? 'bg-theme ring-4 ring-teal-100' : 'bg-stone-300';

                return `
                <div class="flex gap-4 group mb-4">
                    <div class="w-20 text-right pt-2 hidden md:block">
                        <span class="font-bold text-stone-400 font-serif text-2xl tracking-tighter">${step.time}</span>
                    </div>
                    <div class="relative flex-grow ${borderClass} pl-6 pb-12 last:pb-0">
                        <div class="absolute -left-[10px] top-3 w-5 h-5 rounded-full ${dotClass} border-2 border-white shadow-sm transition-colors"></div>
                        
                        <div class="white-box p-6 hover:border-theme/30 transition-colors">
                            <div class="md:hidden font-bold text-stone-500 font-serif text-xl mb-1">${step.time}</div>
                            <h4 class="font-bold text-k-text text-xl font-serif mb-2">${step.title}</h4>
                            <p class="text-lg text-sub font-medium leading-relaxed break-keep">${step.desc}</p>
                            ${roleHTML}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        const canvas = document.getElementById('simCanvas');
        let ctx = null;
        if(canvas) ctx = canvas.getContext('2d');
        
        const C_MEMBER = '#d97706';
        const C_OESU = '#2563eb';
        const C_NAESU = '#dc2626';

        const simSteps = [
            {
                text: "1. ê³µë¶€ ì§„í–‰ ì¤‘ (í˜„ì¬ ì‹œê°„)",
                setup: (s) => {
                    s.p_oesu = {x: 200, y: 150, label: 'í˜„ ì™¸ìˆ˜', c: C_OESU};
                    s.p_member = {x: 300, y: 150, label: 'í˜„ íšŒì›', c: C_MEMBER};
                    s.p_naesu = {x: 400, y: 150, label: 'í˜„ ë‚´ìˆ˜', c: C_NAESU};
                    s.n_oesu = {x: 40, y: 150, label: 'ë‹¤ìŒ ì™¸ìˆ˜', c: C_OESU, alpha: 1};   
                    s.n_member = {x: 40, y: 200, label: 'ë‹¤ìŒ íšŒì›', c: C_MEMBER, alpha: 1}; 
                    s.n_naesu = {x: 40, y: 320, label: 'ë‹¤ìŒ ë‚´ìˆ˜', c: C_NAESU, alpha: 1};   
                }
            },
            {
                text: "2. êµëŒ€ ì¤€ë¹„: íšŒì›ê³¼ ë‚´ìˆ˜ í›„í‡´",
                desc: "ì¢…ì´ ìš¸ë¦¬ë©´ íšŒì›ê³¼ ë‚´ìˆ˜ëŠ” ë’¤ë¡œ ë¬¼ëŸ¬ë‚˜ ì•ìë¦¬ë¥¼ ë¹„ì›ë‹ˆë‹¤. ì™¸ìˆ˜ëŠ” ê°€ë§Œíˆ ìˆìŠµë‹ˆë‹¤.",
                animate: (s, p) => {
                    s.p_member.y = lerp(150, 350, p);
                    s.p_naesu.y = lerp(150, 350, p);
                }
            },
            {
                text: "3. ë‹¤ìŒ íšŒì› ì…ì¥",
                desc: "ë‹¤ìŒ íšŒì›ì´ ë“¤ì–´ì™€ ì™¸ìˆ˜ ë’¤ë¥¼ ëŒì•„ ì¤‘ì•™ ìë¦¬ë¡œ ê°‘ë‹ˆë‹¤.",
                animate: (s, p) => {
                    if(p < 0.2) {
                        const lp = p / 0.2;
                        s.n_member.x = lerp(40, 120, lp);
                        s.n_member.y = lerp(200, 250, lp);
                    } else if (p < 0.5) {
                        const lp = (p - 0.2) / 0.3;
                        s.n_member.x = lerp(120, 300, lp);
                        s.n_member.y = 250;
                    } else {
                        const lp = (p - 0.5) / 0.5;
                        s.n_member.x = 300;
                        s.n_member.y = lerp(250, 150, lp);
                    }
                }
            },
            {
                text: "4. ë‹¤ìŒ ë‚´ìˆ˜ ì…ì¥",
                desc: "ë‹¤ìŒ ë‚´ìˆ˜ê°€ ë“¤ì–´ì™€ ê¸°ì¡´ ì¸ì›ë“¤ì˜ ë“± ë’¤ë¥¼ ì§€ë‚˜, ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ í¬ê²Œ ëŒì•„ ìë¦¬ë¡œ ê°‘ë‹ˆë‹¤.",
                animate: (s, p) => {
                    if(p < 0.15) {
                        const lp = p / 0.15;
                        s.n_naesu.x = lerp(40, 120, lp);
                        s.n_naesu.y = lerp(320, 250, lp);
                    } else if (p < 0.35) {
                        const lp = (p - 0.15) / 0.2;
                        s.n_naesu.x = lerp(120, 180, lp);
                        s.n_naesu.y = lerp(250, 450, lp); 
                    } else if (p < 0.65) {
                        const lp = (p - 0.35) / 0.3;
                        s.n_naesu.x = lerp(180, 460, lp);
                        s.n_naesu.y = 450;
                    } else if (p < 0.85) {
                        const lp = (p - 0.65) / 0.2;
                        s.n_naesu.x = 460;
                        s.n_naesu.y = lerp(450, 150, lp);
                    } else {
                        const lp = (p - 0.85) / 0.15;
                        s.n_naesu.x = lerp(460, 400, lp);
                        s.n_naesu.y = 150;
                    }
                }
            },
            {
                text: "5. ì™¸ìˆ˜ êµëŒ€",
                desc: "ì´ì „ ì™¸ìˆ˜ê°€ ë’¤ë¡œ ë¬¼ëŸ¬ë‚˜ê³ , ë‹¤ìŒ ì™¸ìˆ˜ê°€ ë¬¸ì„ ë‹«ìœ¼ë©° ë“¤ì–´ì™€ ì•‰ìŠµë‹ˆë‹¤.",
                animate: (s, p) => {
                    if(p < 0.3) {
                        const lp = p / 0.3;
                        s.p_oesu.y = lerp(150, 350, lp);
                    } else {
                        s.p_oesu.y = 350;
                        const lp = (p - 0.3) / 0.7;
                        if(lp < 0.3) {
                            s.n_oesu.x = lerp(40, 120, lp/0.3);
                            s.n_oesu.y = lerp(150, 250, lp/0.3);
                        } else {
                            s.n_oesu.x = lerp(120, 200, (lp-0.3)/0.7);
                            s.n_oesu.y = lerp(250, 150, (lp-0.3)/0.7);
                        }
                    }
                }
            },
            {
                text: "ì™„ë£Œ: ê³µë¶€ ì‹œì‘ / í‡´ì‹¤",
                desc: "ìƒˆë¡œìš´ ì¡°ê°€ ìë¦¬ë¥¼ ì¡ì•˜ìŠµë‹ˆë‹¤. ì´ì „ ì¡°ëŠ” í‡´ì‹¤í•©ë‹ˆë‹¤.",
                animate: (s, p) => {
                    s.p_member.alpha = 1 - p;
                    s.p_oesu.alpha = 1 - p;
                    s.p_naesu.alpha = 1 - p;
                }
            }
        ];

        const simController = {
            stepIndex: 0,
            progress: 0,
            isPlaying: false,
            lastTime: 0,
            state: {},
            init: function() {
                this.reset();
                requestAnimationFrame((t) => this.loop(t));
            },
            reset: function() {
                this.stepIndex = 0;
                this.progress = 0;
                this.isPlaying = false;
                simSteps[0].setup(this.state);
                this.draw();
                this.updateText();
            },
            next: function() {
                if (this.stepIndex < simSteps.length - 1) {
                    if(simSteps[this.stepIndex].animate) simSteps[this.stepIndex].animate(this.state, 1.0);
                    this.stepIndex++;
                    this.progress = 0;
                    this.updateText();
                    this.draw();
                }
            },
            prev: function() {
                if (this.stepIndex > 0) {
                    this.stepIndex--;
                    this.progress = 0;
                    simSteps[0].setup(this.state);
                    for(let i=1; i<this.stepIndex; i++) {
                        if(simSteps[i].animate) simSteps[i].animate(this.state, 1.0);
                    }
                    this.updateText();
                    this.draw();
                }
            },
            play: function() {
                this.isPlaying = !this.isPlaying;
            },
            updateText: function() {
                const el = document.getElementById('step-description');
                const step = simSteps[this.stepIndex];
                el.innerHTML = `<span class="block text-sm text-theme font-bold mb-2">STEP ${this.stepIndex}</span>${step.text}<br><span class="text-base font-normal text-sub">${step.desc || ''}</span>`;
            },
            loop: function(timestamp) {
                const dt = timestamp - this.lastTime;
                this.lastTime = timestamp;
                if (this.isPlaying) {
                    this.progress += dt * 0.0005;
                    if (this.progress >= 1) {
                        this.progress = 1;
                        if(this.stepIndex < simSteps.length - 1) {
                            this.next();
                        } else {
                            this.isPlaying = false;
                        }
                    }
                    if(simSteps[this.stepIndex].animate) {
                        simSteps[this.stepIndex].animate(this.state, this.progress);
                    }
                    this.draw();
                }
                requestAnimationFrame((t) => this.loop(t));
            },
            draw: function() {
                if(!ctx) return;
                ctx.clearRect(0, 0, 500, 500);
                
                ctx.fillStyle = '#f5f5f4'; 
                ctx.fillRect(0, 0, 100, 500);
                
                ctx.strokeStyle = '#e7e5e4'; 
                ctx.lineWidth = 1;
                ctx.beginPath();
                for(let i=100; i<500; i+=50) {
                    ctx.moveTo(i, 0); ctx.lineTo(i, 500);
                }
                for(let i=0; i<500; i+=50) {
                    ctx.moveTo(100, i); ctx.lineTo(500, i);
                }
                ctx.stroke();
                
                ctx.strokeStyle = '#57534e';
                ctx.lineWidth = 4;
                ctx.beginPath();
                ctx.moveTo(100, 0); ctx.lineTo(100, 230);
                ctx.moveTo(100, 270); ctx.lineTo(100, 500);
                ctx.stroke();
                
                const drawBall = (obj) => {
                    if (obj.alpha === 0) return;
                    ctx.globalAlpha = obj.alpha !== undefined ? obj.alpha : 1;
                    ctx.fillStyle = obj.c;
                    ctx.beginPath();
                    ctx.arc(obj.x, obj.y, 22, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 11px Noto Sans KR'; 
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    let short = obj.label.includes('íšŒì›') ? 'íšŒ' : (obj.label.includes('ì™¸ìˆ˜') ? 'ì™¸' : 'ë‚´');
                    ctx.fillText(obj.label.includes('ë‹¤ìŒ') ? 'ë‹¤ìŒ' : 'ê¸°ì¡´', obj.x, obj.y - 9);
                    ctx.fillText(short, obj.x, obj.y + 7);
                    ctx.globalAlpha = 1;
                };

                drawBall(this.state.p_oesu);
                drawBall(this.state.p_member);
                drawBall(this.state.p_naesu);
                drawBall(this.state.n_member);
                drawBall(this.state.n_naesu);
                drawBall(this.state.n_oesu);
            }
        };
        
        function lerp(start, end, t) {
            return start * (1 - t) + end * t;
        }

        window.onload = function() {
            renderSchedule();
            generateRitualTimeline();
        }
    </script>
<!-- ê²€ìƒ‰ì–´ í˜•ê´‘íœ ë° ìë™ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ (ìˆ˜ì •ë¨) -->
<script>
window.addEventListener("load", function() {
    const params = new URLSearchParams(window.location.search);
    const keyword = params.get('search');
    
    if (keyword) {
        // ê²€ìƒ‰ ê¸°ëŠ¥ìœ¼ë¡œ ë“¤ì–´ì™”ì„ ë•ŒëŠ” í˜„ì¬ ì‹œê°„ ê¸°ì¤€ ìë™ ìŠ¤í¬ë¡¤ì„ ë§‰ì•„ ì¶©ëŒì„ ë°©ì§€í•©ë‹ˆë‹¤.
        window.hasScrolledToActive = true;

        // ë³¸ë¬¸ ë Œë”ë§ì´ ì™„ë£Œë  ì‹œê°„ì„ ìœ„í•´ ì•½ê°„ ëŒ€ê¸°í•©ë‹ˆë‹¤. (DOMì´ jsë¡œ ìƒì„±ë˜ë¯€ë¡œ)
        setTimeout(() => {
            const walk = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null, false);
            let node;
            const textNodes = [];
            while (node = walk.nextNode()) {
                if (node.parentNode.nodeName !== 'SCRIPT' && node.parentNode.nodeName !== 'STYLE') {
                    textNodes.push(node);
                }
            }
            
            let found = false;
            textNodes.forEach(textNode => {
                if (textNode.nodeValue.includes(keyword)) {
                    const span = document.createElement('span');
                    const regex = new RegExp(`(${keyword})`, 'gi');
                    span.innerHTML = textNode.nodeValue.replace(regex, '<mark class="search-highlight" style="background-color: #fef08a; color: #1a1a1a; padding: 0 2px; border-radius: 2px; font-weight: bold;">$1</mark>');
                    textNode.parentNode.replaceChild(span, textNode);
                    found = true;
                }
            });

            if (found) {
                setTimeout(() => {
                    const firstMark = document.querySelector('mark.search-highlight');
                    if (firstMark) {
                        // 02.htmlì˜ ê³ ìœ í•œ íƒ­(ì„¹ì…˜) êµ¬ì¡°ì— ë§ê²Œ í™”ë©´ì„ ì—´ì–´ì£¼ëŠ” ë¡œì§
                        const sectionParent = firstMark.closest('section[id^="view-"]');
                        if (sectionParent) {
                            const tabId = sectionParent.id.replace('view-', '');
                            if (typeof switchTab === 'function') {
                                switchTab(tabId); // 02.html ë‚´ë¶€ í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œ
                            }
                        }

                        // ìš”ì†Œê°€ í™”ë©´ì— ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
                        firstMark.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 100);
            }
        }, 300); // íƒ­ ë‚´ìš©ë“¤ì´ ë Œë”ë§ë  ì‹œê°„ 0.3ì´ˆ ëŒ€ê¸°
    }
});
</script>
</body>
</html>
