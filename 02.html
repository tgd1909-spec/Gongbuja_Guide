<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µë¶€ì ê°€ì´ë“œ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Config: Korean Traditional Minimalist Palette -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Point Color: Deep Red Bean
                        point: {
                            DEFAULT: '#8b3a3a', 
                            light: '#a65d5d',
                            dark: '#6d2b2b'
                        },
                        // Text Color: Deep Charcoal
                        ink: '#2c2c2c',
                        // Background Color: Light Off-White
                        paper: '#fdfbf7',
                        // Role Colors (Muted Traditional Tones)
                        member: '#d97706',   // Warm Amber
                        oesu: '#2563eb',     // Clear Blue
                        naesu: '#dc2626',    // Clear Red
                    },
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif'],
                        serif: ['Noto Serif KR', 'serif'],
                    },
                    backgroundImage: {
                        'hanji-texture': 'radial-gradient(#e6e2d3 1px, transparent 1px)',
                    },
                    backgroundSize: {
                        'hanji-size': '24px 24px',
                    }
                }
            }
        }
    </script>
    <style>
        /* Import Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;600;700&display=swap');
        
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #fdfbf7; 
            color: #2c2c2c;
            /* Hanji Pattern */
            background-image: radial-gradient(#e6e2d3 1px, transparent 1px);
            background-size: 24px 24px;
        }
        
        h1, h2, h3, h4, h5, h6, .font-serif { font-family: 'Noto Serif KR', serif; }

        /* Clean Tab Styling */
        .tab-btn {
            position: relative;
            color: #78716c; /* Stone-500 */
            transition: color 0.3s ease;
            font-family: 'Noto Sans KR', sans-serif;
            font-weight: 500;
        }
        .tab-active {
            color: #8b3a3a; /* Point Color */
            font-weight: 700;
        }
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #8b3a3a;
        }
        .tab-inactive:hover {
            color: #57534e; /* Stone-600 */
        }

        /* Timeline Line */
        .timeline-line::before {
            content: '';
            position: absolute;
            top: 24px;
            bottom: 24px;
            left: 15px;
            width: 1px;
            background-color: #d6d3d1; /* Stone-300 */
            z-index: 0;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        /* Current Item Highlight */
        .current-item {
            border-left: 4px solid #8b3a3a !important;
            background-color: #ffffff !important;
            box-shadow: 0 4px 12px rgba(139, 58, 58, 0.1);
        }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-sm border-b-4 border-double border-stone-200 sticky top-0 z-50">
        <div class="container mx-auto max-w-3xl px-6 py-5 flex justify-between items-center">
            <div class="flex flex-col">
                <h1 class="text-2xl font-bold font-serif text-ink flex items-center gap-2">
                    <span class="text-point">â–</span> ê³µë¶€ì ê°€ì´ë“œ
                </h1>
                <span class="text-xs text-stone-500 mt-1 tracking-widest">ì˜¤ëŠ˜ì˜ ë§ˆìŒê°€ì§: ì •ì„±(ç²¾èª )</span>
            </div>
            
            <!-- Home Button -->
            <a href="index.html" class="flex items-center gap-2 text-stone-600 hover:text-stone-900 transition-colors duration-300 group">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:scale-105 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <span class="hidden sm:inline font-serif text-sm font-semibold tracking-wide">í™ˆìœ¼ë¡œ</span>
            </a>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white/60 backdrop-blur-sm border-b border-stone-200 sticky top-[85px] z-40">
        <div class="container mx-auto max-w-3xl flex">
            <button onclick="switchTab('schedule')" id="nav-schedule" class="flex-1 py-4 text-center tab-btn tab-active text-base md:text-lg">ì¼ê³¼í‘œ</button>
            <button onclick="switchTab('practice')" id="nav-practice" class="flex-1 py-4 text-center tab-btn tab-inactive text-base md:text-lg">ê°œë³„ ê³µë¶€ ë° ì—­í• </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto max-w-3xl px-4 md:px-6 py-8 md:py-12 flex-grow">

        <!-- SECTION 1: DAILY SCHEDULE -->
        <section id="view-schedule" class="space-y-8 animate-fade-in">
            
            <div class="bg-white/60 backdrop-blur-sm border border-stone-200 rounded-lg p-6 shadow-sm flex flex-col gap-4">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-ink font-serif">í•˜ë£¨ì˜ íë¦„</h2>
                        <p class="text-stone-600 mt-3 leading-relaxed">
                            ëª¨ë“  ì§‘í•© ì‹œê°„ <span class="font-bold text-point border-b border-point/30">10~20ë¶„ ì „ ë„ì°©</span>ì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-4 mt-2 pt-4 border-t border-stone-200">
                    <!-- Sunday Toggle -->
                    <label class="flex items-center gap-3 cursor-pointer select-none group bg-white px-4 py-3 rounded border border-stone-300 shadow-sm hover:border-point transition-colors">
                        <input type="checkbox" id="sunday-toggle" onchange="toggleSundayMode(this.checked)" class="w-5 h-5 text-point rounded border-stone-400 focus:ring-point accent-point">
                        <span class="text-base font-medium text-stone-700 group-hover:text-point">ì£¼ì¼ ì¼ì • ë³´ê¸°</span>
                    </label>

                    <!-- Sasu Toggle -->
                    <label class="flex items-center gap-3 cursor-pointer select-none group bg-white px-4 py-3 rounded border border-stone-300 shadow-sm hover:border-point transition-colors">
                        <input type="checkbox" id="sasu-toggle" onchange="renderSchedule()" class="w-5 h-5 text-point rounded border-stone-400 focus:ring-point accent-point">
                        <span class="text-base font-medium text-stone-700 group-hover:text-point">ì‚¬ìˆ˜ ì—­í•  í¬í•¨í•˜ê¸°</span>
                    </label>
                </div>
            </div>

            <!-- Timeline -->
            <div class="relative timeline-line pl-0 md:pl-4" id="timeline-container">
                <!-- Javascript will populate this -->
            </div>
        </section>

        <!-- SECTION 2: PRACTICE & ROLES -->
        <section id="view-practice" class="hidden space-y-8 animate-fade-in">
            
            <div class="bg-white/60 backdrop-blur-sm border-b border-stone-200 pb-6 mb-8 rounded-lg p-6 shadow-sm">
                <h2 class="text-2xl font-bold text-ink font-serif mb-3">ë‚˜ì˜ ê³µë¶€ ë° ì—­í• </h2>
                <p class="text-stone-600 leading-relaxed">ì‹œê°„ íë¦„ì— ë”°ë¥¸ êµ¬ì²´ì ì¸ ì„ë¬´ì™€ ì ˆì°¨ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
            </div>

            <!-- Inputs Wrapper -->
            <div class="bg-white/60 backdrop-blur-sm border border-stone-200 rounded-lg p-8 md:p-10 flex flex-col items-center gap-10 shadow-sm">
                
                <!-- Added Sunday Toggle for Practice Section -->
                <div class="w-full flex justify-end mb-4">
                    <label class="flex items-center gap-2 cursor-pointer select-none group">
                        <input type="checkbox" id="practice-sunday-toggle" onchange="toggleSundayMode(this.checked)" class="w-4 h-4 text-point rounded border-stone-400 focus:ring-point accent-point">
                        <span class="text-sm font-medium text-stone-600 group-hover:text-point">ì£¼ì¼ ì¼ì • ë°˜ì˜</span>
                    </label>
                </div>

                <!-- Time Input -->
                <div class="flex flex-col md:flex-row items-center justify-center gap-6 w-full border-b border-stone-200 pb-8 border-dashed">
                    <span class="text-xl text-stone-700 font-serif font-bold">ë‚˜ëŠ”</span>
                    <div class="relative">
                        <input type="number" id="practice-hour" min="1" max="12" value="3" onchange="generateRitualTimeline()" 
                            class="text-5xl font-bold text-center w-28 border-b-2 border-stone-400 focus:border-point focus:outline-none bg-transparent transition-colors font-serif text-ink p-2">
                    </div>
                    <span class="text-xl text-stone-700 font-serif font-bold">ì‹œ ê³µë¶€ìì…ë‹ˆë‹¤.</span>
                </div>

                <!-- Role Filter -->
                <div class="w-full max-w-2xl">
                    <p class="text-center text-sm text-stone-500 mb-4 tracking-widest font-bold">â–¼ ì§ì±… ì„ íƒ</p>
                    <div class="grid grid-cols-4 gap-3 md:gap-4">
                        <button onclick="setRoleFilter('all')" id="btn-role-all" class="py-3 text-base rounded transition-all border border-stone-300 bg-ink text-white font-medium shadow-sm hover:opacity-90">ì „ì²´</button>
                        <button onclick="setRoleFilter('member')" id="btn-role-member" class="py-3 text-base rounded transition-all border border-stone-300 hover:bg-stone-50 text-stone-600 hover:text-point">íšŒì›</button>
                        <button onclick="setRoleFilter('oesu')" id="btn-role-oesu" class="py-3 text-base rounded transition-all border border-stone-300 hover:bg-stone-50 text-stone-600 hover:text-point">ì™¸ìˆ˜</button>
                        <button onclick="setRoleFilter('naesu')" id="btn-role-naesu" class="py-3 text-base rounded transition-all border border-stone-300 hover:bg-stone-50 text-stone-600 hover:text-point">ë‚´ìˆ˜</button>
                    </div>
                </div>
            </div>

            <!-- Steps Timeline -->
            <div id="ritual-steps" class="space-y-6 relative mt-10">
                <!-- Javascript will populate this -->
            </div>

            <!-- Core Rules -->
            <div class="mt-12 pt-8 border-t border-stone-200">
                <h3 class="font-bold text-xl text-ink mb-6 font-serif flex items-center gap-2">
                    <span class="text-point">âš ï¸</span> ì£¼ìš” ì¤€ìˆ˜ ì‚¬í•­
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex gap-4 items-center p-5 rounded-lg bg-white border border-stone-200 shadow-sm">
                        <span class="text-point text-xl font-bold">âœ”</span>
                        <div>
                            <span class="font-bold text-ink block mb-1">ì‹œê°„ ì—„ìˆ˜</span>
                            <span class="text-sm text-stone-500">ëª¨ë“  ì§‘í•© 10~20ë¶„ ì „ ë„ì°©</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-5 rounded-lg bg-white border border-stone-200 shadow-sm">
                        <span class="text-point text-xl font-bold">âœ”</span>
                        <div>
                            <span class="font-bold text-ink block mb-1">ì™¼ë°œ ë¨¼ì €</span>
                            <span class="text-sm text-stone-500">ê³„ë‹¨, ë¬¸í„± ë„˜ì„ ë•Œ í•­ìƒ ì™¼ë°œë¶€í„°</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-5 rounded-lg bg-white border border-stone-200 shadow-sm">
                        <span class="text-point text-xl font-bold">âœ”</span>
                        <div>
                            <span class="font-bold text-ink block mb-1">ì •ìˆ™ (ë¬µì–¸)</span>
                            <span class="text-sm text-stone-500">ëŒ€ê¸° ì¤‘ ì¡ë‹´ ê¸ˆì§€</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-5 rounded-lg bg-white border border-stone-200 shadow-sm">
                        <span class="text-point text-xl font-bold">âœ”</span>
                        <div>
                            <span class="font-bold text-ink block mb-1">êµ­ê¶ ìœ ì§€</span>
                            <span class="text-sm text-stone-500">ì´ë™ ì™„ë£Œ ì‹œê¹Œì§€ í—ˆë¦¬ ìˆ™ì¸ ìì„¸</span>
                        </div>
                    </div>
                    <div class="flex gap-4 items-center p-5 rounded-lg bg-[#fff5f5] border border-red-100 shadow-sm md:col-span-2">
                        <span class="text-point text-xl">ğŸ“¢</span>
                        <div>
                            <span class="font-bold text-point block mb-1">ì£¼ë¬¸ ì—°ê²°</span>
                            <span class="text-sm text-stone-600">ì£¼ë¬¸ì´ ëŠê¸°ì§€ ì•Šë„ë¡ ì• ì‹œê°„ ê³µë¶€ìì˜ ì£¼ì„±ì— ê·€ ê¸°ìš¸ì—¬ ì£¼ì„¸ìš”.</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="border-t border-stone-200 py-10 mt-12 text-center bg-white/60 backdrop-blur-sm">
        <p class="font-bold font-serif mb-2 text-ink text-lg">ë¶€ì‚° íƒœê·¹ë„</p>
        <p class="text-sm text-stone-500">ì´ˆì‹¬ìë¥¼ ìœ„í•œ ìˆ˜ë ¨ ê°€ì´ë“œ</p>
    </footer>

    <!-- Logic -->
    <script>
        // Global State for Sunday Mode
        let isGlobalSundayMode = false;

        // Data - Weekday Schedule
        const weekdayItems = [
            { time: "01:30", title: "ì¶•ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "01:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "02:00", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
            { time: "07:15", title: "ê¸°ìƒ", loc: "-", note: "", role: "all" },
            { time: "07:30", title: "ì§„ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "07:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "07:50", title: "ì•„ì¹¨ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "08:15", title: "ë°©ì¥ íšŒì˜", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ í•„ìˆ˜ ì°¸ì„", role: "sasu" },
            { time: "09:00", title: "ì²­ì†Œ", loc: "ì§€ì • êµ¬ì—­", note: "", role: "learner_only" }, 
            { time: "09:00", title: "ì‚¬ìˆ˜ ê°ì˜¤", loc: "ë³„ê´€", note: "", role: "sasu" },
            { time: "10:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "10:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "10:30", title: "ì˜¤ì „ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "10:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "11:30", title: "ì ì‹¬ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "12:00", title: "í† ë¡ ", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "13:30", title: "ë¯¸ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "13:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "14:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "15:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "16:05", title: "ìˆ˜ë ¨ ëŒ€ê¸° ë° í™˜ì˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "ê³µë¶€ì í™˜ì˜ ì¤€ë¹„", role: "sasu" },
            { time: "16:20", title: "ì‚¬ìˆ˜ ìŠ¤í”¼ì¹˜", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "", role: "sasu" },
            { time: "16:30", title: "ì˜¤í›„ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "16:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "17:00", title: "ì‚¬ìˆ˜ ë³´ê³ ", loc: "ë³„ê´€", note: "ì‚¬ìˆ˜ ì¼ì • ì¢…ë£Œ ë³´ê³ ", role: "sasu" },
            { time: "17:30", title: "ì €ë… ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "19:30", title: "ìˆ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "19:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "19:50", title: "ì²´ì¡°", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "20:00ê¹Œì§€", role: "all" },
            { time: "20:00", title: "ì‚¬ìˆ˜ êµëŒ€", loc: "ë³„ê´€", note: "ì†Œê° ë°œí‘œ", role: "sasu" },
            { time: "20:00", title: "ììœ ì‹œê°„", loc: "-", note: "í˜¹ì€ ì¼ëŒ€ì¼ ë§Œë‚¨", role: "learner_only" },
            { time: "21:30", title: "ì í˜¸", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "21:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "22:30", title: "ë“œëŠ” ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ ìŠ¹ì •ë¬¸ ì•", note: "22:20ê¹Œì§€ ì‹œë¦½", role: "all" },
            { time: "23:30", title: "í‡´ë°° ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ ìŠ¹ì •ë¬¸", note: "23:20ê¹Œì§€ ì •ë ¬, í•˜ë£¨ ì¼ê³¼ ë§ˆë¬´ë¦¬", role: "all" },
            { time: "23:50", title: "í‡´ë°° ì¢…ë£Œ", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "ì¸ì‚¬ í›„ ê·€ê°€", role: "all" },
            { time: "24:00", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
        ];

        // Data - Sunday Schedule
        const sundayItems = [
            // Saturday Night (Eve)
            { time: "23:30", title: "ìì‹œ ê¸°ë„ (ì „ë‚ )", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "ì£¼ì¼ ë“œëŠ” ë‚ , 23:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "23:50", title: "ì·¨ì¹¨ (ì „ë‚ )", loc: "ìˆ™ì†Œ", note: "", role: "all" },
            // Sunday Morning
            { time: "01:30", title: "ì¶•ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "01:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "01:50", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "", role: "all" },
            { time: "05:20", title: "ê¸°ìƒ", loc: "-", note: "", role: "all" },
            { time: "05:30", title: "ë¬˜ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "05:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "05:50", title: "ì·¨ì¹¨", loc: "ìˆ™ì†Œ", note: "í˜¹ì€ ê°ì í•  ì¼", role: "all" },
            { time: "07:15", title: "ê¸°ìƒ", loc: "-", note: "", role: "all" },
            { time: "07:30", title: "ì§„ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "07:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "07:50", title: "ì•„ì¹¨ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "09:00", title: "ì²­ì†Œ", loc: "ì§€ì • êµ¬ì—­", note: "", role: "all" },
            { time: "10:30", title: "ì˜¤ì „ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "10:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "11:30", title: "ì˜¤ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "", role: "all" },
            { time: "12:00", title: "ì ì‹¬ ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "12:20", title: "í† ë¡ ", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "13:30", title: "ë¯¸ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "13:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "14:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "15:00", title: "ì¼ëŒ€ì¼ ë§Œë‚¨", loc: "ì²­í•™ê´€", note: "", role: "all" },
            { time: "16:30", title: "ì˜¤í›„ ìˆ˜ë ¨", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "16:10ê¹Œì§€ ëŒ€ê¸°", role: "all" },
            { time: "17:30", title: "ìœ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "17:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "18:00", title: "ì €ë… ì‹ì‚¬", loc: "ì‹ë‹¹", note: "", role: "all" },
            { time: "19:30", title: "ìˆ ì‹œ ê¸°ë„", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "19:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "19:50", title: "ì²´ì¡°", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "20:00ê¹Œì§€", role: "all" },
            { time: "20:00", title: "ììœ ì‹œê°„", loc: "-", note: "í˜¹ì€ ì¼ëŒ€ì¼ ë§Œë‚¨", role: "all" },
            { time: "21:30", title: "ì í˜¸", loc: "ëŒ€ê°•ì „ 1ì¸µ", note: "21:20ê¹Œì§€ ë„ì°©", role: "all" },
            { time: "22:30", title: "ë“œëŠ” ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "22:20ê¹Œì§€ ìŠ¹ì •ë¬¸ ì• ëŒ€ê¸°", role: "all" },
            { time: "23:30", title: "í‡´ë°° ë´‰ì‹¬", loc: "ëŒ€ê°•ì „ 2ì¸µ", note: "23:20ê¹Œì§€ ìŠ¹ì •ë¬¸ ì• ëŒ€ê¸°", role: "all" },
        ];

        let currentTab = 'schedule';
        let currentRoleFilter = 'all';

        function switchTab(tabId) {
            ['schedule', 'practice'].forEach(id => {
                const view = document.getElementById(`view-${id}`);
                const nav = document.getElementById(`nav-${id}`);
                if(view) view.classList.add('hidden');
                if(nav) {
                    nav.classList.remove('tab-active');
                    nav.classList.add('tab-inactive');
                }
            });

            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${tabId}`);
            activeNav.classList.add('tab-active');
            activeNav.classList.remove('tab-inactive');
            
            currentTab = tabId;

            if(tabId === 'practice') {
                setRoleFilter(currentRoleFilter);
            } else if (tabId === 'schedule') {
                renderSchedule();
            }
        }

        function getCurrentTimeInMinutes() {
            const now = new Date();
            return now.getHours() * 60 + now.getMinutes();
        }

        function timeStringToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // --- Auto Sunday Detection Logic ---
        function isSundayCycle() {
            // Base date (known Sunday or cycle start)
            // Assuming today is Sunday as per user request to set logic
            return true; 
        }

        // --- Toggle Sunday Mode Globally ---
        function toggleSundayMode(checked) {
            isGlobalSundayMode = checked;
            
            // Update UI elements
            const sundayToggle = document.getElementById('sunday-toggle');
            if(sundayToggle) sundayToggle.checked = checked;
            
            const practiceSundayToggle = document.getElementById('practice-sunday-toggle');
            if(practiceSundayToggle) practiceSundayToggle.checked = checked;

            // Re-render current view
            if(currentTab === 'schedule') renderSchedule();
            if(currentTab === 'practice') generateRitualTimeline();
        }

        function renderSchedule() {
            const container = document.getElementById('timeline-container');
            const isSasuMode = document.getElementById('sasu-toggle').checked;
            const nowMinutes = getCurrentTimeInMinutes();
            
            // Use Global Sunday Mode State
            let itemsToRender = isGlobalSundayMode ? [...sundayItems] : [...weekdayItems];
            
            // Sort items by time
            itemsToRender.sort((a, b) => a.time.localeCompare(b.time));

            const filteredData = itemsToRender.filter(item => {
                if (item.role === 'all') return true;
                if (item.role === 'sasu') return isSasuMode;
                if (item.role === 'learner_only') return !isSasuMode;
                return false;
            });
            
            let activeIndex = -1;
            for (let i = 0; i < filteredData.length; i++) {
                const itemTime = timeStringToMinutes(filteredData[i].time);
                if (nowMinutes >= itemTime) {
                    if (i < filteredData.length - 1) {
                        const nextItemTime = timeStringToMinutes(filteredData[i+1].time);
                        if (nowMinutes < nextItemTime) {
                            activeIndex = i;
                            break;
                        }
                    } else {
                        activeIndex = i;
                    }
                }
            }

            container.innerHTML = filteredData.map((item, index) => {
                const isSasuItem = item.role === 'sasu';
                const isActive = (index === activeIndex);
                
                let activeClass = isActive ? 'current-item' : 'bg-white/70 border-l-4 border-transparent';
                let activeBadge = isActive ? `<div class="mb-2 text-xs font-bold text-point bg-red-50 inline-block px-2 py-1 rounded border border-red-100">â° í˜„ì¬ ì§„í–‰ì¤‘</div>` : '';
                let titleColor = isActive ? 'text-ink' : 'text-stone-700';
                
                // Override for Sasu
                if (isSasuItem && !isActive) {
                    activeClass = 'bg-[#fff5f5] border-l-4 border-red-200';
                }

                return `
                <div class="relative pl-10 md:pl-12 py-2 animate-fade-in group" id="schedule-item-${index}">
                    <!-- Dot -->
                    <div class="absolute left-[8px] top-6 w-6 h-6 rounded-full ${isActive ? 'bg-point scale-110' : (isSasuItem ? 'bg-red-300' : 'bg-stone-300')} border-4 border-[#fdfbf7] shadow-sm z-10 transition-all flex items-center justify-center">
                        ${isActive ? '<div class="w-2 h-2 bg-white rounded-full"></div>' : ''}
                    </div>
                    
                    <!-- Content Card -->
                    <div class="${activeClass} p-5 rounded-lg border border-stone-200 transition-all shadow-sm">
                        ${activeBadge}
                        <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-2">
                            <div>
                                <div class="flex items-baseline gap-3 mb-1">
                                    <span class="font-bold text-2xl ${isActive ? 'text-point' : 'text-stone-600'} font-serif">${item.time}</span>
                                    ${item.loc !== '-' ? `<span class="text-sm font-medium text-stone-500 bg-stone-100 px-2 py-1 rounded">${item.loc}</span>` : ''}
                                </div>
                                <h3 class="text-xl font-bold ${titleColor} ${isSasuItem ? 'text-point' : ''}">
                                    ${item.title}
                                    ${isSasuItem ? '<span class="text-xs bg-red-100 text-point px-2 py-1 rounded-full ml-2 align-middle border border-red-200">ì‚¬ìˆ˜</span>' : ''}
                                </h3>
                            </div>
                        </div>
                        ${item.note ? `<p class="text-base text-stone-600 mt-3 p-3 bg-stone-50 rounded border border-stone-100">ğŸ’¡ ${item.note}</p>` : ''}
                    </div>
                </div>
            `}).join('');
            
            if (activeIndex !== -1 && !window.hasScrolledToActive) {
                setTimeout(() => {
                    const el = document.getElementById(`schedule-item-${activeIndex}`);
                    if (el) {
                        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        window.hasScrolledToActive = true;
                    }
                }, 500);
            }
        }

        function setRoleFilter(role) {
            currentRoleFilter = role;
            
            // Minimal button styles
            const defaultStyle = "bg-white text-stone-500 border border-stone-200 hover:bg-stone-50 hover:text-stone-700 hover:border-stone-300";
            
            // Custom role specific active colors
            const styles = {
                all: "bg-ink text-white border-ink shadow-md font-bold",
                member: "bg-member text-white border-member shadow-md font-bold",
                oesu: "bg-oesu text-white border-oesu shadow-md font-bold",
                naesu: "bg-naesu text-white border-naesu shadow-md font-bold"
            };

            ['all', 'member', 'oesu', 'naesu'].forEach(r => {
                const btn = document.getElementById(`btn-role-${r}`);
                if (r === role) {
                    btn.className = `py-3 text-sm md:text-base rounded transition-all ${styles[r]}`;
                } else {
                    btn.className = `py-3 text-sm md:text-base rounded transition-all ${defaultStyle}`;
                }
            });

            generateRitualTimeline();
        }

        function generateRitualTimeline() {
            const inputHour = document.getElementById('practice-hour').value;
            
            if (!inputHour) return;

            const hour = parseInt(inputHour);
            const date = new Date();
            date.setHours(hour, 0, 0, 0);

            const fmt = (d) => {
                let h = d.getHours();
                let m = d.getMinutes();
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            };
            
            const addMin = (min) => {
                const newD = new Date(date.getTime());
                newD.setMinutes(date.getMinutes() + min);
                return fmt(newD);
            };

            const rawSteps = [
                { time: addMin(-15), title: "ì¤€ë¹„ ë° ì£¼ì„± ì—°ìŠµ", desc: "ëŒ€ê°•ì „ 1ì¸µ ë„ì°©, ì£¼ë¬¸ ì—°ìŠµ ì‹œì‘.", roleInfo: null },
                { time: addMin(20), title: "ì´ë™ ëŒ€ê¸° ë° ì¶œë°œ", desc: "ì£¼ë¬¸ ì—°ìŠµ ì¢…ë£Œ í›„ 3ì¸µìœ¼ë¡œ ì´ë™ ì¤€ë¹„.", highlight: true, roleInfo: { member: "1ì—´ (ê°€ì¥ ë¨¼ì € ì¶œë°œ)", oesu: "2ì—´ (íšŒì› ë’¤)", naesu: "3ì—´ (ë§ˆì§€ë§‰, ë¬¸ë‹¨ì†)" } },
                { time: addMin(25), title: "ê³µë¶€ë°© ì• ëŒ€ê¸° & ì…ì¥", desc: "ê³µë¶€ë°© ì• ë„ì°© ë° ì…ì¥.", roleInfo: { member: "ì‹ ë°œ ë²—ê³  1ë²ˆ ì…ì¥", oesu: "ì‹ ë°œ ì •ë¦¬, ë¬¸ ì—´ê¸°, 3ë²ˆ ì…ì¥", naesu: "2ë²ˆ ì…ì¥" } },
                { time: addMin(27), title: "êµëŒ€ ì‹ í˜¸", desc: "27ë¶„ 30ì´ˆê²½ ê³µë¶€ êµëŒ€ ì‹ í˜¸.", roleInfo: { member: "â˜… í¬ê²Œ í—›ê¸°ì¹¨ ì‹ í˜¸", oesu: "ëŒ€ê¸°", naesu: "ëŒ€ê¸°" } },
                { time: addMin(30), title: "ê³µë¶€ë°© ì…ì‹¤", desc: "ì¢…ì´ ìš¸ë¦¬ë©´ ë°©ìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.", roleInfo: { member: "1ë²ˆ ì…ì¥. í–¥ ë¶ˆ ë¶™ì´ê¸°. ì¢Œë°° ì£¼ë„.", oesu: "3ë²ˆ ì…ì¥. ì†Œë…/ì²­ì†Œ. ì†ìˆ˜ê±´ ë’·ì‚¬ëŒ ì „ë‹¬.", naesu: "2ë²ˆ ì…ì¥. ì™¸ê³½ ì´ë™. ì†Œë…/ì²­ì†Œ. ì†ìˆ˜ê±´ ë’·ì‚¬ëŒ ì „ë‹¬." } },
                { time: addMin(88), title: "í‡´ì‹¤ ì¤€ë¹„", desc: "ë‹¤ìŒ íƒ€ì„ êµëŒ€ ë° í‡´ì‹¤ (28ë¶„ê²½).", roleInfo: { member: "ì¢Œë°° êµ¬ë ¹. ë¨¼ì € ë’¤ë¡œ ì´ë™.", oesu: "ë‚˜ì¤‘ ì´ë™.", naesu: "ë¨¼ì € ì´ë™." } },
                { time: addMin(90), title: "ì¢…ë£Œ ë° í•´ì‚°", desc: "ë¬¸ë‹¨ì† í›„ 1ì¸µì—ì„œ ì¸ì‚¬ (30ë¶„).", roleInfo: { member: "1ì¸µ ì´ë™.", oesu: "â˜… ë°”ê¹¥ ë¬¸ ë‹«ê¸°", naesu: "â˜… ì•ˆìª½ ë¬¸ ë‹«ê¸°" } }
            ];

            // --- ADDED LOGIC FOR SPECIAL STUDY TIMES (Now using isGlobalSundayMode for future logic) ---
            const h = parseInt(hour);
            if (h === 1 || h === 13) {
                // 1ì‹œ ê³µë¶€ì
                
                rawSteps.push({ 
                    time: addMin(90), // 1:00 + 90m = 2:30
                    title: "ë³´ì¶© ê¸°ë„ (1ì‹œ ê³µë¶€ì)",
                    desc: "ê³µë¶€ë¥¼ ë§ˆì¹˜ê³  ëŒ€ê°•ì „ 1ì¸µì—ì„œ 2:30ìœ¼ë¡œ ë³´ì¶©ê¸°ë„ë¥¼ ëª¨ì‹­ë‹ˆë‹¤. (ì˜¤í›„ì—ëŠ” 14:30)",
                    roleInfo: null,
                    special: true
                });
            }
            if (h === 5 || h === 17) {
                // 5ì‹œ ê³µë¶€ì
                rawSteps.push({
                    time: addMin(90), // 6:30
                    title: "ì €ë… ì‹ì‚¬ (5ì‹œ ê³µë¶€ì)",
                    desc: "ê³µë¶€ë¥¼ ë§ˆì¹˜ê³  ë‚˜ì™€ì„œ ì €ë… ì‹ì‚¬ë¥¼ í•©ë‹ˆë‹¤. (18:30~)",
                    roleInfo: null,
                    special: true
                });
            }
            if (h === 7 || h === 19) {
                // 7ì‹œ ê³µë¶€ì
                rawSteps.push({
                    time: addMin(90), // 8:30
                    title: "ë³´ì¶© ê¸°ë„ (7ì‹œ ê³µë¶€ì)",
                    desc: "ëŒ€ê°•ì „ 1ì¸µì—ì„œ ë³´ì¶©ê¸°ë„ë¥¼ ëª¨ì‹­ë‹ˆë‹¤. (08:30~08:45 / 20:30~20:45)",
                    roleInfo: null,
                    special: true
                });
                rawSteps.push({
                    time: addMin(105), // 8:45
                    title: "ì•„ì¹¨ ì‹ì‚¬ (7ì‹œ ê³µë¶€ì)",
                    desc: "ë³´ì¶©ê¸°ë„ í›„ ì•„ì¹¨ ì‹ì‚¬ë¥¼ í•©ë‹ˆë‹¤. (08:45~09:10)",
                    roleInfo: null,
                    special: true
                });
            }
            if (h === 11 || h === 23) {
                // 11ì‹œ ê³µë¶€ì
                rawSteps.push({
                    time: addMin(90), // 12:30
                    title: "ì ì‹¬ ì‹ì‚¬ (11ì‹œ ê³µë¶€ì)",
                    desc: "ê³µë¶€ë¥¼ ë§ˆì¹˜ê³  ë‚˜ì™€ì„œ ì ì‹¬ì„ ë¨¹ìŠµë‹ˆë‹¤. (12:30~)",
                    roleInfo: null,
                    special: true
                });
            }
            
            // Sort steps by time just in case
            rawSteps.sort((a,b) => a.time.localeCompare(b.time));

            const container = document.getElementById('ritual-steps');
            
            container.innerHTML = rawSteps.map(step => {
                let roleHTML = '';
                
                if (currentRoleFilter !== 'all' && step.roleInfo) {
                    const info = step.roleInfo[currentRoleFilter];
                    if (info) {
                        let colorClass = 'bg-stone-50 text-stone-700';
                        if(currentRoleFilter === 'member') colorClass = 'bg-amber-50 text-amber-900 border-l-4 border-member';
                        if(currentRoleFilter === 'oesu') colorClass = 'bg-blue-50 text-blue-900 border-l-4 border-oesu';
                        if(currentRoleFilter === 'naesu') colorClass = 'bg-red-50 text-red-900 border-l-4 border-naesu';

                        roleHTML = `<div class="mt-4 p-4 rounded-r-lg text-lg font-bold shadow-sm ${colorClass}">${info}</div>`;
                    }
                } else if (currentRoleFilter === 'all' && step.roleInfo) {
                    roleHTML = `
                        <div class="mt-4 space-y-3 text-base">
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-12 text-center bg-member text-white font-bold text-sm px-1 py-0.5 rounded">íšŒì›</span> <span class="text-stone-700 font-medium">${step.roleInfo.member}</span></div>
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-12 text-center bg-oesu text-white font-bold text-sm px-1 py-0.5 rounded">ì™¸ìˆ˜</span> <span class="text-stone-700 font-medium">${step.roleInfo.oesu}</span></div>
                            <div class="flex gap-3 items-start"><span class="shrink-0 w-12 text-center bg-naesu text-white font-bold text-sm px-1 py-0.5 rounded">ë‚´ìˆ˜</span> <span class="text-stone-700 font-medium">${step.roleInfo.naesu}</span></div>
                        </div>
                    `;
                }

                // Highlight special added steps
                let borderClass = step.special ? 'border-l-4 border-point' : 'border-l-4 border-stone-200';
                let dotClass = step.special ? 'bg-point' : 'bg-stone-300';

                return `
                <div class="flex gap-4 group mb-2">
                    <div class="w-20 text-right pt-2 hidden md:block">
                        <span class="font-bold text-stone-500 font-serif text-2xl">${step.time}</span>
                    </div>
                    <div class="relative flex-grow ${borderClass} pl-6 pb-10 last:pb-0">
                        <!-- Dot -->
                        <div class="absolute -left-[10px] top-3 w-4 h-4 rounded-full ${dotClass} border-2 border-stone-100 group-hover:bg-point transition-colors"></div>
                        
                        <div class="bg-white/70 backdrop-blur-sm p-6 rounded-lg border border-stone-200 shadow-sm hover:shadow-md transition-shadow">
                            <div class="md:hidden font-bold text-stone-500 font-serif text-xl mb-1">${step.time}</div>
                            <h4 class="font-bold text-ink text-xl font-serif mb-2">${step.title}</h4>
                            <p class="text-lg text-stone-600 leading-relaxed">${step.desc}</p>
                            ${roleHTML}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        window.onload = function() {
            // Check if it is Sunday cycle (Simulated as True for demo as requested)
            if (isSundayCycle()) {
                toggleSundayMode(true);
            } else {
                renderSchedule();
            }
            setInterval(renderSchedule, 60000);
        };
    </script>
</body>
</html>
