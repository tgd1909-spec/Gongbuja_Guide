<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µë¶€ì ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts Import -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['"Noto Serif KR"', 'serif'],
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                    },
                    colors: {
                        'ink': '#1a1a1a', // ì§„í•œ ê²€ì • (ì‹œì¸ì„± ìµœìš°ì„ )
                        'k-red': '#9d2424', // ì§™ì€ ì ìƒ‰ (í¬ì¸íŠ¸)
                        'k-red-bg': '#fef2f2', // ë¶‰ì€ìƒ‰ ë°°ê²½ (bg-red-50 ìœ ì‚¬)
                        'hanji-bg': '#fdfbf7',
                        'hanji-dot': '#e6e2d3',
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                    }
                }
            }
        }
    </script>

    <style>
        /* 1. ë°°ê²½: í•œì§€ ì§ˆê° */
        body {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e6e2d3 1px, transparent 1px);
            background-size: 24px 24px;
            color: #1a1a1a;
            word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ (ê°€ë…ì„±) */
        }

        /* ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
        .transition-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ì‹œë®¬ë ˆì´í„° ë…¸ë“œ ì „í™˜ */
        .formation-node {
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 5px;
            border: 2px solid #fdfbf7;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }

        /* ë“œë¡­ë‹¤ìš´ ì• ë‹ˆë©”ì´ì…˜ */
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] summary ~ * {
            animation: sweep .4s ease-in-out;
        }
        @keyframes sweep {
            0%    {opacity: 0; transform: translateY(-10px)}
            100%  {opacity: 1; transform: translateY(0)}
        }

        /* ì„¸ë¡œ ì“°ê¸° */
        .writing-vertical {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
        
        /* ì‹œë®¬ë ˆì´í„° í™”ì‚´í‘œ ë¨¸ë¦¬ ('ã„´'ì í˜•íƒœ, ì˜¤ë¥¸ìª½ ë°©í–¥) */
        .arrow-path::after {
            content: '';
            position: absolute;
            right: -6px; 
            bottom: -5px; 
            width: 0; 
            height: 0; 
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-left: 10px solid #9d2424; /* ë” ì§„í•œ ìƒ‰ìƒ */
        }

        /* ì‹œë®¬ë ˆì´í„° ì‹œì‘ì  (ì ) */
        .arrow-path::before {
            content: '';
            position: absolute;
            left: -4px;
            top: -4px;
            width: 8px;
            height: 8px;
            background-color: #9d2424;
            border-radius: 50%;
        }
        
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="font-sans text-ink antialiased text-lg">

    <!-- í—¤ë” -->
    <header class="sticky top-0 z-50 w-full bg-white/95 border-b-2 border-stone-200 shadow-sm h-20" id="main-header">
        <div class="max-w-4xl mx-auto px-6 h-full flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-k-red text-white flex items-center justify-center border-2 border-k-red">
                    <span class="font-serif font-bold text-lg">é“</span>
                </div>
                <h1 class="text-2xl font-serif font-bold tracking-tight text-ink">ê³µë¶€ì ê°€ì´ë“œ</h1>
            </div>

            <!-- í™ˆ ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) -->
            <a href="index.html" class="flex items-center gap-2 px-4 py-2 bg-stone-100 hover:bg-stone-200 text-ink font-bold rounded-full border-2 border-stone-300 transition-colors shadow-sm">
                <!-- SVG Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                </svg>
                <span class="font-serif">í™ˆìœ¼ë¡œ</span>
            </a>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="max-w-4xl mx-auto mt-8 mb-16 px-6 py-10 bg-white/80 backdrop-blur-md border-2 border-stone-200 rounded-xl shadow-lg min-h-screen">

        <!-- ì¸íŠ¸ë¡œ ì„¹ì…˜ -->
        <section class="mb-12">
            <div class="bg-white p-8 border-2 border-stone-200 rounded-xl shadow-card">
                <h2 class="text-4xl md:text-5xl font-serif font-bold text-ink mb-6 leading-tight">
                    ì…ì†Œ ë° <br class="md:hidden" />ì¤€ë¹„ ê³¼ì • ì•ˆë‚´
                </h2>
                <p class="text-xl text-ink leading-relaxed mb-8 font-medium">
                    ë³¸ë¶€ ë„ì°©ë¶€í„° ì²« ê³µì‹ ì˜ì‹ì¸ <strong class="text-k-red border-b-2 border-k-red/30 px-1">'ë“œëŠ” ë´‰ì‹¬'</strong>ê¹Œì§€ì˜ ì—¬ì •ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.<br>
                    ê²½ê±´í•œ ë§ˆìŒìœ¼ë¡œ ì°¨ë¶„íˆ ì ˆì°¨ë¥¼ ë”°ë¼ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </p>

                <!-- ì¤€ë¹„ë¬¼ ì¹´ë“œ ê·¸ë¦¬ë“œ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-stone-50 p-6 border-2 border-stone-200 rounded-lg">
                        <span class="inline-block px-3 py-1 bg-k-red/10 text-k-red font-bold rounded-full text-sm mb-3">ê¸°ë³¸ ì¤€ë¹„ë¬¼</span>
                        <p class="text-xl text-ink font-bold">í•œë³µ, ì„¸ë©´ë„êµ¬, í°ì‹ ë°œ</p>
                    </div>
                    <div class="bg-stone-50 p-6 border-2 border-stone-200 rounded-lg">
                        <span class="inline-block px-3 py-1 bg-k-red/10 text-k-red font-bold rounded-full text-sm mb-3">ì¶”ê°€ ì¤€ë¹„ë¬¼</span>
                        <p class="text-lg text-ink font-medium leading-relaxed">í¸í•œ ì¼ìƒë³µ(ì²­ì†Œìš©), ê°œì¸ ì»µ(í…€ë¸”ëŸ¬), ê°œì¸ ìƒë¹„ì•½, ê¸°íƒ€ ì†Œì§€í’ˆ</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
        <nav class="mb-10" id="phase-nav">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button onclick="setPhase(0)" id="btn-phase-0" class="transition-card group p-4 bg-white border-2 border-stone-200 rounded-xl hover:border-k-red hover:bg-red-50/30 hover:-translate-y-1 shadow-card text-left relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1.5 h-full bg-stone-300 group-hover:bg-k-red transition-colors" id="bar-phase-0"></div>
                    <div class="pl-4">
                        <span class="inline-block px-2 py-0.5 bg-stone-100 text-stone-600 rounded text-xs font-bold mb-2 group-hover:bg-k-red/10 group-hover:text-k-red">Step 01</span>
                        <span class="block text-xl font-serif font-bold text-stone-500 group-hover:text-ink mb-1">ë„ì°© ë° ì¤€ë¹„</span>
                        <span class="block text-sm text-stone-400 font-medium">20:00 ~ 21:20</span>
                    </div>
                </button>
                <button onclick="setPhase(1)" id="btn-phase-1" class="transition-card group p-4 bg-white border-2 border-stone-200 rounded-xl hover:border-k-red hover:bg-red-50/30 hover:-translate-y-1 shadow-card text-left relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1.5 h-full bg-stone-300 group-hover:bg-k-red transition-colors" id="bar-phase-1"></div>
                    <div class="pl-4">
                        <span class="inline-block px-2 py-0.5 bg-stone-100 text-stone-600 rounded text-xs font-bold mb-2 group-hover:bg-k-red/10 group-hover:text-k-red">Step 02</span>
                        <span class="block text-xl font-serif font-bold text-stone-500 group-hover:text-ink mb-1">ì í˜¸</span>
                        <span class="block text-sm text-stone-400 font-medium">21:20 ~ 22:20</span>
                    </div>
                </button>
                <button onclick="setPhase(2)" id="btn-phase-2" class="transition-card group p-4 bg-white border-2 border-stone-200 rounded-xl hover:border-k-red hover:bg-red-50/30 hover:-translate-y-1 shadow-card text-left relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1.5 h-full bg-stone-300 group-hover:bg-k-red transition-colors" id="bar-phase-2"></div>
                    <div class="pl-4">
                        <span class="inline-block px-2 py-0.5 bg-stone-100 text-stone-600 rounded text-xs font-bold mb-2 group-hover:bg-k-red/10 group-hover:text-k-red">Step 03</span>
                        <span class="block text-xl font-serif font-bold text-stone-500 group-hover:text-ink mb-1">ë“œëŠ” ë´‰ì‹¬</span>
                        <span class="block text-sm text-stone-400 font-medium">22:20 ~ ì¢…ë£Œ</span>
                    </div>
                </button>
            </div>
        </nav>

        <!-- ë™ì  ì½˜í…ì¸  ì˜ì—­ -->
        <div id="phase-content" class="min-h-[400px] fade-in-section scroll-mt-28">
            <!-- JSë¡œ ë‚´ìš© ì£¼ì…ë¨ -->
        </div>

    </main>

    <!-- í•˜ë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ë“œëŠ” ë´‰ì‹¬ íƒ­ì—ì„œë§Œ ë³´ì„) -->
    <footer class="max-w-4xl mx-auto px-6 pb-12" id="bongsim-footer" style="display: none;">
        <div class="bg-white border-2 border-stone-200 rounded-xl shadow-card p-8">
            <h3 class="font-serif text-2xl text-ink font-bold mb-8 flex items-center gap-3 border-b-2 border-stone-100 pb-4">
                <span class="w-2 h-8 bg-k-red rounded-full"></span>
                ë´‰ì‹¬ í•µì‹¬ ì¤€ìˆ˜ ì‚¬í•­
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- í•­ëª© 1 -->
                <div class="flex items-start gap-4 p-5 bg-stone-50 rounded-lg border-2 border-stone-100 hover:border-stone-300 transition-colors">
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-k-red text-white rounded-full font-bold font-serif">1</span>
                    <div>
                        <strong class="block text-lg text-ink font-bold mb-1">ì™¼ë°œ ì›ì¹™</strong>
                        <span class="text-stone-700 text-base font-medium">ë´‰ì‹¬í•  ë•Œ í•­ìƒ <strong>ì™¼ë°œ</strong>ì„ ë¨¼ì € ë‚´ë”›ìŠµë‹ˆë‹¤.</span>
                    </div>
                </div>
                <!-- í•­ëª© 2 -->
                <div class="flex items-start gap-4 p-5 bg-stone-50 rounded-lg border-2 border-stone-100 hover:border-stone-300 transition-colors">
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-k-red text-white rounded-full font-bold font-serif">2</span>
                    <div>
                        <strong class="block text-lg text-ink font-bold mb-1">ë©´ìˆ˜(ä¿›é¦–)</strong>
                        <span class="text-stone-700 text-base font-medium">ê³§ê²Œ ì„  ìì„¸ì—ì„œ í„±ì„ ì‚´ì§ ë‹¹ê²¨ ì‹œì„ ì„ ì•„ë˜ë¡œ ë°”ë¼ë³´ëŠ” ìì„¸ì…ë‹ˆë‹¤.</span>
                    </div>
                </div>
                <!-- í•­ëª© 3 -->
                <div class="flex items-start gap-4 p-5 bg-stone-50 rounded-lg border-2 border-stone-100 hover:border-stone-300 transition-colors">
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-k-red text-white rounded-full font-bold font-serif">3</span>
                    <div>
                        <strong class="block text-lg text-ink font-bold mb-1">êµ­ê¶(é èº¬)</strong>
                        <span class="text-stone-700 text-base font-medium">êµ­ê¶ ìì„¸ë¥¼ ë‹¤ìŒ êµ¬ë ¹ì´ ìˆì„ ë•Œê¹Œì§€, ëê¹Œì§€ ìœ ì§€í•©ë‹ˆë‹¤.</span>
                    </div>
                </div>
                <!-- í•­ëª© 4 -->
                <div class="flex items-start gap-4 p-5 bg-stone-50 rounded-lg border-2 border-stone-100 hover:border-stone-300 transition-colors">
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-k-red text-white rounded-full font-bold font-serif">4</span>
                    <div>
                        <strong class="block text-lg text-ink font-bold mb-1">ì •ìˆ™ ìœ ì§€</strong>
                        <span class="text-stone-700 text-base font-medium">ëŒ€ê¸° ì¤‘ì—ëŠ” ì¡ë‹´ì„ ê¸ˆí•˜ê³  ë§ˆìŒì„ ëª¨ìë‹ˆë‹¤.</span>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t-2 border-stone-100">
                <div class="bg-amber-50 p-6 rounded-lg border-2 border-amber-100 flex items-start gap-3">
                    <span class="text-2xl">ğŸ’¡</span>
                    <p class="text-lg text-ink font-medium leading-relaxed">
                        ìƒë‹¨ <strong>'ë´‰ì‹¬ ì ˆì°¨'</strong>ë¥¼ í´ë¦­í•˜ì‹œë©´ ëŒ€í˜• ë³€í™” ì‹œë®¬ë ˆì´ì…˜ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        ì˜¤ë¥¸ìª½ì˜ <span class="text-k-red font-serif font-bold">ë²•ë‹¨(æ³•å£‡)</span> ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë³¸ì¸ì˜ ì •ë ¬ ìœ„ì¹˜ë¥¼ ë¯¸ë¦¬ íŒŒì•…í•´ ë³´ì„¸ìš”.
                    </p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- ê³µí†µ í‘¸í„° (ì €ì‘ê¶Œ ë“±) -->
    <div class="text-center py-8 text-stone-400 text-sm font-medium">
        &copy; Gongbu Guide. All rights reserved.
    </div>

    <!-- JavaScript ë¡œì§ -->
    <script>
        const phases = [
            {
                id: 0,
                title: "ë„ì°© ë° ì¤€ë¹„",
                description: "ê³µë¶€ ì‹œì‘ ì „ë‚  ì €ë…, ë³¸ë¶€ì— ë„ì°©í•˜ì—¬ í–‰ì • ì ˆì°¨ë¥¼ ë§ˆì¹˜ê³  ëª¸ê³¼ ë§ˆìŒì„ ì •ëˆí•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.",
                steps: [
                    { time: "20:00 ì´ì „", title: "ë³¸ë¶€ ë„ì°© ë° êµ­ê¶", desc: "ë„ì°© ì¦‰ì‹œ <strong>ëŒ€ê°•ì „ ì•ë§ˆë‹¹</strong>ì—ì„œ êµ­ê¶(ì¸ì‚¬)ì„ ë“œë¦¬ê³ , ì •ê¸‰ì‹¤ì—ì„œ ìˆ™ì†Œë¥¼ ë°°ì •ë°›ì€ í›„ íœ´ëŒ€í°ì„ ì œì¶œí•©ë‹ˆë‹¤. <span class='text-k-red font-bold bg-red-50 px-1 rounded'>ë°˜ë“œì‹œ ì•ŒëŒì„ ë„ê³  ì œì¶œí•´ ì£¼ì„¸ìš”.</span>" },
                    { time: "20:10", title: "í™˜ë³µ", desc: "ìˆ™ì†Œì— ì§ì„ í’€ê³  ì •ê°ˆí•œ í•œë³µìœ¼ë¡œ ê°ˆì•„ì…ìŠµë‹ˆë‹¤." },
                    { time: "20:30", title: "ê³µì§€ì‚¬í•­ ì²­ì·¨", desc: "ì‚¬ë¬´ì‹¤ì—ì„œ ì „ë‹¬í•˜ëŠ” ì¤‘ìš” ê³µì§€ì‚¬í•­ì„ ë“£ìŠµë‹ˆë‹¤." },
                    { time: "21:20 ì „", title: "í˜ˆì•• ì²´í¬", desc: "ì í˜¸ ì „ê¹Œì§€ <strong class='text-k-red'>'ì²­í•™ê´€'</strong>ì—ì„œ ë°˜ë“œì‹œ í˜ˆì••ì„ ì¸¡ì •í•˜ê³  ê¸°ì¬ë¥¼ ì™„ë£Œí•©ë‹ˆë‹¤." }
                ]
            },
            {
                id: 1,
                title: "ì í˜¸",
                description: "ì¸ì› ì ê²€ì„ ë§ˆì¹˜ê³ , ì…ì†Œ ì˜ì‹ì¸ 'ë“œëŠ” ë´‰ì‹¬'ì„ ìœ„í•´ ê²½ê±´í•˜ê²Œ ì¤€ë¹„í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.",
                steps: [
                    { time: "21:20 ê¹Œì§€", title: "ëŒ€ê¸° ì™„ë£Œ", desc: "ëŠ¦ì–´ë„ 21:20ê¹Œì§€ëŠ” ëŒ€ê°•ì „ 1ì¸µì— ë„ì°©í•˜ì—¬ ëŒ€ê¸°í•©ë‹ˆë‹¤. <strong>ì í˜¸ì‹œ ë‹¤ë‹¤ë¯¸ 2ì¹¸ì— 3ëª… ì‹œë¦½í•©ë‹ˆë‹¤.</strong><br><br><ul class='list-disc list-inside space-y-1 pl-1'><li>íšŒì›ì€ ì‹œê°„í‘œì— ì íŒ ìì‹ ì˜ ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ê³  ë²ˆí˜¸ì— ë§ê²Œ ì¤„ì„ ì„­ë‹ˆë‹¤.</li><li>ì™¸ìˆ˜ì™€ ë‚´ìˆ˜ëŠ” ê³µë¶€ ì‹œê°„ì— ë§ê²Œ ì¤„ì„ ì„­ë‹ˆë‹¤.</li></ul>" },
                    { time: "21:30", title: "ì í˜¸ ì‹œì‘", desc: "ëŒ€ê°•ì „ 1ì¸µì—ì„œ ì „ì²´ ì í˜¸ë¥¼ ì‹¤ì‹œí•©ë‹ˆë‹¤. <strong>ì í˜¸ ì‹œì—ëŠ” ë‹¤ë‹¤ë¯¸ 2ì¹¸ì— 3ëª…ì”© ì„­ë‹ˆë‹¤.</strong><br><br><span class='text-k-red font-bold bg-red-50 px-1 rounded'>ì£¼ì˜: ì‹œí•™ì›ê»˜ì„œ í˜¸ëª…í•˜ì‹¤ ë•ŒëŠ” ê³ ê°œë¥¼ ìˆ™ì´ê±°ë‚˜ í—ˆë¦¬ë¥¼ êµ½íˆì§€ ì•Šê³ , ë°”ë¥¸ ìì„¸ ê·¸ëŒ€ë¡œ ê°„ê²°í•˜ê²Œ 'ë„¤'í•˜ê³  ë‹µí•©ë‹ˆë‹¤.</span>" }
                ]
            },
            {
                id: 2,
                title: "ë“œëŠ” ë´‰ì‹¬",
                description: "ê³µë¶€ì˜ ì‹œì‘ì„ ì•Œë¦¬ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ì˜ì‹ì…ë‹ˆë‹¤. ë³µì¡í•œ ì´ë™ê³¼ ì˜ˆë²•ì´ ìˆìœ¼ë‹ˆ ì£¼ì˜ ê¹Šê²Œ í™•ì¸í•˜ì„¸ìš”.",
                hasSimulation: true,
                steps: [],
                dropdowns: [
                    { title: "ì…ì¥ ì ˆì°¨", content: "<div class='space-y-4'><div class='p-4 bg-stone-50 rounded border border-stone-200'><strong class='block text-lg text-k-red mb-1'>1. ì‹œë¦½ (ëŒ€ê¸°)</strong><p class='text-ink font-medium'><strong>ëŒ€ê°•ì „ 2ì¸µ ìŠ¹ì •ë¬¸ ì•</strong>ì—ì„œ 1ì—´(íšŒì›), 2ì—´(ì™¸ìˆ˜), 3ì—´(ë‚´ìˆ˜) ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ëŒ€ê¸°í•©ë‹ˆë‹¤. ì¡ë‹´ì„ ê¸ˆí•˜ê³  ê²½ê±´í•œ ë§ˆìŒì„ ê°–ìŠµë‹ˆë‹¤.</p></div><div class='p-4 bg-stone-50 rounded border border-stone-200'><strong class='block text-lg text-k-red mb-1'>2. ì†Œì¢… ë° ì´ë™ ì‹œì‘</strong><p class='text-ink font-medium'>22:27ì— ì†Œì¢…ì´ ìš¸ë¦¬ë©´ êµ¬ë ¹ì— ë”°ë¼ ì´ë™í•©ë‹ˆë‹¤.</p></div><div class='p-4 bg-stone-50 rounded border border-stone-200'><strong class='block text-lg text-k-red mb-1'>3. 3ì¸µ ì…ì¥</strong><p class='text-ink font-medium'>3ì¸µ ëŒ€ë™ë¬¸ ì•ì—ì„œ êµ­ê¶(é èº¬) ìì„¸ë¡œ ì™¼ë°œë¶€í„° ì…ì¥í•©ë‹ˆë‹¤.</p></div></div>" },
                    { title: "ë´‰ì‹¬ ì ˆì°¨", content: "<p class='text-ink font-medium text-lg p-4 mb-4'>êµ¬ì²œìƒì œë‹˜ê³¼ ì˜¥í™©ìƒì œë‹˜ ì‹ ìœ„ì— ê° 4ë°°ì”© ì´ 8ë°°ë¥¼ ì˜¬ë¦½ë‹ˆë‹¤. <strong>ì•„ë˜ ì‹œë®¬ë ˆì´í„°ë¥¼ í†µí•´ ëŒ€í˜• ë³€í™”ë¥¼ í™•ì¸í•˜ì„¸ìš”.</strong></p>", hasSim: true }, // Added flag
                    { title: "í‡´ì¥ ì ˆì°¨", content: "<p class='text-ink font-medium text-lg p-4'>êµ­ê¶(é èº¬) ìì„¸ë¥¼ ìœ ì§€í•˜ë©° ë’·ê±¸ìŒìœ¼ë¡œ í‡´ì¥í•©ë‹ˆë‹¤. 4, 5ì‹œ ê³µë¶€ìê°€ ë¨¼ì € ë‚˜ê°‘ë‹ˆë‹¤.</p>" }
                ]
            }
        ];

        let currentPhaseIdx = 0;

        document.addEventListener('DOMContentLoaded', () => {
            renderPhase(0);
        });

        function setPhase(index) {
            currentPhaseIdx = index;
            renderPhase(index);
            
            const navDiv = document.getElementById('phase-nav');
            if (navDiv) {
                const headerHeight = document.getElementById('main-header').offsetHeight || 80;
                const offset = headerHeight + 20; 
                const y = navDiv.getBoundingClientRect().top + window.pageYOffset - offset; 
                window.scrollTo({top: y, behavior: 'smooth'});
            }
        }

        function renderPhase(index) {
            const phase = phases[index];
            const container = document.getElementById('phase-content');
            const footer = document.getElementById('bongsim-footer');

            // Footer Visibility Toggle
            if (index === 2) { // Phase 2 (ë“œëŠ” ë´‰ì‹¬)
                footer.style.display = 'block';
            } else {
                footer.style.display = 'none';
            }
            
            // íƒ­ í™œì„±í™” ìŠ¤íƒ€ì¼ ì ìš© (ê°€ë…ì„± ë†’ì€ ìŠ¤íƒ€ì¼)
            [0, 1, 2].forEach(i => {
                const btn = document.getElementById(`btn-phase-${i}`);
                const title = btn.querySelector('.text-xl');
                const bar = document.getElementById(`bar-phase-${i}`);
                
                if (i === index) {
                    btn.classList.add('border-k-red', 'bg-red-50/20');
                    btn.classList.remove('border-stone-200', 'bg-white');
                    title.classList.add('text-k-red');
                    title.classList.remove('text-stone-500');
                    bar.classList.add('bg-k-red');
                    bar.classList.remove('bg-stone-300');
                } else {
                    btn.classList.remove('border-k-red', 'bg-red-50/20');
                    btn.classList.add('border-stone-200', 'bg-white');
                    title.classList.remove('text-k-red');
                    title.classList.add('text-stone-500');
                    bar.classList.remove('bg-k-red');
                    bar.classList.add('bg-stone-300');
                }
            });

            // ì½˜í…ì¸  ìƒì„±
            let html = `
                <div class="fade-in-section">
                    <div class="mb-10 bg-white p-6 rounded-xl border-2 border-stone-200 shadow-card">
                        <p class="text-xl text-ink leading-relaxed font-medium">${phase.description}</p>
                    </div>

                    <div class="space-y-6">
            `;

            // ì¼ë°˜ ë‹¨ê³„ ì¹´ë“œ
            if (phase.steps && phase.steps.length > 0) {
                phase.steps.forEach(step => {
                    html += `
                        <div class="transition-card bg-white p-6 md:p-8 border-2 border-stone-200 rounded-xl hover:border-k-red hover:bg-red-50/10 hover:-translate-y-1 shadow-card flex flex-col md:flex-row gap-6 md:items-start">
                            <div class="md:w-36 flex-shrink-0 pt-1">
                                <span class="inline-block px-3 py-1 bg-k-red/10 text-k-red font-bold rounded-full text-base">
                                    ${step.time}
                                </span>
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-serif text-2xl font-bold text-ink mb-3">
                                    ${step.title}
                                </h4>
                                <p class="text-ink text-lg leading-relaxed font-medium">${step.desc}</p>
                            </div>
                        </div>
                    `;
                });
            }

            html += `</div>`;

            // ë“œë¡­ë‹¤ìš´ ì„¹ì…˜
            if (phase.dropdowns) {
                const marginClass = (phase.steps && phase.steps.length > 0) ? 'mt-10' : 'mt-2';
                html += `<div class="${marginClass} space-y-4">`;
                phase.dropdowns.forEach(drop => {
                    let isOpen = drop.hasSim ? 'open' : ''; // Open Bongsim dropdown by default or let user open? Let's keep consistent.
                    // Actually, let's keep all closed by default for neatness, or maybe open Sim?
                    // Let's keep closed.
                    
                    html += `
                        <details class="bg-white border-2 border-stone-200 rounded-xl shadow-card group overflow-hidden" ${isOpen}>
                            <summary class="cursor-pointer p-6 flex justify-between items-center select-none hover:bg-red-50/10 transition-colors">
                                <span class="font-serif font-bold text-xl text-ink">${drop.title}</span>
                                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-stone-100 text-k-red font-bold transition-transform duration-300 group-open:rotate-180 group-open:bg-k-red group-open:text-white">â–¼</span>
                            </summary>
                            <div class="p-6 pt-0 text-lg text-ink leading-relaxed font-medium border-t-2 border-transparent group-open:border-stone-100 group-open:pt-6 bg-stone-50/50">
                                ${drop.content}
                                ${drop.hasSim ? renderSimulationUI() : ''}
                            </div>
                        </details>
                    `;
                });
                html += `</div>`;
            }

            if (phase.hasSimulation) {
                // html += renderSimulationUI(); // Removed here as it is moved inside dropdown
            }

            html += `</div>`;
            container.innerHTML = html;
            
            // Init Sim if present in current phase (inside dropdown)
            if (phase.hasSimulation) {
                // We need to wait for dropdown to be potentially opened or just init it.
                // Since it's in DOM, we can init.
                setTimeout(() => updateSim('initial'), 100);
            }
        }

        function renderSimulationUI() {
            return `
                <div class="mt-6 pt-6 border-t-2 border-stone-200">
                    <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4">
                        <div>
                            <h3 class="font-serif text-2xl font-bold text-ink mb-3 flex items-center gap-2">
                                <span class="w-1.5 h-6 bg-k-red inline-block"></span>
                                ëŒ€í˜• ë³€í™” ì‹œë®¬ë ˆì´í„° (36ëª…)
                            </h3>
                            <div class="flex flex-wrap gap-2 text-sm font-medium">
                                <span class="inline-flex items-center px-2 py-1 rounded bg-yellow-100 text-yellow-800 border border-yellow-200"><span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>íšŒì›</span>
                                <span class="inline-flex items-center px-2 py-1 rounded bg-blue-100 text-blue-800 border border-blue-200"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>ì™¸ìˆ˜</span>
                                <span class="inline-flex items-center px-2 py-1 rounded bg-red-100 text-red-800 border border-red-200"><span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>ë‚´ìˆ˜</span>
                            </div>
                        </div>
                        <div class="flex gap-2 w-full md:w-auto">
                            <button onclick="updateSim('initial')" class="flex-1 md:flex-none px-4 py-2 bg-white hover:bg-stone-50 text-ink font-bold rounded-lg border-2 border-stone-200 hover:border-stone-300 transition-all shadow-sm text-sm">ì´ˆê¸° ì •ë ¬</button>
                            <button onclick="updateSim('final')" class="flex-1 md:flex-none px-4 py-2 bg-k-red text-white hover:bg-[#851e1e] font-bold rounded-lg shadow-md transition-colors hover:-translate-y-0.5 text-sm">6ì—´ë¡œ ìš°í–¥ìš°</button>
                        </div>
                    </div>

                    <div id="sim-container" class="bg-white border-2 border-stone-200 rounded-xl p-4 sm:p-6 pr-12 pt-12 mx-auto max-w-full relative h-[400px] overflow-hidden shadow-inner">
                        
                        <!-- ê²©ì ë°°ê²½ -->
                        <div class="absolute inset-0 pointer-events-none opacity-10" style="background-image: linear-gradient(#1a1a1a 1px, transparent 1px), linear-gradient(90deg, #1a1a1a 1px, transparent 1px); background-size: 40px 40px;"></div>

                        <!-- ë²•ë‹¨ (ìš°ì¸¡) -->
                        <div class="absolute right-0 top-0 h-full w-10 bg-stone-100 border-l-2 border-stone-300 flex flex-col items-center justify-center z-20 shadow-md">
                            <span class="writing-vertical text-k-red font-serif font-bold text-lg tracking-[0.4em] drop-shadow-sm">ë²•ë‹¨(æ³•å£‡)</span>
                        </div>

                        <!-- ì˜ëŒ€ (ìƒë‹¨) -->
                        <div class="absolute top-0 left-0 w-full h-10 bg-stone-100 border-b-2 border-stone-300 flex items-center justify-center z-20 shadow-md">
                            <span class="text-k-red font-serif font-bold text-lg tracking-[0.4em] drop-shadow-sm">ì˜ëŒ€(éˆè‡º)</span>
                        </div>
                        
                        <!-- ë…¸ë“œ ì˜ì—­ -->
                        <div id="nodes-area" class="relative w-full h-full"></div>
                    </div>
                </div>
            `;
        }

        function updateSim(state) {
            const area = document.getElementById('nodes-area');
            if (!area) return;
            
            area.innerHTML = '';
            
            // ìƒ‰ìƒ: ê°€ë…ì„±ì„ ìœ„í•´ ì±„ë„ë¥¼ ì•½ê°„ ë†’ì„
            const roles = [
                { name: 'member', colorClass: 'bg-yellow-100 text-yellow-900 border-2 border-yellow-400' },
                { name: 'oesu', colorClass: 'bg-blue-100 text-blue-900 border-2 border-blue-400' },
                { name: 'naesu', colorClass: 'bg-red-100 text-red-900 border-2 border-red-400' }
            ];

            // 1ì—´(íšŒì›)ìš©: 1~12ë²ˆ (ì˜¤ë¥¸ìª½ë¶€í„°)
            const labelsRow1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            // 2,3ì—´(ì™¸ìˆ˜, ë‚´ìˆ˜)ìš©: 11, 12, 1...10 ìˆœì„œ
            const labelsRow23 = [11, 12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

            roles.forEach((role, rIndex) => {
                // ì—´ì— ë”°ë¼ ë²ˆí˜¸ ë°°ì—´ ì„ íƒ
                const currentLabels = (rIndex === 0) ? labelsRow1 : labelsRow23;

                for (let i = 0; i < 12; i++) {
                    const colIndexFromRight = i; 
                    const num = currentLabels[i]; 
                    const horizontalSpacing = 7.5; 
                    
                    let effectiveColIndex = colIndexFromRight;
                    // ì´ë™ ë¡œì§: ì§ìˆ˜ ë²ˆí˜¸ê°€ í™€ìˆ˜ ë²ˆí˜¸ ì•„ë˜ë¡œ ì´ë™
                    // ì£¼ì˜: ë²ˆí˜¸ ë°°ì—´ ìˆœì„œê°€ ë‹¬ë¼ë„ 'ì§ìˆ˜ ë²ˆí˜¸ê°€ ì´ë™í•œë‹¤'ëŠ” ê·œì¹™ì€ ë™ì¼í•˜ê²Œ ì ìš©
                    // ë‹¨, ì§ìˆ˜ê°€ ì´ë™í•  ë•Œ 'ì–´ë””ë¡œ' ê°€ëŠ”ì§€ê°€ ì¤‘ìš”í•¨
                    // ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœíˆ ì‹œê°ì ìœ¼ë¡œ 'ì™¼ìª½(í™€ìˆ˜ ìª½)'ìœ¼ë¡œ ë¶™ëŠ” ê²ƒìœ¼ë¡œ ê°€ì • (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
                    // 1ì—´(1,2,3...): 2ëŠ” 1ìª½ìœ¼ë¡œ, 4ëŠ” 3ìª½ìœ¼ë¡œ -> indexê°€ -1 ë¨ (ë§ìŒ)
                    // 2,3ì—´(11,12,1...): 12ëŠ” 11ìª½ìœ¼ë¡œ -> index -1 (ë§ìŒ), 2ëŠ” 1ìª½ìœ¼ë¡œ -> index -1 (ë§ìŒ)
                    // ë”°ë¼ì„œ ê¸°ì¡´ effectiveColIndex ë¡œì§(ì§ìˆ˜ì¼ ë•Œ index -1)ì´ ë‘ ë°°ì—´ ëª¨ë‘ì—ì„œ ìœ íš¨í•¨.
                    if (state === 'final' && num % 2 === 0) {
                        effectiveColIndex = colIndexFromRight - 1; 
                    }
                    
                    let leftVal = (90 - (colIndexFromRight * horizontalSpacing)); 
                    let finalLeftVal = (90 - (effectiveColIndex * horizontalSpacing)); 
                    
                    let left = (state === 'final') ? finalLeftVal + '%' : leftVal + '%';

                    const rowBaseTop = 10 + (rIndex * 28); 
                    let top = rowBaseTop + '%';

                    if (state === 'final' && num % 2 === 0) {
                        const pathContainer = document.createElement('div');
                        pathContainer.className = 'absolute z-0 arrow-path';
                        
                        const offset = 1.5;

                        pathContainer.style.left = (leftVal + offset) + '%';
                        pathContainer.style.top = (rowBaseTop + offset) + '%';
                        pathContainer.style.width = ((finalLeftVal - leftVal)) + '%';
                        pathContainer.style.height = '12%'; 
                        
                        // 'ã„´'ì ë™ì„  (ì•„ë˜ë¡œ -> ì˜¤ë¥¸ìª½ìœ¼ë¡œ)
                        pathContainer.style.borderLeft = '2px dotted #9d2424'; // ì§„í•œ ì ìƒ‰ ì ì„ 
                        pathContainer.style.borderBottom = '2px dotted #9d2424';
                        pathContainer.style.borderBottomLeftRadius = '12px'; 

                        area.appendChild(pathContainer);

                        top = (rowBaseTop + 12) + '%';
                    }

                    const node = document.createElement('div');
                    // ëª¨ë°”ì¼ì—ì„œë„ ì˜ ë³´ì´ë„ë¡ í¬ê¸° í‚¤ì›€ (w-9 h-9)
                    node.className = `formation-node absolute w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center text-xs md:text-sm font-bold shadow-md z-10 ${role.colorClass}`;
                    node.innerText = num;

                    if (state === 'final') {
                        node.style.transform = 'rotate(90deg)'; 
                    } else {
                        node.style.transform = 'rotate(0deg)';
                    }

                    node.style.left = left;
                    node.style.top = top;

                    if (num % 2 === 0) {
                        node.style.boxShadow = 'inset 0 0 0 2px rgba(255,255,255,0.7)'; 
                    }

                    area.appendChild(node);
                }
            });
        }

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            .fade-in-section { animation: fadeIn 0.6s ease-out forwards; opacity: 0; transform: translateY(10px); }
            @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        `;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>
