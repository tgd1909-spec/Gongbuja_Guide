<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>태극도 법식 안내</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Noto+Serif+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#fdfbf7',       // 기본 미색 배경
                        dot: '#e6e2d3',      // 패턴 점 색상
                        ink: '#2c2c2c',      // 짙은 먹색
                        bean: '#8b3a3a',     // 팥색 (포인트)
                        stone: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            300: '#d6d3d1',
                            400: '#a8a29e',
                            500: '#78716c',
                            600: '#57534e',
                            700: '#44403c',
                            800: '#292524',
                            900: '#1c1917',
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif KR"', 'serif'],
                        sans: ['"Noto Sans KR"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* 배경 한지 패턴 설정 */
        body {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e6e2d3 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* 스크롤바 커스터마이징 */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #d6d3d1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a29e;
        }

        /* 텍스트 드래그 색상 */
        ::selection {
            background-color: #8b3a3a;
            color: #ffffff;
        }
    </style>
</head>
<body class="text-ink font-sans min-h-screen flex flex-col items-center py-8 px-4 sm:px-6">

    <!-- 메인 컨테이너 -->
    <main class="w-full max-w-3xl bg-white/60 backdrop-blur-sm border border-stone-200 shadow-sm rounded-lg overflow-hidden relative transition-all duration-500">
        
        <!-- 홈 버튼 (우측 상단 고정) -->
        <a href="index.html" class="absolute top-6 right-6 sm:top-8 sm:right-8 z-20 flex items-center gap-2 text-stone-600 hover:text-stone-900 transition-colors duration-300 group">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span class="hidden sm:inline font-serif text-sm font-medium pt-0.5 group-hover:underline decoration-bean underline-offset-4 decoration-1">홈으로</span>
        </a>

        <!-- 헤더 영역 -->
        <header class="pt-12 pb-8 px-6 sm:px-10 border-b border-stone-200/60 text-center sm:text-left">
            <span class="inline-block px-3 py-1 mb-3 text-xs font-serif text-bean border border-bean/30 rounded-full bg-red-50/50">
                초심 공부자를 위한 안내
            </span>
            <h1 class="text-3xl sm:text-4xl font-serif font-bold tracking-tight leading-relaxed mb-2">
                태극도 법식(法式)
            </h1>
            <p class="text-stone-600 font-light text-sm sm:text-base break-keep">
                국궁, 배례, 봉심, 강식 등 도인으로서 갖추어야 할 기본 예법을 안내합니다.
            </p>
        </header>

        <!-- 탭 네비게이션 -->
        <nav class="sticky top-0 z-10 bg-white/80 backdrop-blur-md border-b border-stone-200 px-4 sm:px-8 py-3 overflow-x-auto">
            <div class="flex gap-2 min-w-max sm:justify-start" id="category-container">
                <!-- 자바스크립트로 버튼이 생성됩니다 -->
            </div>
        </nav>

        <!-- 컨텐츠 리스트 영역 -->
        <section id="content-list" class="divide-y divide-stone-100 min-h-[400px]">
            <!-- 자바스크립트로 카드가 생성됩니다 -->
        </section>

        <!-- 관리자 패널 (숨김 상태) -->
        <section id="admin-panel" class="hidden border-t-2 border-bean bg-stone-50 p-6 sm:p-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="font-serif text-xl font-bold text-ink flex items-center gap-2">
                    <i data-lucide="settings" class="w-5 h-5 text-bean"></i> 관리자 글쓰기/수정
                </h3>
                <button onclick="resetForm()" class="text-xs text-stone-500 hover:text-bean underline">입력 초기화</button>
            </div>
            
            <form id="post-form" class="space-y-4">
                <input type="hidden" id="edit-mode-id" value="">
                
                <div class="grid grid-cols-1 sm:grid-cols-4 gap-4">
                    <div class="sm:col-span-1">
                        <label class="block text-xs font-bold text-stone-500 mb-1">카테고리</label>
                        <select id="input-category" class="w-full bg-white border border-stone-300 rounded p-2 text-sm focus:outline-none focus:border-bean focus:ring-1 focus:ring-bean">
                            <option value="국궁">국궁</option>
                            <option value="배례">배례</option>
                            <option value="봉심">봉심</option>
                            <option value="강식">강식</option>
                        </select>
                    </div>
                    <div class="sm:col-span-3">
                        <label class="block text-xs font-bold text-stone-500 mb-1">제목</label>
                        <input type="text" id="input-title" placeholder="제목을 입력하세요 (예: 국궁의 의미)" class="w-full bg-white border border-stone-300 rounded p-2 text-sm focus:outline-none focus:border-bean focus:ring-1 focus:ring-bean font-serif">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1">내용</label>
                    <textarea id="input-desc" rows="5" placeholder="상세 내용을 입력하세요." class="w-full bg-white border border-stone-300 rounded p-2 text-sm focus:outline-none focus:border-bean focus:ring-1 focus:ring-bean"></textarea>
                </div>

                <div>
                    <label class="block text-xs font-bold text-stone-500 mb-1">이미지/영상 URL (선택)</label>
                    <input type="text" id="input-image" placeholder="https://..." class="w-full bg-white border border-stone-300 rounded p-2 text-sm focus:outline-none focus:border-bean focus:ring-1 focus:ring-bean">
                    <p class="text-[10px] text-stone-400 mt-1">* YouTube 링크나 이미지 주소를 입력하세요.</p>
                </div>

                <div class="pt-2">
                    <button type="submit" class="w-full sm:w-auto px-6 py-2 bg-bean text-white rounded hover:bg-[#6d2b2b] transition-colors text-sm font-medium shadow-sm flex items-center justify-center gap-2">
                        <i data-lucide="pen-line" class="w-4 h-4"></i>
                        <span id="submit-btn-text">게시글 등록하기</span>
                    </button>
                </div>
            </form>
        </section>

    </main>

    <!-- 푸터 -->
    <footer class="mt-8 text-center text-stone-400 text-xs font-light">
        <p class="font-serif">Taegeukdo Guide for Beginners</p>
        <p class="mt-1">&copy; 2024 태극도 법식 안내. All rights reserved.</p>
    </footer>

    <!-- 관리자 모드 토글 스위치 -->
    <div class="fixed bottom-6 right-6 z-50 flex items-center gap-2 bg-white pl-4 pr-2 py-2 rounded-full shadow-lg border border-stone-200">
        <span class="text-xs font-bold text-stone-600">관리자 모드</span>
        <button id="admin-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none bg-stone-300 hover:bg-stone-400">
            <span class="sr-only">관리자 모드 활성화</span>
            <span id="toggle-circle" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
        </button>
    </div>

    <!-- 커스텀 모달 (비밀번호 확인) -->
    <div id="password-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-[2px] transition-opacity duration-300">
        <div class="bg-white p-6 rounded-lg shadow-xl w-80 max-w-[90%] border border-stone-200 animate-in fade-in zoom-in duration-200">
            <h3 class="font-serif font-bold text-lg mb-2 text-ink flex items-center gap-2">
                <i data-lucide="lock" class="w-4 h-4 text-bean"></i> 관리자 인증
            </h3>
            <p class="text-xs text-stone-500 mb-4">관리자 비밀번호를 입력해주세요.</p>
            
            <input type="password" id="admin-password-input" 
                class="w-full p-2.5 bg-stone-50 border border-stone-200 rounded text-sm mb-2 focus:outline-none focus:border-bean focus:ring-1 focus:ring-bean transition-all" 
                placeholder="비밀번호" 
                onkeypress="if(event.key === 'Enter') checkPassword()">
            
            <p id="password-error" class="text-xs text-red-500 mb-4 h-4 opacity-0 transition-opacity">
                <i class="fa-solid fa-circle-exclamation mr-1"></i>비밀번호가 올바르지 않습니다.
            </p>
            
            <div class="flex justify-end gap-2">
                <button onclick="closePasswordModal()" class="px-3 py-1.5 text-xs font-medium text-stone-500 hover:bg-stone-100 rounded transition-colors">취소</button>
                <button onclick="checkPassword()" class="px-4 py-1.5 text-xs font-medium bg-bean text-white rounded hover:bg-[#6d2b2b] shadow-sm transition-colors">확인</button>
            </div>
        </div>
    </div>

    <!-- 커스텀 모달 (삭제 확인) -->
    <div id="delete-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-[2px]">
        <div class="bg-white p-6 rounded-lg shadow-xl w-80 max-w-[90%] border border-stone-200 animate-in fade-in zoom-in duration-200">
            <h3 class="font-serif font-bold text-lg mb-2 text-ink">게시글 삭제</h3>
            <p class="text-sm text-stone-600 mb-6">정말로 이 게시글을 삭제하시겠습니까?<br>삭제 후에는 복구할 수 없습니다.</p>
            <div class="flex justify-end gap-2">
                <button onclick="closeDeleteModal()" class="px-3 py-1.5 text-xs font-medium text-stone-500 hover:bg-stone-100 rounded transition-colors">취소</button>
                <button id="confirm-delete-btn" class="px-4 py-1.5 text-xs font-medium bg-red-600 text-white rounded hover:bg-red-700 shadow-sm transition-colors">삭제하기</button>
            </div>
        </div>
    </div>

    <script>
        // 아이콘 초기화
        lucide.createIcons();

        // 초기 데이터 (Mock Data)
        let contents = [
            {
                id: 1,
                category: '국궁',
                title: '국궁(鞠躬)의 기본 자세',
                desc: '국궁은 몸을 굽혀 존경을 표하는 동작입니다. 두 손을 공수(拱手)하고 허리를 15도 가량 굽히며, 시선은 자신의 발끝 전방 1~2미터 지점을 향합니다. 이때 마음을 차분히 가라앉히고 공경하는 마음을 담는 것이 중요합니다.',
                image: 'https://images.unsplash.com/photo-1518330666324-4286280b3328?auto=format&fit=crop&q=80&w=800', 
                date: '2023.10.15'
            },
            {
                id: 2,
                category: '배례',
                title: '배례(拜禮) 행하는 법',
                desc: '배례는 상제님께 올리는 가장 큰 경의의 표시입니다. 국궁 자세에서 시작하여 무릎을 꿇고 엎드려 절을 올립니다. 손의 위치와 일어나는 순서가 중요하며, 처음 공부하시는 분들은 무릎에 무리가 가지 않도록 천천히 연습하시기 바랍니다.',
                image: '', 
                date: '2023.10.16'
            },
            {
                id: 3,
                category: '봉심',
                title: '봉심(奉審)의 마음가짐',
                desc: '봉심은 성전을 살피고 받드는 의식입니다. 정해진 시간에 의관을 정제하고 엄숙한 마음으로 행해야 합니다. 단순히 건물을 둘러보는 것이 아니라, 도(道)와 하나 되는 경건한 마음가짐이 핵심입니다.',
                image: 'https://images.unsplash.com/photo-1598556885318-48b495922312?auto=format&fit=crop&q=80&w=800',
                date: '2023.10.20'
            },
            {
                id: 4,
                category: '강식',
                title: '강식(講式) 참여 예절',
                desc: '강식은 진리를 공부하고 토론하는 시간입니다. 경청하는 자세를 유지하며, 질문이나 발언 시에는 예의를 갖추어야 합니다. 복장은 단정해야 하며, 강의 시작 10분 전에는 착석하여 마음을 정돈합니다.',
                image: '',
                date: '2023.11.01'
            }
        ];

        let currentCategory = '전체';
        let isAdminMode = false;
        let editingId = null;
        let deleteTargetId = null;

        const categories = ['전체', '국궁', '배례', '봉심', '강식'];

        // DOM 요소
        const contentListEl = document.getElementById('content-list');
        const categoryContainerEl = document.getElementById('category-container');
        const adminPanelEl = document.getElementById('admin-panel');
        const postFormEl = document.getElementById('post-form');
        const adminToggleBtn = document.getElementById('admin-toggle');
        const toggleCircle = document.getElementById('toggle-circle');
        
        // 모달 요소
        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('admin-password-input');
        const passwordError = document.getElementById('password-error');
        const deleteModal = document.getElementById('delete-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

        // 초기화
        function init() {
            renderCategories();
            renderContents();
        }

        // 카테고리 버튼 렌더링
        function renderCategories() {
            categoryContainerEl.innerHTML = categories.map(cat => `
                <button 
                    onclick="setCategory('${cat}')" 
                    class="px-4 py-1.5 rounded-full text-sm font-medium transition-all duration-300 border ${
                        currentCategory === cat 
                        ? 'bg-ink text-white border-ink shadow-md' 
                        : 'bg-white text-stone-500 border-stone-200 hover:border-stone-400 hover:text-stone-700'
                    }">
                    ${cat}
                </button>
            `).join('');
        }

        // 컨텐츠 렌더링
        function renderContents() {
            contentListEl.innerHTML = '';
            
            const filtered = currentCategory === '전체' 
                ? contents 
                : contents.filter(item => item.category === currentCategory);

            if (filtered.length === 0) {
                contentListEl.innerHTML = `
                    <div class="py-20 text-center">
                        <i data-lucide="scroll" class="w-12 h-12 text-stone-300 mx-auto mb-3"></i>
                        <p class="text-stone-500 font-serif">등록된 안내글이 없습니다.</p>
                    </div>
                `;
                lucide.createIcons();
                return;
            }

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'p-6 sm:p-8 hover:bg-stone-50/50 transition-colors group relative';
                
                let mediaHtml = '';
                if (item.image) {
                    if (item.image.includes('youtube.com') || item.image.includes('youtu.be')) {
                        mediaHtml = `
                            <div class="mt-4 aspect-video rounded overflow-hidden bg-black/5 shadow-inner">
                                <div class="w-full h-full flex items-center justify-center text-stone-400 text-sm">
                                    (영상 미리보기: ${item.image})
                                </div>
                            </div>`;
                    } else {
                        mediaHtml = `
                            <div class="mt-4 rounded-lg overflow-hidden shadow-sm max-h-[300px] w-full">
                                <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700">
                            </div>`;
                    }
                }

                const adminButtons = isAdminMode ? `
                    <div class="absolute top-6 right-6 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="editPost(${item.id})" class="p-1.5 bg-white border border-stone-200 rounded text-stone-500 hover:text-bean hover:border-bean shadow-sm">
                            <i data-lucide="edit-2" class="w-4 h-4"></i>
                        </button>
                        <button onclick="openDeleteModal(${item.id})" class="p-1.5 bg-white border border-stone-200 rounded text-stone-500 hover:text-red-600 hover:border-red-600 shadow-sm">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                ` : '';

                div.innerHTML = `
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs font-bold text-bean bg-red-50 px-2 py-0.5 rounded border border-red-100">${item.category}</span>
                        <span class="text-xs text-stone-400">${item.date || '날짜 미상'}</span>
                    </div>
                    <h2 class="text-2xl font-serif font-bold mb-3 text-ink leading-tight group-hover:text-bean transition-colors duration-300 cursor-pointer" onclick="editPost(${item.id})">${item.title}</h2>
                    <p class="text-stone-600 leading-relaxed text-sm sm:text-base whitespace-pre-line">${item.desc}</p>
                    ${mediaHtml}
                    ${adminButtons}
                `;
                contentListEl.appendChild(div);
            });
            lucide.createIcons();
        }

        // 카테고리 변경
        function setCategory(cat) {
            currentCategory = cat;
            renderCategories();
            renderContents();
        }

        // 관리자 모드 토글 로직
        adminToggleBtn.addEventListener('click', () => {
            if (isAdminMode) {
                // 끄기
                toggleAdminState(false);
            } else {
                // 켜기 - 모달 호출
                passwordModal.classList.remove('hidden');
                passwordInput.value = '';
                passwordError.classList.add('opacity-0'); // 에러 메시지 숨김
                setTimeout(() => passwordInput.focus(), 100);
            }
        });

        // 비밀번호 확인 함수
        function checkPassword() {
            const val = passwordInput.value;
            if (val === "taegeuk1909#") {
                toggleAdminState(true);
                closePasswordModal();
            } else {
                passwordError.classList.remove('opacity-0');
                passwordInput.classList.add('border-red-500', 'ring-1', 'ring-red-500');
                passwordInput.classList.remove('border-stone-200', 'focus:border-bean', 'focus:ring-bean');
                
                // 간단한 쉐이크 애니메이션 효과를 위해 타임아웃 사용 가능하나 생략하고 스타일만 변경
            }
        }

        // 비밀번호 모달 닫기
        function closePasswordModal() {
            passwordModal.classList.add('hidden');
            passwordInput.value = '';
            // 입력창 스타일 초기화
            passwordInput.classList.remove('border-red-500', 'ring-1', 'ring-red-500');
            passwordInput.classList.add('border-stone-200');
        }

        // 관리자 상태 변경 UI 처리
        function toggleAdminState(enable) {
            isAdminMode = enable;
            
            if (isAdminMode) {
                adminToggleBtn.classList.remove('bg-stone-300');
                adminToggleBtn.classList.add('bg-bean');
                toggleCircle.classList.add('translate-x-6');
                toggleCircle.classList.remove('translate-x-1');
                adminPanelEl.classList.remove('hidden');
                
                setTimeout(() => {
                    adminPanelEl.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } else {
                adminToggleBtn.classList.add('bg-stone-300');
                adminToggleBtn.classList.remove('bg-bean');
                toggleCircle.classList.remove('translate-x-6');
                toggleCircle.classList.add('translate-x-1');
                adminPanelEl.classList.add('hidden');
                resetForm();
            }
            renderContents();
        }

        // 글 등록/수정
        postFormEl.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const category = document.getElementById('input-category').value;
            const title = document.getElementById('input-title').value;
            const desc = document.getElementById('input-desc').value;
            const image = document.getElementById('input-image').value;
            
            if (!title || !desc) {
                alert('제목과 내용을 입력해주세요.'); // 이 부분은 필수값이므로 간단히 유지하거나 커스텀 모달로 변경 가능
                return;
            }

            const today = new Date().toISOString().split('T')[0].replace(/-/g, '.');

            if (editingId) {
                // 수정
                const index = contents.findIndex(p => p.id === editingId);
                if (index !== -1) {
                    contents[index] = { ...contents[index], category, title, desc, image };
                }
            } else {
                // 신규 등록
                const newPost = {
                    id: Date.now(),
                    category,
                    title,
                    desc,
                    image,
                    date: today
                };
                contents.unshift(newPost);
            }

            resetForm();
            renderContents();
            // 성공 피드백은 생략하거나 간단한 토스트 메시지로 대체 가능
        });

        // 삭제 모달 열기
        function openDeleteModal(id) {
            deleteTargetId = id;
            deleteModal.classList.remove('hidden');
        }

        // 삭제 모달 닫기
        function closeDeleteModal() {
            deleteTargetId = null;
            deleteModal.classList.add('hidden');
        }

        // 실제 삭제 실행
        confirmDeleteBtn.addEventListener('click', () => {
            if (deleteTargetId) {
                contents = contents.filter(p => p.id !== deleteTargetId);
                renderContents();
                closeDeleteModal();
            }
        });

        // 수정 모드
        function editPost(id) {
            if (!isAdminMode) return;

            const post = contents.find(p => p.id === id);
            if (!post) return;

            editingId = id;
            document.getElementById('edit-mode-id').value = id;
            document.getElementById('input-category').value = post.category;
            document.getElementById('input-title').value = post.title;
            document.getElementById('input-desc').value = post.desc;
            document.getElementById('input-image').value = post.image || '';
            document.getElementById('submit-btn-text').innerText = '게시글 수정하기';
            
            adminPanelEl.scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            editingId = null;
            document.getElementById('edit-mode-id').value = '';
            document.getElementById('post-form').reset();
            document.getElementById('submit-btn-text').innerText = '게시글 등록하기';
        }

        // 시작
        init();

    </script>
</body>
</html>
